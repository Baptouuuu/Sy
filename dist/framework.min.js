/*! sy#0.9.1 - 2014-10-09 */
function namespace(a){var b=null,c=this;if("string"==typeof a)b=a.split(".");else{if(!(a instanceof Array&&a.length>0))return c;b=a}return c[b[0]]=c[b[0]]||{},a=b.shift(),namespace.call(c[a],b)}function objectSetter(a,b){var c="",d="",e=this,f=a.lastIndexOf(".");f>=0?(d=a.substr(f+1),c=a.substr(0,f),e=namespace.call(e,c)):d=a,e[d]=b}function objectGetter(a){var b=null,c=this;if("string"==typeof a){if(b=a.split("."),1===b.length)return c[a]}else{if(!(a instanceof Array&&a.length>1))return a instanceof Array&&1===a.length?c[a[0]]:void 0;b=a}return a=b.shift(),objectGetter.call(c[a],b)}function capitalize(a){return a.substr(0,1).toUpperCase()+a.substr(1)}function reflectedObjectGetter(a){var b=null,c=this;if("string"==typeof a){if(b=a.split("."),1===b.length)return getReflectedValue.call(c,a)}else{if(!(a instanceof Array&&a.length>1))return a instanceof Array&&1===a.length?getReflectedValue.call(c,a[0]):void 0;b=a}return a=b.shift(),reflectedObjectGetter.call(getReflectedValue.call(c,a),b)}function getReflectedValue(a){var b=new ReflectionObject(this);return b.hasMethod("get"+capitalize(a))?b.getMethod("get"+capitalize(a)).call():b.hasMethod("get")?b.getMethod("get").call(a):b.hasProperty(a)?b.getProperty(a).getValue():void 0}namespace("Sy"),Sy.ControllerInterface=function(){this.container={},this.mediator={}},Sy.ControllerInterface.prototype=Object.create(Object.prototype,{listen:{value:function(){}},broadcast:{value:function(){}},sleep:{value:function(){}},wakeup:{value:function(){}},destroy:{value:function(){}},setMediator:{value:function(){}},setServiceContainer:{value:function(){}},setViewScreen:{value:function(){}},init:{value:function(){}}}),namespace("Sy.Kernel"),Sy.Kernel.ActionDispatcher=function(){this.viewport=null,this.controllerManager=null,this.mediator=null,this.logger=null},Sy.Kernel.ActionDispatcher.prototype=Object.create(Object.prototype,{setViewPort:{value:function(a){if(!(a instanceof Sy.View.ViewPort))throw new TypeError("Invalid viewport");return this.viewport=a,this}},setControllerManager:{value:function(a){if(!(a instanceof Sy.Kernel.ControllerManager))throw new TypeError("Invalid controller manager");return this.controllerManager=a,this}},setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}},bindViewScreens:{value:function(a){for(var b=0,c=a.length;c>b;b++)this.bindViewScreen(a[b]);return this}},bindViewScreen:{value:function(a){if(!(a instanceof Sy.View.ViewScreen))throw new TypeError("Invalid viewscreen");var b,c,d=a.getNode(),e=d.querySelectorAll("[data-sy-action]");this.logger&&this.logger.info('Binding the viewscreen "'+d.dataset.syView+'" actions to the dispatcher...',a);for(var f=0,g=e.length;g>f;f++){b=e[f],c=b.dataset.syAction.split("|"),c.splice(0,1);for(var h=0,i=c.length;i>h;h++)b.addEventListener(c[h],this.eventCallback.bind(this),!1)}}},eventCallback:{value:function(a){var b,c,d=a.currentTarget,e=this.viewport.getCurrentViewScreen().getNode().dataset.syController,f=d.dataset.syAction.split("|")[0]+"Action";this.controllerManager.isControllerBuilt(e)||this.controllerManager.buildController(this.viewport.getCurrentViewScreen()),b=this.controllerManager.getController(e),c=new Sy.Event.ControllerEvent(b,f,a),this.logger&&this.logger.info("Firing a controller's method...",[b,f]),this.mediator.publish(c.PRE_ACTION,c),b[f].call(b,a),this.mediator.publish(c.POST_ACTION,c)}}}),namespace("Sy.Kernel"),Sy.Kernel.AppParser=function(){this.bundles={},this.controllers=[],this.entities=[]},Sy.Kernel.AppParser.prototype=Object.create(Object.prototype,{setBundle:{value:function(a,b){if(this.bundles.hasOwnProperty(a))throw new ReferenceError('Bundle "'+a+'" already defined');return this.bundles[a]=b,this}},getControllers:{value:function(){if(this.controllers.length>0)return this.controllers;var a;for(var b in this.bundles)if(this.bundles.hasOwnProperty(b)){if(a=this.bundles[b].Controller,!a)continue;for(var c in a)a.hasOwnProperty(c)&&this.controllers.push({name:b+"::"+c,creator:a[c]})}return this.controllers}},getEntities:{value:function(){if(this.entities.length>0)return this.entities;var a,b,c,d;for(var e in this.bundles)if(this.bundles.hasOwnProperty(e)){if(a=this.bundles[e].Entity,b=this.bundles[e].Repository||{},!a)continue;for(var f in a)a.hasOwnProperty(f)&&(c=e+"::"+f,d=a[f],this.entities.push({alias:c,bundle:e,name:f,repository:b[f],entity:d,indexes:d.prototype.INDEXES,uuid:d.prototype.UUID}))}return this.entities}},buildServices:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Core))throw new TypeError("Invalid service container");var b;for(var c in this.bundles)if(this.bundles.hasOwnProperty(c)){if(b=this.bundles[c].Config,!b||!b.Service)continue;b=new b.Service,b.define(a)}return this}},buildConfig:{value:function(a){if(!(a instanceof Sy.ConfiguratorInterface))throw new TypeError("Invalid configurator");var b;for(var c in this.bundles)if(this.bundles.hasOwnProperty(c)){if(b=this.bundles[c].Config,!b||!b.Configuration)continue;b=new b.Configuration,b.define(a)}return this}},registerValidationRules:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Core))throw new TypeError("Invalid service container");var b,c=a.get("sy::core::validator");if(!(c instanceof Sy.Validator.Core))throw new TypeError("Invalid validator");for(var d in this.bundles)if(this.bundles.hasOwnProperty(d)){if(b=this.bundles[d].Config,!b||!b.Validation)continue;b=new b.Validation,b.define(c)}return this}}}),namespace("Sy.Kernel"),Sy.Kernel.ControllerManager=function(){this.meta=null,this.loaded=null,this.mediator=null,this.container=null,this.current=null,this.cache=null,this.cacheLength=null,this.cacheOrder=[]},Sy.Kernel.ControllerManager.prototype=Object.create(Object.prototype,{setMetaRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.meta=a,this}},setLoadedControllersRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.loaded=a,this}},registerController:{value:function(a,b){if(!(b.prototype instanceof Sy.ControllerInterface))throw new TypeError("Invalid controller constructor");return this.meta.set(a,b),this}},setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}},setServiceContainer:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Core))throw new TypeError("Invalid service container");return this.container=a,this}},setCache:{value:function(a){return this.cache=!!a,this}},setCacheLength:{value:function(a){return this.cacheLength=a,this}},onDisplayListener:{value:function(a){var b=a.getViewScreen(),c=b.getNode().dataset.syController;this.loaded.has(c)&&this.current!==c?(this.loaded.get(this.current).sleep(),this.loaded.get(c).wakeup(),this.current=c):this.buildController(b)}},cacheController:{value:function(a,b){return(this.cache===!1||this.cache===!0&&"number"==typeof this.cacheLength&&this.loaded.length()>this.cacheLength)&&(this.loaded.get(this.cacheOrder[0]).destroy(),this.loaded.remove(this.cacheOrder[0]),this.cacheOrder.splice(0,1)),this.loaded.set(a,b),this.cacheOrder.push(a),this}},buildController:{value:function(a){if(!(a instanceof Sy.View.ViewScreen))throw new TypeError("Invalid viewscreen");{var b,c=a.getNode().dataset.syController;c.split("::")[0]}if(!this.meta.has(c))throw new ReferenceError('The controller with the alias "'+c+'" is undefined');return b=new(this.meta.get(c)),b.setMediator(this.mediator).setServiceContainer(this.container).setViewScreen(a).init(),this.cacheController(c,b),this.current=c,this}},isControllerBuilt:{value:function(a){return this.loaded.has(a)}},getController:{value:function(a){return this.loaded.get(a)}},boot:{value:function(){this.mediator.subscribe({channel:Sy.View.Event.ViewPortEvent.prototype.PRE_DISPLAY,fn:this.onDisplayListener,context:this})}}}),namespace("Sy.Kernel"),Sy.Kernel.Core=function(a,b){this.config=new Sy.Configurator,this.container=new Sy.ServiceContainer.Core,this.controllerManager=new Sy.Kernel.ControllerManager,this.actionDispatcher=new Sy.Kernel.ActionDispatcher,this.container.setCompiler(new Sy.ServiceContainer.Compiler),this.config.set("app.environment",a).set("app.debug",!!b)},Sy.Kernel.Core.prototype=Object.create(Object.prototype,{getConfig:{value:function(){return this.config}},getContainer:{value:function(){return this.container}},registerBundles:{value:function(){return[]}},boot:{value:function(){var a=new Sy.Kernel.FeatureTester,b=new Sy.Kernel.AppParser;a.testBrowser(),this.registerBundles().forEach(function(a){b.setBundle(a[0],a[1])}.bind(this)),this.config.set("app.meta",{controllers:b.getControllers(),entities:b.getEntities()}),this.container.setParameters(this.config),b.buildConfig(this.config).buildServices(this.container),this.registerShutdownListener(),this.container.compile(),b.registerValidationRules(this.container),this.registerControllers(b.getControllers()).configureLogger(),this.container.hasParameter("routes")&&this.container.get("sy::core::appstate").boot()}},registerControllers:{value:function(a){var b=this.container.get("sy::core::registry::factory"),c=this.container.get("sy::core::mediator"),d=this.container.get("sy::core::viewport"),e=this.container.get("sy::core::logger"),f=this.container.get("sy::core::view::manager");this.controllerManager.setMetaRegistry(b.make()).setLoadedControllersRegistry(b.make()).setMediator(c).setServiceContainer(this.container).setCache(this.config.get("controllers.cache")).setCacheLength(this.config.get("controllers.cacheLength")),this.actionDispatcher.setViewPort(d).setControllerManager(this.controllerManager).setMediator(c).setLogger(e);for(var g=0,h=a.length;h>g;g++)this.controllerManager.registerController(a[g].name,a[g].creator);return this.controllerManager.boot(),this.actionDispatcher.bindViewScreens(f.getViewScreens()),d.getCurrentViewScreen()&&this.controllerManager.buildController(d.getCurrentViewScreen()),this}},configureLogger:{value:function(){var a=this.config.get("app.debug"),b=this.container.get("sy::core::logger");return a===!1&&b.removeHandler(b.LOG).removeHandler(b.DEBUG).removeHandler(b.INFO),this}},registerShutdownListener:{value:function(){return window.addEventListener("beforeunload",function(a){try{var b=new Sy.Event.AppShutdownEvent(a);this.container.get("sy::core::mediator").publish(b.KEY,b)}catch(c){return c.message}}.bind(this),!1),this}}}),namespace("Sy.Kernel"),Sy.Kernel.FeatureTester=function(){},Sy.Kernel.FeatureTester.prototype=Object.create(Object.prototype,{testXHR:{value:function(){if("function"!=typeof XMLHttpRequest)throw new ReferenceError("XMLHttpRequest is not defined");if("function"!=typeof FormData)throw new ReferenceError("FormData is not defined")}},testBind:{value:function(){if("function"!=typeof Function.prototype.bind)throw new ReferenceError("The Function.bind method is not defined")}},testHTMLAttributes:{value:function(){if(!(document.body.dataset instanceof DOMStringMap))throw new ReferenceError("Element dataset not supported");if(!(document.body.attributes instanceof NamedNodeMap))throw new ReferenceError("Element.attributes not defined")}},testEventListener:{value:function(){if("function"!=typeof document.body.addEventListener)throw new ReferenceError("Element.addEventListener is not defined")}},testBrowser:{value:function(){this.testXHR(),this.testHTMLAttributes(),this.testBind(),this.testEventListener()}}}),namespace("Sy.Event"),Sy.Event.AppShutdownEvent=function(a){if(!(a instanceof BeforeUnloadEvent))throw new TypeError("Invalid unload event");this.originalEvent=a},Sy.Event.AppShutdownEvent.prototype=Object.create(Object.prototype,{KEY:{value:"app::shutdown",writable:!1},getOriginalEvent:{value:function(){return this.originalEvent}}}),namespace("Sy.Event"),Sy.Event.ControllerEvent=function(a,b,c){if(!(a instanceof Sy.ControllerInterface))throw new TypeError("Invalid controller");if("string"!=typeof b)throw new TypeError("Invalid action");this.controller=a,this.action=b,this.event=c},Sy.Event.ControllerEvent.prototype=Object.create(Object.prototype,{PRE_ACTION:{value:"controller::on::pre::action",writable:!1},POST_ACTION:{value:"controller::on::post::action",writable:!1},getController:{value:function(){return this.controller}},getAction:{value:function(){return this.action}},getOriginalEvent:{value:function(){return this.event}}}),namespace("Sy"),Sy.Controller=function(){this.container=null,this.mediator=null,this.mediatorListeners={},this.viewscreen=null},Sy.Controller.prototype=Object.create(Sy.ControllerInterface.prototype,{listen:{value:function(a,b){var c=this.mediator.subscribe({channel:a,fn:b,context:this});return this.mediatorListeners[a]||(this.mediatorListeners[a]=[]),this.mediatorListeners[a].push(c),this}},broadcast:{value:function(){return this.mediator.publish.apply(this.mediator,arguments),this}},setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}},setServiceContainer:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Core))throw new TypeError("Invalid service container");return this.container=a,this}},sleep:{value:function(){for(var a in this.mediatorListeners)if(this.mediatorListeners.hasOwnProperty(a))for(var b=0,c=this.mediatorListeners[a].length;c>b;b++)this.mediator.pause(a,this.mediatorListeners[a][b])}},wakeup:{value:function(){for(var a in this.mediatorListeners)if(this.mediatorListeners.hasOwnProperty(a))for(var b=0,c=this.mediatorListeners[a].length;c>b;b++)this.mediator.unpause(a,this.mediatorListeners[a][b])}},destroy:{value:function(){for(var a in this.mediatorListeners)if(this.mediatorListeners.hasOwnProperty(a))for(var b=0,c=this.mediatorListeners[a].length;c>b;b++)this.mediator.remove(a,this.mediatorListeners[a][b])}},setViewScreen:{value:function(a){if(!(a instanceof Sy.View.ViewScreen))throw new TypeError("Invalid viewscreen");return this.viewscreen=a,this}},createFormBuilder:{value:function(a,b){return this.container.get("sy::core::form").createFormBuilder(a,b)}},createForm:{value:function(a,b,c){return this.container.get("sy::core::form").createForm(a,b,c)}},getStorage:{value:function(){return this.container.get("sy::core::storage")}},redirect:{value:function(a,b){return location.hash=this.container.get("sy::core::appstate::router").generate(a,b),this}}}),namespace("Sy"),Sy.EventSubscriberInterface=function(){},Sy.EventSubscriberInterface.prototype=Object.create(Object.prototype,{getSubscribedEvents:{value:function(){}}}),namespace("Sy.FrameworkBundle.Config"),Sy.FrameworkBundle.Config.Configuration=function(){},Sy.FrameworkBundle.Config.Configuration.prototype=Object.create(Object.prototype,{define:{value:function(a){a.set({controllers:{cache:!0},logger:{level:{info:Sy.Lib.Logger.CoreLogger.prototype.INFO,debug:Sy.Lib.Logger.CoreLogger.prototype.DEBUG,error:Sy.Lib.Logger.CoreLogger.prototype.ERROR,log:Sy.Lib.Logger.CoreLogger.prototype.LOG}}})}}}),namespace("Sy.FrameworkBundle.Config"),Sy.FrameworkBundle.Config.Service=function(){},Sy.FrameworkBundle.Config.Service.prototype=Object.create(Object.prototype,{define:{value:function(a){var b=new Sy.FrameworkBundle.CompilerPass.EventSubscriberPass;a.set({"sy::core::generator::uuid":{constructor:"Sy.Lib.Generator.UUID"},mediator:"@sy::core::mediator","sy::core::mediator":{constructor:"Sy.Lib.Mediator",calls:[["setGenerator",["@sy::core::generator::uuid"]],["setLogger",["@sy::core::logger"]]]},"sy::core::registry::factory":{constructor:"Sy.RegistryFactory"},registry:"@sy::core::registry","sy::core::registry":{constructor:"Sy.Registry",factory:["sy::core::registry::factory","make"],prototype:!0},"sy::core::stateregistry::factory":{constructor:"Sy.StateRegistryFactory",calls:[["setRegistryFactory",["@sy::core::registry::factory"]]]},stateregistry:"@sy::core::stateregistry","sy::core::stateregistry":{constructor:"Sy.StateRegistry",fatory:["sy::core::stateregistry::factory","make"],prototype:!0},logger:"@sy::core::logger","sy::core::logger":{constructor:"Sy.Lib.Logger.CoreLogger",calls:[["setName",["core"]],["setHandler",["@sy::core::logger::handler::info","%logger.level.info%"]],["setHandler",["@sy::core::logger::handler::debug","%logger.level.debug%"]],["setHandler",["@sy::core::logger::handler::error","%logger.level.error%"]],["setHandler",["@sy::core::logger::handler::log","%logger.level.log%"]]]},"sy::core::logger::handler::info":{constructor:"Sy.Lib.Logger.Handler.Console",calls:[["setLevel",["%logger.level.info%"]]],"private":!0},"sy::core::logger::handler::debug":{constructor:"Sy.Lib.Logger.Handler.Console",calls:[["setLevel",["%logger.level.debug%"]]],"private":!0},"sy::core::logger::handler::error":{constructor:"Sy.Lib.Logger.Handler.Console",calls:[["setLevel",["%logger.level.error%"]]],"private":!0},"sy::core::logger::handler::log":{constructor:"Sy.Lib.Logger.Handler.Console",calls:[["setLevel",["%logger.level.log%"]]],"private":!0},"sy::core::propertyaccessor":{constructor:"Sy.PropertyAccessor",prototype:!0}}),a.addPass(b,b.AFTER_REMOVING)}}}),namespace("Sy.FormBundle.Config"),Sy.FormBundle.Config.Service=function(){},Sy.FormBundle.Config.Service.prototype=Object.create(Object.prototype,{define:{value:function(a){a.set({"sy::core::form":{constructor:"Sy.Form.Builder",calls:[["setValidator",["@sy::core::validator"]]]}}),a.addPass(new Sy.FormBundle.CompilerPass.FormTypePass)}}}),namespace("Sy.HttpBundle.Config"),Sy.HttpBundle.Config.Service=function(){},Sy.HttpBundle.Config.Service.prototype=Object.create(Object.prototype,{define:{value:function(a){a.set({rest:"@sy::core::http::rest","sy::core::http::rest":{constructor:"Sy.HTTP.REST",calls:[["setManager",["@sy::core::http"]]]},http:"@sy::core::http","sy::core::http":{constructor:"Sy.HTTP.Manager",calls:[["setParser",["@sy::core::http::parser"]],["setGenerator",["@sy::core::generator::uuid"]],["setRegistry",["@sy::core::registry"]],["setLogger",["@sy::core::logger"]]]},"sy::core::http::parser":{constructor:"Sy.HTTP.HeaderParser","private":!0}})}}}),namespace("Sy.StorageBundle.Config"),Sy.StorageBundle.Config.Service=function(){},Sy.StorageBundle.Config.Service.prototype=Object.create(Object.prototype,{define:{value:function(a){a.set({"sy::core::storage::dbal::factory":{constructor:"Sy.Storage.Dbal.Factory",calls:[["setFactoriesRegistry",["@sy::core::registry"]],["setDefaultConnectionName",["%storage.dbal.defaultConnection%"]],["setConnections",["%storage.dbal.connections%"]]]},"sy::core::storage::dbal::driver_factory::indexeddb":{constructor:"Sy.Storage.Dbal.IndexedDBFactory","private":!0,calls:[["setEntitiesMeta",["%app.meta.entities%"]],["setLogger",["@sy::core::logger"]]],tags:[{name:"storage.driver_factory",alias:"indexeddb"}]},"sy::core::storage::dbal::driver_factory::localstorage":{constructor:"Sy.Storage.Dbal.LocalstorageFactory","private":!0,calls:[["setEntitiesMeta",["%app.meta.entities%"]]],tags:[{name:"storage.driver_factory",alias:"localstorage"}]},"sy::core::storage::dbal::driver_factory::rest":{constructor:"Sy.Storage.Dbal.RestFactory","private":!0,calls:[["setEntitiesMeta",["%app.meta.entities%"]],["setREST",["@sy::core::http::rest"]]],tags:[{name:"storage.driver_factory",alias:"rest"}]},storage:"@sy::core::storage","sy::core::storage":{constructor:"Sy.Storage.Core",calls:[["setManagersRegistry",["@sy::core::registry"]],["setDefaultManager",["%storage.orm.defaultManager%"]],["setManagerFactory",["@sy::core::storage::factory::manager"]]]},"sy::core::storage::factory::manager":{constructor:"Sy.Storage.ManagerFactory","private":!0,calls:[["setDefinitions",["%storage.orm.managers%"]],["setDbalFactory",["@sy::core::storage::dbal::factory"]],["setRepositoryFactory",["@sy::core::storage::factory::repository"]],["setUnitOfWorkFactory",["@sy::core::storage::factory::unitofwork"]]]},"sy::core::storage::factory::repository":{constructor:"Sy.Storage.RepositoryFactory","private":!0,configurator:["sy::core::storage::repofactconfigurator","configure"],calls:[["setMetadataRegistry",["@sy::core::registry"]],["setRepositoriesRegistry",["@sy::core::registry"]]]},"sy::core::storage::repofactconfigurator":{constructor:"Sy.Storage.RepositoryFactoryConfigurator","private":!0,calls:[["setMetadata",["%app.meta.entities%"]]]},"sy::core::storage::factory::unitofwork":{constructor:"Sy.Storage.UnitOfWorkFactory","private":!0,calls:[["setStateRegistryFactory",["@sy::core::stateregistry::factory"]],["setGenerator",["@sy::core::generator::uuid"]],["setLogger",["@sy::core::logger"]],["setMediator",["@sy::core::mediator"]],["setPropertyAccessor",["@sy::core::propertyaccessor"]],["setEntitiesMetadata",["%app.meta.entities%"]]]}}),a.addPass(new Sy.StorageBundle.CompilerPass.RegisterDriverFactoryPass)}}}),namespace("Sy.TranslatorBundle.Config"),Sy.TranslatorBundle.Config.Service=function(){},Sy.TranslatorBundle.Config.Service.prototype=Object.create(Object.prototype,{define:{value:function(a){a.set({translator:"@sy::core::translator","sy::core::translator":{constructor:"Sy.Translator",calls:[["setRegistry",["@sy::core::registry"]],["setStateRegistryFactory",["@sy::core::stateregistry::factory"]]]}})}}}),namespace("Sy.ValidatorBundle.Config"),Sy.ValidatorBundle.Config.Service=function(){},Sy.ValidatorBundle.Config.Service.prototype=Object.create(Object.prototype,{define:{value:function(a){a.set({validator:"@sy::core::validator","sy::core::validator":{constructor:"Sy.Validator.Core",calls:[["setRulesRegistry",["@sy::core::registry"]],["setContextFactory",["@sy::core::validator::executioncontextfactory"]],["setConstraintFactory",["@sy::core::validator::constraintfactory"]]]},"sy::core::validator::executioncontextfactory":{constructor:"Sy.Validator.ExecutionContextFactory",calls:[["setConstraintValidatorFactory",["@sy::core::validator::constraintvalidatorfactory"]]],"private":!0},"sy::core::validator::constraintvalidatorfactory":{constructor:"Sy.Validator.ConstraintValidatorFactory","private":!0},"sy::core::validator::constraintfactory":{constructor:"Sy.Validator.ConstraintFactory","private":!0}})}}}),namespace("Sy.ViewBundle.Config"),Sy.ViewBundle.Config.Service=function(){},Sy.ViewBundle.Config.Service.prototype=Object.create(Object.prototype,{define:{value:function(a){var b=new Sy.ViewBundle.CompilerPass.RegisterViewScreenWrapperPass,c=new Sy.ViewBundle.CompilerPass.RegisterLayoutWrapperPass,d=new Sy.ViewBundle.CompilerPass.RegisterListWrapperPass;subscriber=new Sy.ViewBundle.CompilerPass.RegisterSubscriberPass,a.set({"sy::core::view::parser":{constructor:"Sy.View.Parser"},"sy::core::view::factory::list":{constructor:"Sy.View.ListFactory",calls:[["setTemplateEngine",["@sy::core::view::template::engine"]],["setRegistry",["@sy::core::registry"]]]},"sy::core::view::factory::layout":{constructor:"Sy.View.LayoutFactory",calls:[["setParser",["@sy::core::view::parser"]],["setTemplateEngine",["@sy::core::view::template::engine"]],["setRegistryFactory",["@sy::core::registry::factory"]],["setListFactory",["@sy::core::view::factory::list"]]]},"sy::core::view::factory::viewscreen":{constructor:"Sy.View.ViewScreenFactory",calls:[["setParser",["@sy::core::view::parser"]],["setTemplateEngine",["@sy::core::view::template::engine"]],["setRegistryFactory",["@sy::core::registry::factory"]],["setLayoutFactory",["@sy::core::view::factory::layout"]]]},"sy::core::view::template::engine":{constructor:"Sy.View.TemplateEngine",calls:[["setRegistry",["@sy::core::registry"]],["setGenerator",["@sy::core::generator::uuid"]]]},"sy::core::viewport":{constructor:"Sy.View.ViewPort",calls:[["setNode",[document.querySelector(".viewport")]],["setViewManager",["@sy::core::view::manager"]],["setMediator",["@sy::core::mediator"]]]},"sy::core::view::manager":{constructor:"Sy.View.Manager",configurator:["sy::core::view::managerconfigurator","configure"],calls:[["setViewsRegistry",["@sy::core::registry"]],["setViewScreenFactory",["@sy::core::view::factory::viewscreen"]]]},"sy::core::view::managerconfigurator":{constructor:"Sy.View.ManagerConfigurator",calls:[["setParser",["@sy::core::view::parser"]]]},"sy::core::view::subscriber::appstate":{constructor:"Sy.ViewBundle.Subscriber.AppStateSubscriber",calls:[["setViewPort",["@sy::core::viewport"]],["setLogger",["@sy::core::logger"]]]}}),a.addPass(b).addPass(c).addPass(d).addPass(subscriber)}}}),namespace("Sy.ViewBundle.Subscriber"),Sy.ViewBundle.Subscriber.AppStateSubscriber=function(){this.viewport=null,this.logger=null},Sy.ViewBundle.Subscriber.AppStateSubscriber.prototype=Object.create(Sy.EventSubscriberInterface.prototype,{setViewPort:{value:function(a){if(!(a instanceof Sy.View.ViewPort))throw new TypeError("Invalid viewport manager");return this.viewport=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}},getSubscribedEvents:{value:function(){return{"appstate.change":{method:"onChange"}}}},onChange:{value:function(a){a.getRoute().hasParameter("_viewscreen")&&(this.logger&&this.logger.info("App state changed, displaying appropriate viewscreen",{route:a.getRoute()}),this.viewport.display(a.getRoute().getParameter("_viewscreen")))}}}),namespace("Sy.AppStateBundle.Config"),Sy.AppStateBundle.Config.Service=function(){},Sy.AppStateBundle.Config.Service.prototype=Object.create(Object.prototype,{define:{value:function(a){a.set({"sy::core::appstate::routeprovider":{constructor:"Sy.AppState.RouteProvider",calls:[["setRegistry",["@sy::core::registry"]]]},router:"@sy::core::appstate::router","sy::core::appstate::router":{constructor:"Sy.AppState.Router",calls:[["setRouteProvider",["@sy::core::appstate::routeprovider"]]]},"sy::core::appstate::urlmatcher":{constructor:"Sy.AppState.UrlMatcher",calls:[["setRouteProvider",["@sy::core::appstate::routeprovider"]]]},appstate:"@sy::core::appstate","sy::core::appstate":{constructor:"Sy.AppState.Core",calls:[["setUrlMatcher",["@sy::core::appstate::urlmatcher"]],["setRouteProvider",["@sy::core::appstate::routeprovider"]],["setGenerator",["@sy::core::generator::uuid"]],["setMediator",["@sy::core::mediator"]],["setStateHandler",["@sy::core::appstate::statehandler"]]]},"sy::core::appstate::statehandler":{constructor:"Sy.AppState.StateHandler"}}),a.addPass(new Sy.AppStateBundle.CompilerPass.RegisterRoutesPass)}}}),namespace("Sy.Lib.Generator"),Sy.Lib.Generator.Interface=function(){},Sy.Lib.Generator.Interface.prototype=Object.create(Object.prototype,{generate:{value:function(){}}}),namespace("Sy.Lib.Generator"),Sy.Lib.Generator.UUID=function(){},Sy.Lib.Generator.UUID.prototype=Object.create(Sy.Lib.Generator.Interface.prototype,{s4:{value:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}},generate:{value:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}}}),namespace("Sy.Lib.Logger"),Sy.Lib.Logger.Interface=function(){},Sy.Lib.Logger.Interface.prototype=Object.create(Object.prototype,{LOG:{value:"log",writable:!1},DEBUG:{value:"debug",writable:!1},ERROR:{value:"error",writable:!1},INFO:{value:"info",writable:!1},setName:{value:function(){return this}},log:{value:function(){return this}},debug:{value:function(){return this}},error:{value:function(){return this}},info:{value:function(){return this}},setHandler:{value:function(){return this}},isHandlingLevel:{value:function(){}},removeHandler:{value:function(){}},lock:{value:function(){}}}),namespace("Sy.Lib.Logger.Handler"),Sy.Lib.Logger.Handler.Interface=function(){},Sy.Lib.Logger.Handler.Interface.prototype=Object.create(Object.prototype,{handle:{value:function(){}},isHandling:{value:function(){}}}),namespace("Sy.Lib.Logger.Handler"),Sy.Lib.Logger.Handler.Console=function(a){this.level=null,void 0!==a&&this.setLevel(a)},Sy.Lib.Logger.Handler.Console.prototype=Object.create(Sy.Lib.Logger.Handler.Interface.prototype,{setLevel:{value:function(a){if(!this.checkLevel(a))throw new TypeError("Unknown logger level");return this.level=a,this}},checkLevel:{value:function(a){return a.toUpperCase()in Sy.Lib.Logger.Interface.prototype?!0:!1}},isHandling:{value:function(a){return a===this.level?!0:!1}},handle:{value:function(a,b,c,d){if(this.isHandling(b)&&"console"in window){var e="["+moment().format("YYYY-M-D hh:mm:ss")+"]",f=d||[];c=c||"",e+=" "+a+"."+b.toUpperCase(),e+=" "+c.toString(),console[b](e,f)}return this}}}),namespace("Sy.Lib.Logger"),Sy.Lib.Logger.CoreLogger=function(a){this.name="",this.handlers={},this.setName(a)},Sy.Lib.Logger.CoreLogger.prototype=Object.create(Sy.Lib.Logger.Interface.prototype,{setName:{value:function(a){return this.name=a||"null",this}},setHandler:{value:function(a,b){return a instanceof Sy.Lib.Logger.Handler.Interface&&b.toUpperCase()in this&&(this.handlers[b]=a),this}},isHandlingLevel:{value:function(a){return!!this.handlers[a]}},removeHandler:{value:function(a){return this.isHandlingLevel(a)&&delete this.handlers[a],this}},handle:{value:function(a,b,c){return this.handlers[a]&&this.handlers[a].handle(this.name,a,b,c),this}},log:{value:function(a,b){return this.handle(this.LOG,a,b),this}},debug:{value:function(a,b){return this.handle(this.DEBUG,a,b),this}},error:{value:function(a,b){return this.handle(this.ERROR,a,b),this}},info:{value:function(a,b){return this.handle(this.INFO,a,b),this}},lock:{value:function(){return Object.seal(this.handlers),this}}}),namespace("Sy"),Sy.FactoryInterface=function(){},Sy.FactoryInterface.prototype=Object.create(Object.prototype,{make:{value:function(){}}}),namespace("Sy.Lib"),Sy.Lib.Mediator=function(){this.channels={},this.generator=null,this.logger=null},Sy.Lib.Mediator.prototype=Object.create(Object.prototype,{subscribe:{value:function(a){var a=a||{},b=null;return void 0===a.priority&&(a.priority=1),void 0===this.channels[a.channel]&&(b=new Sy.Lib.MediatorChannel(a.channel),b.setGenerator(this.generator),this.logger&&b.setLogger(this.logger),this.channels[a.channel]=b),this.channels[a.channel].add(a.fn,a.context,a.priority,a.async,a.bubbles)}},remove:{value:function(a,b){return void 0!==this.channels[a]&&this.channels[a].remove(b),this}},publish:{value:function(){if(0===arguments.length)return this;var a=Array.prototype.slice.call(arguments,0,1)[0],b=Array.prototype.slice.call(arguments,1);return void 0!==this.channels[a]&&this.channels[a].publish(b),this}},pause:{value:function(a,b){return void 0!==this.channels[a]&&(this.channels[a].stopped=!0,b&&this.channels[a].pause(b)),this}},unpause:{value:function(a,b){return void 0!==this.channels[a]&&(this.channels[a].stopped=!1,b&&this.channels[a].unpause(b)),this}},paused:{value:function(a){return void 0!==this.channels[a]?this.channels[a].stopped:void 0}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator");return this.generator=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}}}),Sy.Lib.MediatorChannel=function(a){this.name=a||"",this.stopped=!1,this.subscribers={},this.generator=null,this.logger=null},Sy.Lib.MediatorChannel.prototype=Object.create(Object.prototype,{add:{value:function(a,b,c,d,e){var f=this.generator.generate();return this.subscribers[f]={fn:a,context:b||window,priority:c||1,async:!!d,bubbles:!!e,stopped:!1},f}},remove:{value:function(a){return delete this.subscribers[a],this}},publish:{value:function(a){var a=a||[];if(this.stopped===!1){var b=[];for(var c in this.subscribers)this.subscribers.hasOwnProperty(c)&&this.subscribers[c].stopped===!1&&b.push(this.subscribers[c]);b.sort(function(a,b){return a.priority-b.priority});for(var d=0,e=b.length;e>d;d++)try{var f=b[d];f.async===!0?setTimeout(this.subscriberCall,0,this,f.fn,f.context,a):this.subscriberCall(this,f.fn,f.context,a)}catch(g){if(this.logger&&this.logger.error(g.message,g),f.bubbles===!0)throw g
}}return this}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator");return this.generator=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}},subscriberCall:{value:function(a,b,c,d){b.apply(c,d)}},pause:{value:function(a){return this.subscribers[a]&&(this.subscribers[a].stopped=!0),this}},unpause:{value:function(a){return this.subscribers[a]&&(this.subscribers[a].stopped=!1),this}}}),namespace("Sy.HTTP"),Sy.HTTP.RequestInterface=function(){},Sy.HTTP.RequestInterface.prototype=Object.create(Object.prototype,{setURI:{value:function(){}},getURI:{value:function(){}},setMethod:{value:function(){}},getMethod:{value:function(){}},setData:{value:function(){}},getData:{value:function(){}},setHeader:{value:function(){}},getHeader:{value:function(){}},setListener:{value:function(){}},getListener:{value:function(){}},setType:{value:function(){}},getType:{value:function(){}}}),namespace("Sy.HTTP"),Sy.HTTP.ResponseInterface=function(){},Sy.HTTP.ResponseInterface.prototype=Object.create(Object.prototype,{HTTP_CONTINUE:{value:100,writable:!1},HTTP_SWITCHING_PROTOCOLS:{value:101,writable:!1},HTTP_PROCESSING:{value:102,writable:!1},HTTP_OK:{value:200,writable:!1},HTTP_CREATED:{value:201,writable:!1},HTTP_ACCEPTED:{value:202,writable:!1},HTTP_NON_AUTHORITATIVE_INFORMATION:{value:203,writable:!1},HTTP_NO_CONTENT:{value:204,writable:!1},HTTP_RESET_CONTENT:{value:205,writable:!1},HTTP_PARTIAL_CONTENT:{value:206,writable:!1},HTTP_MULTI_STATUS:{value:207,writable:!1},HTTP_ALREADY_REPORTED:{value:208,writable:!1},HTTP_IM_USED:{value:226,writable:!1},HTTP_MULTIPLE_CHOICES:{value:300,writable:!1},HTTP_MOVED_PERMANENTLY:{value:301,writable:!1},HTTP_FOUND:{value:302,writable:!1},HTTP_SEE_OTHER:{value:303,writable:!1},HTTP_NOT_MODIFIED:{value:304,writable:!1},HTTP_USE_PROXY:{value:305,writable:!1},HTTP_RESERVED:{value:306,writable:!1},HTTP_TEMPORARY_REDIRECT:{value:307,writable:!1},HTTP_PERMANENTLY_REDIRECT:{value:308,writable:!1},HTTP_BAD_REQUEST:{value:400,writable:!1},HTTP_UNAUTHORIZED:{value:401,writable:!1},HTTP_PAYMENT_REQUIRED:{value:402,writable:!1},HTTP_FORBIDDEN:{value:403,writable:!1},HTTP_NOT_FOUND:{value:404,writable:!1},HTTP_METHOD_NOT_ALLOWED:{value:405,writable:!1},HTTP_NOT_ACCEPTABLE:{value:406,writable:!1},HTTP_PROXY_AUTHENTICATION_REQUIRED:{value:407,writable:!1},HTTP_REQUEST_TIMEOUT:{value:408,writable:!1},HTTP_CONFLICT:{value:409,writable:!1},HTTP_GONE:{value:410,writable:!1},HTTP_LENGTH_REQUIRED:{value:411,writable:!1},HTTP_PRECONDITION_FAILED:{value:412,writable:!1},HTTP_REQUEST_ENTITY_TOO_LARGE:{value:413,writable:!1},HTTP_REQUEST_URI_TOO_LONG:{value:414,writable:!1},HTTP_UNSUPPORTED_MEDIA_TYPE:{value:415,writable:!1},HTTP_REQUESTED_RANGE_NOT_SATISFIABLE:{value:416,writable:!1},HTTP_EXPECTATION_FAILED:{value:417,writable:!1},HTTP_I_AM_TEAPOT:{value:418,writable:!1},HTTP_UNPROCESSABLE_ENTITY:{value:422,writable:!1},HTTP_LOCKED:{value:423,writable:!1},HTTP_FAILED_DEPENDENCY:{value:424,writable:!1},HTTP_RESERVED_FOR_WEBDAV_ADVANCED_COLLECTIONS_EXPIRED_PROPOSAL:{value:425,writable:!1},HTTP_UPGRADE_REQUIRED:{value:426,writable:!1},HTTP_PRECONDITION_REQURED:{value:428,writable:!1},HTTP_TOO_MANY_REQUESTS:{value:429,writable:!1},HTTP_REQUEST_HEADER_FIELDS_TOO_LARGE:{value:431,writable:!1},HTTP_INTERNAL_SERVOR_ERROR:{value:500,writable:!1},HTTP_NOT_IMPLEMENTED:{value:501,writable:!1},HTTP_BAD_GATEWAY:{value:502,writable:!1},HTTP_SERVICE_UNAVAILABLE:{value:503,writable:!1},HTTP_GATEWAY_TIMEOUT:{value:504,writable:!1},HTTP_VERSION_NOT_SUPPORTED:{value:505,writable:!1},HTTP_VARIANT_ALSO_NEGOTIATES_EXPERIMENTAL:{value:506,writable:!1},HTTP_INSUFFICIENT_STORAGE:{value:507,writable:!1},HTTP_LOOP_DETECTED:{value:508,writable:!1},HTTP_NOT_EXTENDED:{value:510,writable:!1},HTTP_NETWORK_AUTHENTICATION_REQUIRED:{value:511,writable:!1},setStatusCode:{value:function(){}},getStatusCode:{value:function(){}},setStatusText:{value:function(){}},getStatusText:{value:function(){}},setHeaders:{value:function(){}},getHeader:{value:function(){}},setBody:{value:function(){}},getBody:{value:function(){}}}),namespace("Sy.HTTP"),Sy.HTTP.Request=function(){this.method="GET",this.data=new Sy.Registry,this.headers=new Sy.Registry,this.listener=null,this.type="",this.uri=""},Sy.HTTP.Request.prototype=Object.create(Sy.HTTP.RequestInterface.prototype,{setURI:{value:function(a){return this.uri=a,this}},getURI:{value:function(){return this.uri}},setMethod:{value:function(a){var b=a.toUpperCase();return-1!==["OPTIONS","GET","HEAD","POST","PUT","DELETE","TRACE","CONNECT"].indexOf(b)&&(this.method=b),this}},getMethod:{value:function(){return this.method}},setData:{value:function(a){for(var b in a)a.hasOwnProperty(b)&&this.data.set(b,a[b]);return this}},getData:{value:function(){return this.data.getMapping()}},setHeader:{value:function(a,b){if(a instanceof Object)for(var c in a)a.hasOwnProperty(c)&&this.setHeader(c,a[c]);else"string"==typeof a&&"string"==typeof b&&this.headers.set(a,b);return this}},getHeader:{value:function(a){return void 0!==a?this.headers.has(a)?this.headers.get(a):void 0:this.headers.getMapping()}},setListener:{value:function(a){return this.listener=a,this}},getListener:{value:function(){return this.listener}},setType:{value:function(a){return-1!==["html","json","blob"].indexOf(a)&&(this.type=a),this}},getType:{value:function(){return this.type}}}),namespace("Sy.HTTP"),Sy.HTTP.Response=function(){this.statusCode=0,this.statusText=null,this.headers=new Sy.Registry,this.body=null},Sy.HTTP.Response.prototype=Object.create(Sy.HTTP.ResponseInterface.prototype,{setStatusCode:{value:function(a){return this.statusCode=parseInt(a,10),this}},getStatusCode:{value:function(){return this.statusCode}},setStatusText:{value:function(a){return this.statusText=a,this}},getStatusText:{value:function(){return this.statusText}},setHeaders:{value:function(a){for(var b in a)a.hasOwnProperty(b)&&this.headers.set(b,a[b]);return this}},getHeader:{value:function(a){return void 0===a?this.headers.getMapping():this.headers.has(a)?this.headers.get(a):void 0}},setBody:{value:function(a){return this.body=a,this}},getBody:{value:function(){return this.body}}}),namespace("Sy.HTTP"),Sy.HTTP.JSONRequest=function(){Sy.HTTP.Request.call(this),this.setType("json"),this.setHeader("Accept","application/json")},Sy.HTTP.JSONRequest.prototype=Object.create(Sy.HTTP.Request.prototype),namespace("Sy.HTTP"),Sy.HTTP.JSONResponse=function(){Sy.HTTP.Response.call(this)},Sy.HTTP.JSONResponse.prototype=Object.create(Sy.HTTP.Response.prototype),namespace("Sy.HTTP"),Sy.HTTP.HeaderParser=function(){},Sy.HTTP.HeaderParser.prototype=Object.create(Object.prototype,{parse:{value:function(a){for(var b,c,d,e={},f=a.split("\n"),g=0,h=f.length-1;h>g;g++){switch(d=f[g].indexOf(":"),b=f[g].substring(0,d),c=f[g].substring(d+2),b){case"Date":case"Expires":case"Last-Modified":c=new Date(c)}e[b]=c}return e}}}),namespace("Sy.HTTP"),Sy.HTTP.HTMLRequest=function(){Sy.HTTP.Request.call(this),this.setType("html"),this.setHeader("Accept","text/html,application/xhtml+xml")},Sy.HTTP.HTMLRequest.prototype=Object.create(Sy.HTTP.Request.prototype),namespace("Sy.HTTP"),Sy.HTTP.HTMLResponse=function(){Sy.HTTP.Response.call(this)},Sy.HTTP.HTMLResponse.prototype=Object.create(Sy.HTTP.Response.prototype),namespace("Sy.HTTP"),Sy.HTTP.ImageRequest=function(){Sy.HTTP.Request.call(this),this.setType("blob"),this.setHeader("Accept","image/*")},Sy.HTTP.ImageRequest.prototype=Object.create(Sy.HTTP.Request.prototype),namespace("Sy.HTTP"),Sy.HTTP.ImageResponse=function(){Sy.HTTP.Response.call(this)},Sy.HTTP.ImageResponse.prototype=Object.create(Sy.HTTP.Response.prototype,{getBlob:{value:function(){return this.getBody()}}}),namespace("Sy.HTTP"),Sy.HTTP.Manager=function(){this.requests=null,this.parser=null,this.generator=null,this.logger=null},Sy.HTTP.Manager.prototype=Object.create(Object.prototype,{setParser:{value:function(a){return this.parser=a,this}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator type");return this.generator=a,this}},setRegistry:{value:function(a){if(!(a instanceof Sy.Registry))throw new TypeError("Invalid registry");return this.requests=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}},prepare:{value:function(a){if(!(a instanceof Sy.HTTP.RequestInterface))throw new TypeError("Invalid request type");this.logger&&this.logger.info("Preparing a new HTTP request...",a);var b=this.generator.generate(),c={xhr:null,obj:a,uuid:b},d=a.getHeader(),e=a.getData(),f=new FormData;switch(c.xhr=new XMLHttpRequest,c.xhr.open(a.getMethod(),a.getURI()),c.xhr.UUID=b,c.xhr.addEventListener("readystatechange",this.listener.bind(this),!1),a.getType()){case"html":c.xhr.responseType="document";break;case"json":c.xhr.responseType="json"}for(var g in d)d.hasOwnProperty(g)&&c.xhr.setRequestHeader(g,d[g]);for(var h in e)e.hasOwnProperty(h)&&f.append(h,e[h]);return c.data=f,this.requests.set(b,c),this.logger&&this.logger.info("HTTP request prepared",c),b}},getXHR:{value:function(a){var b=this.requests.get(a);return b.xhr}},launch:{value:function(a){if("string"==typeof a){var b=this.requests.get(a);return this.logger&&this.logger.info("Launching a HTTP request...",b),b.xhr.send(b.data),b.uuid}return this.launch(this.prepare(a))}},listener:{value:function(a){if(a.target.readyState===a.target.DONE&&this.requests.has(a.target.UUID)){var b,c=this.requests.get(a.target.UUID),d=c.obj.getListener(),e=this.parser.parse(a.target.getAllResponseHeaders());b=void 0!==e["Content-Type"]&&-1!==e["Content-Type"].indexOf("application/json")&&"json"===c.obj.getType()?new Sy.HTTP.JSONResponse:void 0!==e["Content-Type"]&&-1!==e["Content-Type"].indexOf("text/html")&&"html"===c.obj.getType()?new Sy.HTTP.HTMLResponse:void 0!==e["Content-Type"]&&-1!==e["Content-Type"].indexOf("image/")&&"blob"===c.obj.getType()?new Sy.HTTP.ImageResponse:new Sy.HTTP.Response,b.setHeaders(e),b.setStatusCode(a.target.status),b.setStatusText(a.target.statusText),b.setBody(a.target.response),this.requests.remove(a.target.UUID),d instanceof Function&&(this.logger&&this.logger.info("Notifying the request is finished...",b),d(b))}}},abort:{value:function(a){var b=this.requests.get(a);return b.xhr.abort(),this.requests.remove(a),this.logger&&this.logger.info("HTTP request aborted",a),this}},getStack:{value:function(){return this.requests.get()}}}),namespace("Sy.HTTP"),Sy.HTTP.REST=function(){this.manager=null},Sy.HTTP.REST.prototype=Object.create(Object.prototype,{setManager:{value:function(a){if(!(a instanceof Sy.HTTP.Manager))throw new TypeError("Invalid manager");return this.manager=a,this}},request:{value:function(a){var b=new Sy.HTTP.JSONRequest;a.data=a.data||{},a.headers=a.headers||{},b.setMethod(a.method),b.setURI(a.uri),b.setHeader(a.headers),b.setData(a.data),b.setListener(a.listener),this.manager.launch(b)}},get:{value:function(a){return a.method="get",this.request(a),this}},post:{value:function(a){return a.method="post",this.request(a),this}},put:{value:function(a){return a.method="put",a.data=a.data||{_method:"put"},this.request(a),this}},remove:{value:function(a){return a.method="delete",a.data=a.data||{_method:"delete"},this.request(a),this}}}),namespace("Sy"),Sy.RegistryInterface=function(){},Sy.RegistryInterface.prototype=Object.create(Object.prototype,{set:{value:function(){}},has:{value:function(){}},get:{value:function(){}},getMapping:{value:function(){}},remove:{value:function(){}},length:{value:function(){}}}),namespace("Sy"),Sy.Registry=function(){this.data={},this.registryLength=0},Sy.Registry.prototype=Object.create(Sy.RegistryInterface.prototype,{set:{value:function(a,b){return"string"==typeof a&&(this.data[a]=b,this.registryLength++),this}},has:{value:function(a){return this.data.hasOwnProperty(a)?!0:!1}},get:{value:function(a){if(this.has(a))return this.data[a];if(void 0===a){var b=[];for(var c in this.data)this.data.hasOwnProperty(c)&&b.push(this.data[c]);return b}throw new ReferenceError('"'+a+'" is not defined')}},getMapping:{value:function(){var a={};for(var b in this.data)this.data.hasOwnProperty(b)&&(a[b]=this.data[b]);return a}},remove:{value:function(a){if(void 0===a)for(var b in this.data)this.data.hasOwnProperty(b)&&this.remove(b);else if(a instanceof Array)for(var c=0,d=a.length;d>c;c++)this.remove(a[c]);else"string"==typeof a&&this.has(a)&&(delete this.data[a],this.registryLength--);return this}},length:{value:function(){return this.registryLength}}}),namespace("Sy"),Sy.RegistryFactory=function(){},Sy.RegistryFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{make:{value:function(){return new Sy.Registry}}}),namespace("Sy"),Sy.PropertyAccessor=function(a){this.disableGetterSetter=!!a},Sy.PropertyAccessor.prototype=Object.create(Object.prototype,{prefixes:{value:["get","is","has"],writable:!1,configurable:!1},getValue:{value:function(a,b){var c,d,e=this.transform(b),f=e.shift(),g=new ReflectionObject(a),h=!1;if(!this.disableGetterSetter){for(var i=0,j=this.prefixes.length;j>i;i++)if(d=this.prefixes[i]+this.camelize(f),g.hasMethod(d)){c=g.getMethod(d).call(),h=!0;break}!h&&g.hasMethod("get")&&(c=g.getMethod("get").call(f),h=!0)}if(!h&&g.hasProperty(f))c=g.getProperty(f).getValue();else if(!h)return void 0;return 0===e.length?c:this.getValue(c,e)}},setValue:{value:function(a,b,c){var d,e,f=this.transform(b),g=f.pop();if(0!==f.length&&(a=this.getValue(a,f)),"undefined"==typeof a)throw new ReferenceError('Path "'+b+'" not writable');return!this.disableGetterSetter&&(e="set"+this.camelize(g),d=new ReflectionObject(a),d.hasMethod(e))?(d.getMethod(e).call(c),this):(a[g]=c,this)}},transform:{value:function(a){if(a instanceof Array)return a;if("string"!=typeof a||""===a.trim())throw new TypeError("Invalid path");return a.split(".")}},camelize:{value:function(a){var b=a.split("_");return b.forEach(function(a,b){this[b]=a.substr(0,1).toUpperCase()+a.substr(1)},b),b.join("")}},enableSetterGetter:{value:function(){return this.disableGetterSetter=!1,this}},disableSetterGetter:{value:function(){return this.disableGetterSetter=!0,this}}}),namespace("Sy"),Sy.StateRegistryInterface=function(){},Sy.StateRegistryInterface.prototype=Object.create(Object.prototype,{set:{value:function(){}},has:{value:function(){}},get:{value:function(){}},state:{value:function(){}},remove:{value:function(){}},setStrict:{value:function(){}}}),namespace("Sy"),Sy.StateRegistry=function(){this.data=null,this.states=[],this.registryFactory=null,this.strict=!1},Sy.StateRegistry.prototype=Object.create(Sy.StateRegistryInterface.prototype,{setRegistryFactory:{value:function(a){if(!(a instanceof Sy.RegistryFactory))throw new TypeError("Invalid factory");return this.registryFactory=a,this.data=a.make(),this}},set:{value:function(a,b,c){if(!this.has(a)){var d=this.registryFactory.make();this.data.set(a,d),this.states.push(a)}if(this.strict===!0){var e=this.state(b);void 0!==e&&this.remove(e,b)}return this.data.get(a).set(b,c),this}},has:{value:function(a,b){return void 0===b&&this.data.has(a)?!0:this.data.has(a)&&this.data.get(a).has(b)?!0:!1}},get:{value:function(a,b){switch(arguments.length){case 2:if(this.has(a,b))return this.data.get(a).get(b);break;case 1:if(this.has(a))return this.data.get(a).get();break;case 0:var c={};for(var d in this.states)this.states.hasOwnProperty(d)&&(c[this.states[d]]=this.data.get(this.states[d]).get());return c}throw new ReferenceError('"'+b+'" does not exist in "'+a+'" state')}},state:{value:function(a){var b=[];for(var c in this.states)this.data.get(this.states[c]).has(a)&&b.push(this.states[c]);switch(b.length){case 0:return void 0;case 1:return b[0];default:return b}}},remove:{value:function(a,b){if(void 0===a)for(var c=0,d=this.states.length;d>c;c++)this.remove(this.states[c]);else this.data.get(a).remove(b);return this}},setStrict:{value:function(){return this.strict=!0,this}},getStates:{value:function(){for(var a=[],b=0,c=this.states.length;c>b;b++)this.data.get(this.states[b]).get().length>0&&a.push(this.states[b]);return a}}}),namespace("Sy"),Sy.StateRegistryFactory=function(){this.registryFactory=null},Sy.StateRegistryFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{setRegistryFactory:{value:function(a){if(!(a instanceof Sy.RegistryFactory))throw new TypeError("Invalid factory");return this.registryFactory=a,this}},make:{value:function(){var a=new Sy.StateRegistry;return a.setRegistryFactory(this.registryFactory),a}}}),namespace("Sy"),Sy.EntityInterface=function(){},Sy.EntityInterface.prototype=Object.create(Object.prototype,{UUID:{value:"uuid"},set:{value:function(){return this}},get:{value:function(){}}}),namespace("Sy"),Sy.Entity=function(){},Sy.Entity.prototype=Object.create(Sy.EntityInterface.prototype,{INDEXES:{value:[],enumerable:!1},set:{value:function(a,b){if(a instanceof Object)for(var c in a)a.hasOwnProperty(c)&&this.set(c,a[c]);else this[a]=b;return this}},get:{value:function(a){return this[a]}}}),namespace("Sy.Storage"),Sy.Storage.Core=function(){this.managers=null,this.defaultName="default",this.factory=null},Sy.Storage.Core.prototype=Object.create(Object.prototype,{setManagersRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.managers=a,this}},setDefaultManager:{value:function(a){return this.defaultName=a||"default",this}},setManagerFactory:{value:function(a){if(!(a instanceof Sy.Storage.ManagerFactory))throw new TypeError("Invalid manager factory");return this.factory=a,this}},getManager:{value:function(a){if(a=a||this.defaultName,this.managers.has(a))return this.managers.get(a);var b=this.factory.make(a);return this.managers.set(a,b),b}}}),namespace("Sy.Storage"),Sy.Storage.IdentityMap=function(){this.aliases=[],this.constructors=[],this.prototypes=[],this.keys=[]},Sy.Storage.IdentityMap.prototype=Object.create(Object.prototype,{set:{value:function(a,b,c){return Object.isFrozen(this.aliases)?this:(this.aliases.push(a),this.constructors.push(b),this.prototypes.push(b.prototype),this.keys.push(c),this)}},lock:{value:function(){return Object.freeze(this.aliases),Object.freeze(this.constructors),Object.freeze(this.prototypes),Object.freeze(this.keys),this}},hasAlias:{value:function(a){return-1!==this.aliases.indexOf(a)}},hasEntity:{value:function(a){var b=new ReflectionObject(a);return-1!==this.prototypes.indexOf(b.getPrototype())}},getAlias:{value:function(a){var b=new ReflectionObject(a),c=this.prototypes.indexOf(b.getPrototype());return this.aliases[c]}},getConstructor:{value:function(a){var b=this.aliases.indexOf(a);return this.constructors[b]}},getKey:{value:function(a){var b=this.aliases.indexOf(a);return this.keys[b]}}}),namespace("Sy.Storage"),Sy.Storage.LifeCycleEvent=function(a,b){this.alias=a,this.entity=b,this.aborted=!1},Sy.Storage.LifeCycleEvent.prototype=Object.create(Object.prototype,{PRE_CREATE:{value:"storage.pre.create",writable:!1},POST_CREATE:{value:"storage.post.create",writable:!1},PRE_UPDATE:{value:"storage.pre.update",writable:!1},POST_UPDATE:{value:"storage.post.update",writable:!1},PRE_REMOVE:{value:"storage.pre.remove",writable:!1},POST_REMOVE:{value:"storage.post.remove",writable:!1},getAlias:{value:function(){return this.alias}},getEntity:{value:function(){return this.entity}},abort:{value:function(){return this.aborted=!0,this}},isAborted:{value:function(){return this.aborted}}}),namespace("Sy.Storage"),Sy.Storage.Manager=function(){this.driver=null,this.uow=null,this.mappings=null,this.repoFactory=null},Sy.Storage.Manager.prototype=Object.create(Object.prototype,{setDriver:{value:function(a){if(!(a instanceof Sy.Storage.Dbal.DriverInterface))throw new TypeError("Invalid dbal driver");return this.driver=a,this}},getDriver:{value:function(){return this.driver}},setUnitOfWork:{value:function(a){if(!(a instanceof Sy.Storage.UnitOfWork))throw new TypeError("Invalid unit of work");return this.uow=a,this}},getUnitOfWork:{value:function(){return this.uow}},setMappings:{value:function(a){if(!(a instanceof Array))throw new TypeError("Invalid mappings array");return this.mappings=a,this}},setRepositoryFactory:{value:function(a){if(!(a instanceof Sy.Storage.RepositoryFactory))throw new TypeError("Invalid repository factory");return this.repoFactory=a,this}},getRepository:{value:function(a){if(!this.isHandled(a))throw new ReferenceError("Entity not handled by this manager");return this.repoFactory.make(this,a)}},find:{value:function(a,b){if(!this.isHandled(a))throw new ReferenceError("Entity not handled by this manager");return this.uow.find(a,b)}},persist:{value:function(a){if(!this.isHandled(this.uow.getIdentityMap().getAlias(a)))throw new ReferenceError("Entity not handled by this manager");return this.uow.persist(a),this}},flush:{value:function(){return this.uow.commit(),this}},remove:{value:function(a){if(!this.isHandled(this.uow.getIdentityMap().getAlias(a)))throw new ReferenceError("Entity not handled by this manager");return this.uow.remove(a),this}},clear:{value:function(a){return this.uow.clear(a),this}},detach:{value:function(a){if(!this.isHandled(this.uow.getIdentityMap().getAlias(a)))throw new ReferenceError("Entity not handled by this manager");return this.uow.detach(a),this}},contains:{value:function(a){if(!this.isHandled(this.uow.getIdentityMap().getAlias(a)))throw new ReferenceError("Entity not handled by this manager");return this.uow.isManaged(a)}},isHandled:{value:function(a){return 0===this.mappings.length?!0:-1!==this.mappings.indexOf(a)}}}),namespace("Sy.Storage"),Sy.Storage.ManagerFactory=function(){this.definitions={},this.dbals=null,this.repoFactory=null,this.uowFactory=null},Sy.Storage.ManagerFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{setDefinitions:{value:function(a){return this.definitions=a||{},this}},setDbalFactory:{value:function(a){if(!(a instanceof Sy.Storage.Dbal.Factory))throw new TypeError("Invalid dbal factory");return this.dbals=a,this}},setRepositoryFactory:{value:function(a){if(!(a instanceof Sy.Storage.RepositoryFactory))throw new TypeError("Invalid repository factory");return this.repoFactory=a,this}},setUnitOfWorkFactory:{value:function(a){if(!(a instanceof Sy.Storage.UnitOfWorkFactory))throw new TypeError("Invalid unit of work factory");return this.uowFactory=a,this}},make:{value:function(a){if(!this.definitions.hasOwnProperty(a))throw new ReferenceError("Unknown manager definition");var b=new Sy.Storage.Manager,c=this.uowFactory.make(),d=this.dbals.make(this.definitions[a].connection);return c.setDriver(d),b.setDriver(d).setRepositoryFactory(this.repoFactory).setMappings(this.definitions[a].mappings||[]).setUnitOfWork(c)}}}),namespace("Sy.Storage"),Sy.Storage.Repository=function(a,b){if(!(a instanceof Sy.Storage.Manager))throw new TypeError("Invalid entity manager");this.em=a,this.alias=b},Sy.Storage.Repository.prototype=Object.create(Object.prototype,{clear:{value:function(){return this.em.clear(this.alias),this}},find:{value:function(a){return this.em.find(this.alias,a)}},findAll:{value:function(){return this.em.getUnitOfWork().findAll(this.alias)}},findBy:{value:function(a,b,c){return this.em.getUnitOfWork().findBy(this.alias,a,b,c)}},findOneBy:{value:function(a,b){return this.em.getUnitOfWork().findBy(this.alias,a,b,1).then(function(a){if(1===a.length)return a[0];throw new ReferenceError("Entity not found")})}}}),namespace("Sy.Storage"),Sy.Storage.RepositoryFactory=function(){this.metadata=null,this.loaded=null},Sy.Storage.RepositoryFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{setMetadataRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.metadata=a,this}},setRepositoriesRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.loaded=a,this}},setRepository:{value:function(a,b){return this.metadata.set(a,b),this}},make:{value:function(a,b){if(this.loaded.has(b))return this.loaded.get(b);if(!this.metadata.has(b))throw new ReferenceError('Unknown entity alias "'+b+'"');var c=new(this.metadata.get(b))(a,b);if(!(c instanceof Sy.Storage.Repository))throw new TypeError("Invalid repository");return this.loaded.set(b,c),c}}}),namespace("Sy.Storage"),Sy.Storage.RepositoryFactoryConfigurator=function(){this.metadata=null},Sy.Storage.RepositoryFactoryConfigurator.prototype=Object.create(Object.prototype,{setMetadata:{value:function(a){this.metadata=a}},configure:{value:function(a){if(!(a instanceof Sy.Storage.RepositoryFactory))throw new TypeError("Invalid repository factory");for(var b=0,c=this.metadata.length;c>b;b++)a.setRepository(this.metadata[b].alias,this.metadata[b].repository||Sy.Storage.Repository)}}}),namespace("Sy.Storage"),Sy.Storage.UnitOfWork=function(){this.driver=null,this.map=null,this.entities=null,this.states=null,this.propertyAccessor=null,this.scheduledForInsert=[],this.scheduledForUpdate=[],this.scheduledForDelete=[],this.logger=null,this.generator=null,this.mediator=null},Sy.Storage.UnitOfWork.prototype=Object.create(Object.prototype,{STATE_NEW:{value:"new",writable:!1},STATE_MANAGED:{value:"managed",writable:!1},STATE_DETACHED:{value:"detached",writable:!1},STATE_REMOVED:{value:"removed",writable:!1},setDriver:{value:function(a){if(!(a instanceof Sy.Storage.Dbal.DriverInterface))throw new TypeError("Invalid database driver");return this.driver=a,this}},setIdentityMap:{value:function(a){if(!(a instanceof Sy.Storage.IdentityMap))throw new TypeError("Invalid identity map");return this.map=a,this}},getIdentityMap:{value:function(){return this.map}},setEntitiesRegistry:{value:function(a){if(!(a instanceof Sy.StateRegistryInterface))throw new TypeError("Invalid state registry");return this.entities=a,this}},setPropertyAccessor:{value:function(a){if(!(a instanceof Sy.PropertyAccessor))throw new TypeError("Invalid property accessor");return this.propertyAccessor=a,this}},setStatesRegistry:{value:function(a){if(!(a instanceof Sy.StateRegistryInterface))throw new TypeError("Invalid state registry");return this.states=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator");return this.generator=a,this}},setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}},find:{value:function(a,b){return this.entities.has(a,b)?new Promise(function(c){c(this.entities.get(a,b))}.bind(this)):this.driver.read(a,b).then(function(b){return this.buildEntity(a,b)}.bind(this))}},findAll:{value:function(a){return this.driver.findAll(a).then(function(b){for(var c=0,d=b.length;d>c;c++)b[c]=this.buildEntity(a,b[c]);return b}.bind(this))}},findBy:{value:function(a,b,c,d){return this.driver.find(a,b,c,d).then(function(b){for(var c=0,d=b.length;d>c;c++)b[c]=this.buildEntity(a,b[c]);return b}.bind(this))}},buildEntity:{value:function(a,b){var c,d=this.map.getConstructor(a),e=this.map.getKey(a);this.entities.has(a,b[e])?c=this.entities.get(a,b[e]):(c=new d,this.entities.set(a,b[e],c),new ObjectObserver(c).open(function(){this.computeSchedules(c)}.bind(this)));for(var f in b)b.hasOwnProperty(f)&&c.set(f,b[f]);return this.states.set(this.STATE_MANAGED,b[e],b[e]),c}},persist:{value:function(a){if(!(a instanceof Sy.EntityInterface))throw new TypeError("Invalid entity");var b=this.map.getAlias(a),c=this.map.getKey(b),d=this.propertyAccessor.getValue(a,c),e=this.states.state(d);return void 0===e?(d=this.generator.generate(),this.states.set(this.STATE_NEW,d,d),this.scheduledForInsert.push(a),this.propertyAccessor.setValue(a,c,d),new ObjectObserver(a).open(function(){this.computeSchedules(a)}.bind(this))):this.scheduledForUpdate.push(a),this.entities.set(b,d,a),this}},commit:{value:function(){return Platform.performMicrotaskCheckpoint(),this.scheduledForInsert.forEach(function(a){var b=this.map.getAlias(a),c=this.map.getKey(b),d=this.propertyAccessor.getValue(a,c),e=new Sy.Storage.LifeCycleEvent(b,a);this.mediator&&this.mediator.publish(e.PRE_CREATE,e),e.isAborted()||this.driver.create(b,this.getEntityData(a)).then(function(){this.states.set(this.STATE_MANAGED,d,d),this.mediator&&this.mediator.publish(e.POST_CREATE,e),this.logger&&this.logger.info("Entity created",a)}.bind(this))},this),this.scheduledForUpdate.forEach(function(a){var b=this.map.getAlias(a),c=this.map.getKey(b),d=this.propertyAccessor.getValue(a,c),e=new Sy.Storage.LifeCycleEvent(b,a);this.mediator&&this.mediator.publish(e.PRE_UPDATE,e),e.isAborted()||this.driver.update(b,d,this.getEntityData(a)).then(function(){this.mediator&&this.mediator.publish(e.POST_UPDATE,e),this.logger&&this.logger.info("Entity updated",a)})},this),this.scheduledForDelete.forEach(function(a){var b=this.map.getAlias(a),c=this.map.getKey(b),d=this.propertyAccessor.getValue(a,c),e=new Sy.Storage.LifeCycleEvent(b,a);this.mediator&&this.mediator.publish(e.PRE_REMOVE,e),e.isAborted()||this.driver.remove(b,d).then(function(){this.states.set(this.STATE_REMOVED,d,d),this.mediator&&this.mediator.publish(e.POST_REMOVE,e),this.logger&&this.logger.info("Entity removed",a)}.bind(this))},this),this.scheduledForInsert.splice(0),this.scheduledForUpdate.splice(0),this.scheduledForDelete.splice(0),this}},remove:{value:function(a){if(!(a instanceof Sy.EntityInterface))throw new TypeError("Invalid entity");var b=this.map.getAlias(a),c=this.map.getKey(b),d=this.states.state(this.propertyAccessor.getValue(a,c));return d===this.STATE_MANAGED?(this.isScheduledForUpdate(a)&&this.scheduledForUpdate.splice(this.scheduledForUpdate.indexOf(a),1),this.scheduledForDelete.push(a)):d===this.STATE_NEW&&this.scheduledForInsert.splice(this.scheduledForInsert.indexOf(a),1),this}},clear:{value:function(a){var b=this.entities.get();for(var c in b)if(b.hasOwnProperty(c)){if(void 0!==a&&a!==c)continue;for(var d=0,e=b[c].length;e>d;d++)this.detach(b[c][d]);if(void 0!==a&&a===c)break}return this}},detach:{value:function(a){var b=this.map.getAlias(a),c=this.map.getKey(b),d=this.propertyAccessor.getValue(a,c);return this.states.set(this.STATE_DETACHED,d,d),this.isScheduledForInsert(a)&&this.scheduledForInsert.splice(this.scheduledForInsert.indexOf(a),1),this.isScheduledForUpdate(a)&&this.scheduledForUpdate.splice(this.scheduledForUpdate.indexOf(a),1),this.isScheduledForDelete(a)&&this.scheduledForDelete.splice(this.scheduledForDelete.indexOf(a),1),this}},isManaged:{value:function(a){var b=this.map.getAlias(a),c=this.map.getKey(b),d=this.propertyAccessor.getValue(a,c);return state=this.states.state(d),-1!==[this.STATE_NEW,this.STATE_MANAGED].indexOf(state)}},isScheduledForInsert:{value:function(a){return-1!==this.scheduledForInsert.indexOf(a)}},isScheduledForUpdate:{value:function(a){return-1!==this.scheduledForUpdate.indexOf(a)}},isScheduledForDelete:{value:function(a){return-1!==this.scheduledForDelete.indexOf(a)}},computeSchedules:{value:function(a){var b=this.map.getAlias(a),c=this.map.getKey(b),d=this.states.state(this.propertyAccessor.getValue(a,c));d!==this.STATE_MANAGED||this.isScheduledForUpdate(a)||this.scheduledForUpdate.push(a)}},getEntityData:{value:function(a){var b={},c=new ReflectionObject(a);return c.getProperties().forEach(function(c){b[c.getName()]=this.propertyAccessor.getValue(a,c.getName())}.bind(this)),b}}}),namespace("Sy.Storage"),Sy.Storage.UnitOfWorkFactory=function(){this.identityMap=new Sy.Storage.IdentityMap,this.stateRegistryFactory=null,this.propertyAccessor=null,this.logger=null,this.generator=null,this.mediator=null},Sy.Storage.UnitOfWorkFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{setEntitiesMetadata:{value:function(a){if(!(a instanceof Array))throw new TypeError("Invalid metadata array");
for(var b=0,c=a.length;c>b;b++)this.identityMap.set(a[b].alias,a[b].entity,a[b].uuid);return this.identityMap.lock(),this}},setStateRegistryFactory:{value:function(a){if(!(a instanceof Sy.StateRegistryFactory))throw new TypeError("Invalid state registry factory");return this.stateRegistryFactory=a,this}},setPropertyAccessor:{value:function(a){if(!(a instanceof Sy.PropertyAccessor))throw new TypeError("Invalid property accessor");return this.propertyAccessor=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator");return this.generator=a,this}},setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}},make:{value:function(){var a=new Sy.Storage.UnitOfWork;return a.setIdentityMap(this.identityMap).setEntitiesRegistry(this.stateRegistryFactory.make()).setStatesRegistry(this.stateRegistryFactory.make().setStrict()).setPropertyAccessor(this.propertyAccessor).setLogger(this.logger).setGenerator(this.generator).setMediator(this.mediator)}}}),namespace("Sy.Storage.Dbal"),Sy.Storage.Dbal.DriverFactoryInterface=function(){},Sy.Storage.Dbal.DriverFactoryInterface.prototype=Object.create(Sy.FactoryInterface.prototype,{make:{value:function(){}}}),namespace("Sy.Storage.Dbal"),Sy.Storage.Dbal.DriverInterface=function(){},Sy.Storage.Dbal.DriverInterface.prototype=Object.create(Object.prototype,{read:{value:function(){}},create:{value:function(){}},update:{value:function(){}},remove:{value:function(){}},find:{value:function(){}},findAll:{value:function(){}}}),namespace("Sy.Storage.Dbal"),Sy.Storage.Dbal.Factory=function(){this.factories=null,this.defaultConnection="default",this.connections={}},Sy.Storage.Dbal.Factory.prototype=Object.create(Sy.FactoryInterface.prototype,{setFactoriesRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.factories=a,this}},setDriverFactory:{value:function(a,b){if(!(b instanceof Sy.Storage.Dbal.DriverFactoryInterface))throw new TypeError("Invalid driver factory");if(this.factories.has(a))throw new ReferenceError("Can't redefine the driver factory \""+a+'"');return this.factories.set(a,b),this}},setDefaultConnectionName:{value:function(a){return this.defaultConnection=a||"default",this}},setConnections:{value:function(a){return this.connections=a||{},this}},make:{value:function(a){if(a=a||this.defaultConnection,!this.connections.hasOwnProperty(a))throw new ReferenceError('No connection defined with the name "'+a+'"');var b,c,d=this.connections[a];if(!this.factories.has(d.driver))throw new ReferenceError('Unknown driver "'+d.driver+'"');if(b=this.factories.get(d.driver),c=b.make(d.dbname,d.version||1,d.stores||[],d.options||{}),!(c instanceof Sy.Storage.Dbal.DriverInterface))throw new TypeError("Invalid driver instance");return c}}}),namespace("Sy.Storage.Dbal"),Sy.Storage.Dbal.IndexedDB=function(){this.version=1,this.connection=null,this.transaction=null,this.keyRange=null,this.transactionModes={READ_ONLY:null,READ_WRITE:null},this.name=null,this.stores={},this.storage=null,this.logger=null,this.opened=!1,this.openingCheckInterval=null,this.openingPromise=null},Sy.Storage.Dbal.IndexedDB.prototype=Object.create(Sy.Storage.Dbal.DriverInterface.prototype,{setName:{value:function(a){return this.name=a,this}},setVersion:{value:function(a){return this.version=a||1,this}},setConnection:{value:function(a){if(!(a instanceof IDBFactory))throw new TypeError("Invalid connection");return this.connection=a,this}},setTransaction:{value:function(a){return this.transaction=a,this.transactionModes.READ_ONLY=a.READ_ONLY||"readonly",this.transactionModes.READ_WRITE=a.READ_WRITE||"readwrite",this}},setKeyRange:{value:function(a){return this.keyRange=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}},setStore:{value:function(a,b,c,d){return this.stores[a]={path:b,key:c,indexes:d},this}},open:{value:function(){var a=this.connection.open(this.name,this.version);return a.onupgradeneeded=this.upgradeDatabase.bind(this),a.onsuccess=function(a){this.storage=a.target.result,this.opened=!0,this.storage.onerror=function(a){this.logger&&this.logger.error("Database operation failed",[this.name,a])},this.logger&&this.logger.info("Database opened",this.name)}.bind(this),a.onerror=function(a){this.logger&&this.logger.error("Database opening failed",[this.name,a])}.bind(this),a.onblocked=function(a){this.logger&&this.logger.error("Database opening failed! (blocked by browser setting)",[this.name,a])}.bind(this),this}},whenOpened:{value:function(){return this.openingPromise?this.openingPromise:(this.openingPromise=new Promise(function(a){return this.opened===!0?void a():void(null===this.openingCheckInterval&&(this.openingCheckInterval=setInterval(function(){this.opened===!0&&(a(),clearInterval(this.openingCheckInterval))}.bind(this),50)))}.bind(this)),this.openingPromise)}},upgradeDatabase:{value:function(a){var b;this.logger&&this.logger.info("Upgrading database...",[this.name,this.version]),this.storage=a.target.result;for(var c in this.stores)if(this.stores.hasOwnProperty(c)){c=this.stores[c],this.storage.objectStoreNames.contains(c.path)||this.storage.createObjectStore(c.path,{keyPath:c.key,autoincrement:!1}),b=a.target.transaction.objectStore(c.path);for(var d=0,e=b.indexNames.length;e>d;d++)-1===c.indexes.indexOf(b.indexNames[d])&&b.deleteIndex(b.indexNames[d]);for(var f=0,g=c.indexes.length;g>f;f++)b.indexNames.contains(c.indexes[f])||b.createIndex(c.indexes[f],c.indexes[f],{unique:!1})}}},read:{value:function(a,b){return new Promise(function(c,d){if(!this.stores.hasOwnProperty(a))return void d(new ReferenceError('Unknown store "'+a+'"'));var e=this.stores[a];try{var f=this.storage.transaction([e.path],this.transactionModes.READ_ONLY),g=f.objectStore(e.path),h=g.get(b);h.addEventListener("success",function(a){c(a.target.result)}.bind(this)),h.addEventListener("error",function(a){this.logger&&this.logger.error("Read operation failed!",[this.name,a]),d(a)}.bind(this))}catch(i){this.logger&&this.logger.error("Read operation failed!",[this.name,i]),d(i)}}.bind(this))}},create:{value:function(a,b){return new Promise(function(c,d){if(!this.stores.hasOwnProperty(a))return void d(new ReferenceError('Unknown store "'+a+'"'));var e=this.stores[a];try{var f=this.storage.transaction([e.path],this.transactionModes.READ_WRITE),g=f.objectStore(e.path),h=g.put(b);h.addEventListener("success",function(a){c(a.target.result)}.bind(this)),h.addEventListener("error",function(a){this.logger&&this.logger.error("Create operation failed!",[this.name,a]),d(a)}.bind(this))}catch(i){this.logger&&this.logger.error("Create operation failed!",[this.name,i]),d(i)}}.bind(this))}},update:{value:function(a,b,c){return new Promise(function(b,d){if(!this.stores.hasOwnProperty(a))return void d(new ReferenceError('Unknown store "'+a+'"'));var e=this.stores[a];try{var f=this.storage.transaction([e.path],this.transactionModes.READ_WRITE),g=f.objectStore(e.path),h=g.put(c);h.addEventListener("success",function(a){b(a.target.result)}.bind(this)),h.addEventListener("error",function(a){this.logger&&this.logger.error("Update operation failed!",[this.name,a]),d(a)}.bind(this))}catch(i){this.logger&&this.logger.error("Update operation failed!",[this.name,i]),d(i)}}.bind(this))}},remove:{value:function(a,b){return new Promise(function(c,d){if(!this.stores.hasOwnProperty(a))return void d(new ReferenceError('Unknown store "'+a+'"'));var e=this.stores[a];try{var f=this.storage.transaction([e.path],this.transactionModes.READ_WRITE),g=f.objectStore(e.path),h=g.delete(b);h.addEventListener("success",function(a){c(a.target.result)}.bind(this)),h.addEventListener("error",function(a){this.logger&&this.logger.error("Delete operation failed!",[this.name,a]),d(a)}.bind(this))}catch(i){this.logger&&this.logger.error("Delete operation failed!",[this.name,i]),d(i)}}.bind(this))}},find:{value:function(a,b,c,d){return new Promise(function(e,f){if(!this.stores.hasOwnProperty(a))return void f(new ReferenceError('Unknown store "'+a+'"'));var g=this.stores[a];try{var h,i,j=this.storage.transaction([g.path],this.transactionModes.READ_ONLY),k=j.objectStore(g.path),l=k.index(b),m=[];h=c instanceof Array&&2===c.length?void 0===c[0]?this.keyRange.upperBound(c[1]):void 0===c[1]?this.keyRange.lowerBound(c[0]):this.keyRange.bound(c[0],c[1]):this.keyRange.only(c),i=l.openCursor(h),i.addEventListener("success",function(a){var b=a.target.result;return!!b==!1?void e(void 0!==d?m.slice(0,d):m):(m.push(b.value),void b.continue())}),i.addEventListener("error",function(a){this.logger&&this.logger.error("Search operation failed!",[this.name,a]),f(a)}.bind(this))}catch(n){this.logger&&this.logger.error("Search operation failed!",[this.name,n]),f(n)}}.bind(this))}},findAll:{value:function(a){return new Promise(function(b,c){if(!this.stores.hasOwnProperty(a))return void c(new ReferenceError('Unknown store "'+a+'"'));var d=this.stores[a];try{var e=this.storage.transaction([d.path],this.transactionModes.READ_ONLY),f=e.objectStore(d.path),g=f.openCursor(),h=[];g.addEventListener("success",function(a){var c=a.target.result;return!!c==!1?void b(h):(h.push(c.value),void c.continue())}),g.addEventListener("error",function(a){this.logger&&this.logger.error("Search operation failed!",[this.name,a]),c(a)}.bind(this))}catch(i){this.logger&&this.logger.error("Search operation failed!",[this.name,i]),c(i)}}.bind(this))}}}),namespace("Sy.Storage.Dbal"),Sy.Storage.Dbal.IndexedDBFactory=function(){this.meta=[],this.logger=null},Sy.Storage.Dbal.IndexedDBFactory.prototype=Object.create(Sy.Storage.Dbal.DriverFactoryInterface.prototype,{setEntitiesMeta:{value:function(a){return this.meta=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}},make:{value:function(a,b,c){var d=new Sy.Storage.Dbal.IndexedDB;d.setName(a).setVersion(b).setConnection(window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB).setTransaction(window.IDBTransaction||window.webkitIDBTransaction).setKeyRange(window.IDBKeyRange||window.webkitIDBKeyRange).setLogger(this.logger);for(var e=0,f=this.meta.length;f>e;e++)(0===c.length||-1!==c.indexOf(this.meta[e].alias))&&d.setStore(this.meta[e].alias,this.meta[e].alias.toLowerCase(),this.meta[e].uuid,this.meta[e].indexes);return d.open()}}}),namespace("Sy.Storage.Dbal"),Sy.Storage.Dbal.Localstorage=function(){this.storage=null,this.stores={},this.data=null,this.name=null},Sy.Storage.Dbal.Localstorage.prototype=Object.create(Sy.Storage.Dbal.DriverInterface.prototype,{setName:{value:function(a){return this.name=a,this}},setConnection:{value:function(a){if(!(a instanceof Storage))throw new TypeError("Invalid storage");return this.storage=a,this}},setStore:{value:function(a,b,c){return this.stores[a]={path:b,key:c},this}},open:{value:function(){var a=this.storage.getItem(this.name);return a?this.data=JSON.parse(a):this.createStorage(),this}},createStorage:{value:function(){this.data={};for(var a in this.stores)this.stores.hasOwnProperty(a)&&(this.data[this.stores[a].path]={});return this.commit(),this}},commit:{value:function(){this.storage.setItem(this.name,JSON.stringify(this.data))}},read:{value:function(a,b){return new Promise(function(c,d){if(!this.stores.hasOwnProperty(a))return void d(new ReferenceError('Unknown store "'+a+'"'));var e=this.stores[a];this.data[e.path].hasOwnProperty(b)&&c(this.data[e.path][b])}.bind(this))}},create:{value:function(a,b){return new Promise(function(c,d){if(!this.stores.hasOwnProperty(a))return void d(new ReferenceError('Unknown store "'+a+'"'));var e=this.stores[a];this.data[e.path][b[e.key]]=b,this.commit(),c(b[e.key])}.bind(this))}},update:{value:function(a,b,c){return new Promise(function(d,e){if(!this.stores.hasOwnProperty(a))return void e(new ReferenceError('Unknown store "'+a+'"'));var f=this.stores[a];this.data[f.path][b]=c,this.commit(),d(c)}.bind(this))}},remove:{value:function(a,b){return new Promise(function(c,d){if(!this.stores.hasOwnProperty(a))return void d(new ReferenceError('Unknown store "'+a+'"'));var e=this.stores[a];delete this.data[e.path][b],this.commit(),c()}.bind(this))}},find:{value:function(a,b,c,d){return new Promise(function(e,f){this.stores.hasOwnProperty(a)||f(new ReferenceError('Unknown store "'+a+'"'));var g,h=this.stores[a],i=[];for(var j in this.data[h.path])this.data[h.path].hasOwnProperty(j)&&(g=this.data[h.path][j],c instanceof Array?(void 0===c[0]&&g[b]<=c[1]||void 0===c[1]&&g[b]>=c[0]||g[b]>=c[0]&&g[b]<=c[1])&&i.push(g):g[b]===c&&i.push(g));void 0!==d&&(i=i.slice(0,d)),e(i)}.bind(this))}},findAll:{value:function(a){return new Promise(function(b,c){if(!this.stores.hasOwnProperty(a))return void c(new ReferenceError('Unknown store "'+a+'"'));var d=this.stores[a],e=[];for(var f in this.data[d.path])this.data[d.path].hasOwnProperty(f)&&e.push(this.data[d.path][f]);b(e)}.bind(this))}}}),namespace("Sy.Storage.Dbal"),Sy.Storage.Dbal.LocalstorageFactory=function(){this.meta=[]},Sy.Storage.Dbal.LocalstorageFactory.prototype=Object.create(Sy.Storage.Dbal.DriverFactoryInterface.prototype,{setEntitiesMeta:{value:function(a){return this.meta=a,this}},make:{value:function(a,b,c,d){var e=new Sy.Storage.Dbal.Localstorage;e.setName(a).setConnection(d.temporary===!0?localStorage:sessionStorage);for(var f=0,g=this.meta.length;g>f;f++)(0===c.length||-1!==c.indexOf(this.meta[f].alias))&&e.setStore(this.meta[f].alias,this.meta[f].alias.toLowerCase(),this.meta[f].uuid);return e.open()}}}),namespace("Sy.Storage.Dbal"),Sy.Storage.Dbal.Rest=function(){this.pattern=null,this.version=1,this.connection=null,this.logger=null,this.headers={},this.stores={}},Sy.Storage.Dbal.Rest.prototype=Object.create(Sy.Storage.Dbal.DriverInterface.prototype,{setURLPattern:{value:function(a){return/.*\/$/.test(a)||(a+="/"),this.pattern=a,this}},setVersion:{value:function(a){return this.pattern&&(this.pattern=this.pattern.replace("{version}",a)),this.version=a,this}},setConnection:{value:function(a){if(!(a instanceof Sy.HTTP.REST))throw new TypeError("Invalid rest engine");return this.connection=a,this}},setHeader:{value:function(a,b){return this.headers[a]=b,this}},setStore:{value:function(a,b,c,d){return this.stores[a]={bundle:b,name:c,key:d,path:this.urlPattern.replace("{bundle}",b).replace("{name}",c).replace("{bundle|lower}",b.toLowerCase()).replace("{name|lower}",c.toLowerCase())},this}},read:{value:function(a,b){return new Promise(function(c,d){if(!this.stores.hasOwnProperty(a))return void d(new ReferenceError('Unknown store "'+a+'"'));var e=this.stores[a];this.connection.get({uri:e.path+b,headers:this.headers,listener:function(a){a.getStatusCode()===a.HTTP_OK?c(a.getBody()):d(a.getStatusCode().toString()+" "+a.getStatusText())}.bind(this)})}.bind(this))}},create:{value:function(a,b){return new Promise(function(c,d){if(!this.stores.hasOwnProperty(a))return void d(new ReferenceError('Unknown store "'+a+'"'));var e=this.stores[a];this.connection.post({uri:e.path,headers:this.headers,data:b,listener:function(a){a.getStatusCode()===a.HTTP_CREATED?c(a.getBody()[e.key]):d(a.getStatusCode()+" "+a.getStatusText())}.bind(this)})}.bind(this))}},update:{value:function(a,b,c){return new Promise(function(d,e){if(!this.stores.hasOwnProperty(a))return void e(new ReferenceError('Unknown store "'+a+'"'));var f=this.stores[a];this.connection.put({uri:f.path+b,headers:this.headers,data:c,listener:function(a){a.getStatusCode()===a.HTTP_OK||a.getStatusCode()===a.HTTP_CREATED?d(a.getBody()):a.getStatusCode()===a.HTTP_NO_CONTENT?d(c):e(a.getStatusCode()+" "+a.getStatusText())}.bind(this)})}.bind(this))}},remove:{value:function(a,b){return new Promise(function(c,d){if(!this.stores.hasOwnProperty(a))return void d(new ReferenceError('Unknown store "'+a+'"'));var e=this.stores[a];this.connection.remove({uri:e.path+b,headers:this.headers,listener:function(a){a.getStatusCode()===a.HTTP_OK||a.getStatusCode()===a.HTTP_ACCEPTED||a.getStatusCode()===a.HTTP_NO_CONTENT?c():d(a.getStatusCode()+" "+a.getStatusText())}})}.bind(this))}},find:{value:function(a,b,c,d){return new Promise(function(e,f){if(!this.stores.hasOwnProperty(a))return void f(new ReferenceError('Unknown store "'+a+'"'));var g=this.stores[a],h=g.path;h+="?"+b+"="+(c instanceof Array?JSON.stringify(c):c),void 0!==d&&(h+="&limit="+d),this.connection.get({uri:encodeURI(h),headers:this.headers,listener:function(a){a.getStatusCode()===a.HTTP_OK?e(a.getBody()):f(a.getStatusCode()+" "+a.getStatusText())}.bind(this)})}.bind(this))}},findAll:{value:function(a){return new Promise(function(b,c){if(!this.stores.hasOwnProperty(a))return void c(new ReferenceError('Unknown store "'+a+'"'));var d=this.stores[a];this.connection.get({uri:d.path,headers:this.headers,listener:function(a){a.getStatusCode()===a.HTTP_OK?b(a.getBody()):c(a.getStatusCode()+" "+a.getStatusText())}.bind(this)})}.bind(this))}}}),namespace("Sy.Storage.Dbal"),Sy.Storage.Dbal.RestFactory=function(){this.meta=[],this.rest=null},Sy.Storage.Dbal.RestFactory.prototype=Object.create(Sy.Storage.Dbal.DriverFactoryInterface.prototype,{setEntitiesMeta:{value:function(a){return this.meta=a,this}},setREST:{value:function(a){if(!(a instanceof Sy.HTTP.REST))throw new TypeError("Invalid rest engine");return this.rest=a,this}},make:{value:function(a,b,c,d){var e=new Sy.Storage.Dbal.Rest;if(e.setURLPattern(d.pattern).setVersion(b).setConnection(this.rest),d.headers instanceof Array)for(var f=d.headers.length;f>g;g++)e.setHeader(d.headers[0],d.headers[1]);for(var g=0,f=this.meta.length;f>g;g++)(0===c.length||-1!==c.indexOf(this.meta[g].alias))&&e.setStore(this.meta[g].alias,this.meta[g].bundle,this.meta[g].name,this.meta[g].uuid);return e}}}),namespace("Sy.Validator"),Sy.Validator.ConstraintInterface=function(){},Sy.Validator.ConstraintInterface.prototype=Object.create(Object.prototype,{hasGroup:{value:function(){}},validateBy:{value:function(){}}}),namespace("Sy.Validator"),Sy.Validator.ConstraintValidatorInterface=function(){},Sy.Validator.ConstraintValidatorInterface.prototype=Object.create(Object.prototype,{setContext:{value:function(){}},validate:{value:function(){}}}),namespace("Sy.Validator"),Sy.Validator.Core=function(){this.rules=null,this.contextFactory=null,this.constraintFactory=null,this.useReflection=!0},Sy.Validator.Core.prototype=Object.create(Object.prototype,{setRulesRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.rules=a,this}},setContextFactory:{value:function(a){if(!(a instanceof Sy.Validator.ExecutionContextFactory))throw new TypeError("Invalid context factory");return this.contextFactory=a,this}},setConstraintFactory:{value:function(a){if(!(a instanceof Sy.Validator.ConstraintFactory))throw new TypeError("Invalid constraint factory");return this.constraintFactory=a,this}},enableReflection:{value:function(){return this.useReflection=!0,this}},disableReflection:{value:function(){return this.useReflection=!1,this}},registerRules:{value:function(a){for(var b in a)a.hasOwnProperty(b)&&this.registerRule(b,a[b]);return this}},registerRule:{value:function(a,b){if(this.rules.has(a))throw new ReferenceError('Rules are already defined for the path "'+a+'"');return void 0===b.getters&&(b.getters={}),void 0===b.properties&&(b.properties={}),this.rules.set(a,b),this}},validateValue:{value:function(a,b,c){c=c||[],b instanceof Array||(b=[b]),c instanceof Array||(c=[c]);for(var d=this.contextFactory.make(),e=0,f=b.length;f>e;e++)d.validate(a,b[e],c);return d.getViolations()}},validate:{value:function(a,b){var c,d,e,f,g=this.resolve(a),h=this.contextFactory.make();b=b||[],b instanceof Array||(b=[b]),h.setObject(a);for(var i in g.getters)if(g.getters.hasOwnProperty(i)){h.setPath(i);for(c in g.getters[i])g.getters[i].hasOwnProperty(c)&&h.validate(a[i](),this.constraintFactory.make(c,g.getters[i][c]),b)}for(var j in g.properties)if(g.properties.hasOwnProperty(j)){h.setPath(j),this.useReflection?(e=new ReflectionObject(a),f="get"+j.charAt(0).toUpperCase()+j.substr(1),d=e.hasMethod(f)?e.getMethod(f).call():e.hasMethod("get")?e.getMethod("get").call(j):e.getProperty(j).getValue()):d=a[j];for(c in g.properties[j])g.properties[j].hasOwnProperty(c)&&h.validate(d,this.constraintFactory.make(c,g.properties[j][c]),b)}return h.getViolations()}},resolve:{value:function(a){var b,c=this.rules.getMapping();for(var d in c)if(c.hasOwnProperty(d)&&(b=objectGetter(d),b&&a instanceof b))return c[d];throw new ReferenceError("No rules defined for the specified object")}}}),namespace("Sy.Validator"),Sy.Validator.AbstractConstraint=function(a){Sy.Validator.ConstraintInterface.call(this,a),this.groups=a.groups instanceof Array?a.groups:[]},Sy.Validator.AbstractConstraint.prototype=Object.create(Sy.Validator.ConstraintInterface.prototype,{hasGroup:{value:function(a){return this.groups instanceof Array&&-1!==this.groups.indexOf(a)}}}),namespace("Sy.Validator"),Sy.Validator.AbstractConstraintValidator=function(){this.context=null},Sy.Validator.AbstractConstraintValidator.prototype=Object.create(Sy.Validator.ConstraintValidatorInterface.prototype,{setContext:{value:function(a){return this.context=a,this}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Blank=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.message=a.message||"This value must be blank"},Sy.Validator.Constraint.Blank.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.BlankValidator"}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.BlankValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.BlankValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Blank))throw new TypeError("Invalid constraint");"string"==typeof a&&0!==a.length&&null!==a&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Callback=function(a){if(a=a||{},Sy.Validator.AbstractConstraint.call(this,a),void 0===a.callback)throw new ReferenceError("Undefined constraint callback");this.callback=a.callback},Sy.Validator.Constraint.Callback.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.CallbackValidator"}},getCallback:{value:function(){return this.callback}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.CallbackValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.CallbackValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Callback))throw new TypeError("Invalid constraint");var c=b.getCallback();this.context.getObject()[c](this.context)}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Choice=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.choices=a.choices||[],this.multiple=!!a.multiple,this.min=parseInt(a.min,10),this.max=parseInt(a.max,10),this.message=a.message||"The value you selected is not a valid choice",this.multipleMessage=a.multipleMessage||"One or more of the given values is invalid",this.minMessage=a.minMessage||"You must select more choices",this.maxMessage=a.maxMessage||"You have selected too many choices",this.callback=a.callback},Sy.Validator.Constraint.Choice.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.ChoiceValidator"}},getChoices:{value:function(){return this.choices}},hasCallback:{value:function(){return!!this.callback}},getCallback:{value:function(){return this.callback}},isMultiple:{value:function(){return this.multiple}},hasMin:{value:function(){return!isNaN(this.min)}},getMin:{value:function(){return this.min}},hasMax:{value:function(){return!isNaN(this.max)}},getMax:{value:function(){return this.max}},getMessage:{value:function(){return this.message}},getMultipleMessage:{value:function(){return this.multipleMessage}},getMinMessage:{value:function(){return this.minMessage}},getMaxMessage:{value:function(){return this.maxMessage}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.ChoiceValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.ChoiceValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Choice))throw new TypeError("Invalid constraint");if(b.isMultiple()&&!(a instanceof Array))throw new TypeError("Array expected");var c;if(b.hasCallback()){var d=b.getCallback();c=this.context.getObject()[d]()}else c=b.getChoices();if(b.isMultiple()){for(var e=0,f=a.length;f>e;e++)-1===c.indexOf(a[e])&&this.context.addViolation(b.getMultipleMessage());b.hasMin()&&a.length<b.getMin()&&this.context.addViolation(b.getMinMessage()),b.hasMax()&&a.length>b.getMax()&&this.context.addViolation(b.getMaxMessage())}else-1===c.indexOf(a)&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Country=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.message=a.message||"This value is not a valid country"},Sy.Validator.Constraint.Country.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.CountryValidator"}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.CountryValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.CountryValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Country))throw new TypeError("Invalid constraint");0===Intl.Collator.supportedLocalesOf(a).length&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Date=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.message=a.message||"The value is not a valid date"},Sy.Validator.Constraint.Date.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.DateValidator"}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.DateValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.DateValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Date))throw new TypeError("Invalid constraint");-1===["",null,void 0].indexOf(a)&&("string"==typeof a?"Invalid Date"===new Date(a).toDateString()&&this.context.addViolation(b.getMessage()):a instanceof Date||this.context.addViolation(b.getMessage()))}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Email=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.message=a.message||"The value is not a valid email"},Sy.Validator.Constraint.Email.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.EmailValidator"}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.EmailValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.EmailValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Email))throw new TypeError("Invalid constraint");if(-1===["",null,void 0].indexOf(a)){var c=new RegExp(/^[a-z\.\-\_]+@[a-z\.\-\_]+\.[a-z]{2,}$/i);c.test(a)||this.context.addViolation(b.getMessage())}}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.EqualTo=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.value=a.value,this.message=a.message||"The value should be equal to "+a.value},Sy.Validator.Constraint.EqualTo.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.EqualToValidator"}},getValue:{value:function(){return this.value}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.EqualToValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.EqualToValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.EqualTo))throw new TypeError("Invalid constraint");a!==b.getValue()&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.False=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.message=a.message||"The value must be false"},Sy.Validator.Constraint.False.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.FalseValidator"}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.FalseValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.FalseValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.False))throw new TypeError("Invalid constraint");a!==!1&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.GreaterThan=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.value=a.value,this.message=a.message||'The value must be greater than "'+a.value+'"'},Sy.Validator.Constraint.GreaterThan.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.GreaterThanValidator"}},getValue:{value:function(){return this.value}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.GreaterThanValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.GreaterThanValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.GreaterThan))throw new TypeError("Invalid constraint");a<=b.getValue()&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.GreaterThanOrEqual=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.value=a.value,this.message=a.message||'The value must be greater than or equal to "'+a.value+'"'},Sy.Validator.Constraint.GreaterThanOrEqual.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.GreaterThanOrEqualValidator"}},getValue:{value:function(){return this.value}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.GreaterThanOrEqualValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.GreaterThanOrEqualValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.GreaterThanOrEqual))throw new TypeError("Invalid constraint");
a<b.getValue()&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Ip=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.port=!!a.port,this.mask=!!a.mask,this.message=a.message||"The value is not a valid IP address"},Sy.Validator.Constraint.Ip.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.IpValidator"}},hasPort:{value:function(){return this.port}},hasMask:{value:function(){return this.mask}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.IpValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.IpValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Ip))throw new TypeError("Invalid constraint");var c=":[0-9]{1,6}",d="\\/(?:[12][0-9]|3[0-2]|[0-9])",e="^(?:[01]?[0-9]?[0-9].|2[0-4][0-9].|25[0-5].){3}(?:[01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5]){1}";b.hasPort()&&(e+=c),b.hasMask()&&(e+=d),e=new RegExp(e+"$"),e.test(a)||this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Length=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.min=a.min,this.max=a.max,this.minMessage=a.minMessage||"The value is too short",this.maxMessage=a.maxMessage||"The value is too long",this.exactMessage=a.exactMessage||"The value must be "+this.min+" long"},Sy.Validator.Constraint.Length.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.LengthValidator"}},getMin:{value:function(){return this.min}},getMax:{value:function(){return this.max}},getMinMessage:{value:function(){return this.minMessage}},getMaxMessage:{value:function(){return this.maxMessage}},getExactMessage:{value:function(){return this.exactMessage}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.LengthValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.LengthValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Length))throw new TypeError("Invalid constraint");if(-1===["",null,void 0].indexOf(a)){if(void 0===a.length)throw new TypeError("The value has no length attribute");b.getMin()===b.getMax()&&a.length!==b.getMin()?this.context.addViolation(b.getExactMessage()):(a.length<b.getMin()&&this.context.addViolation(b.getMinMessage()),a.length>b.getMax()&&this.context.addViolation(b.getMaxMessage()))}}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.LessThan=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.value=a.value,this.message=a.message||'The value must be less than "'+a.value+'"'},Sy.Validator.Constraint.LessThan.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.LessThanValidator"}},getValue:{value:function(){return this.value}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.LessThanValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.LessThanValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.LessThan))throw new TypeError("Invalid constraint");a>=b.getValue()&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.LessThanOrEqual=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.value=a.value,this.message=a.message||'The value must be less than or equal to "'+a.value+'"'},Sy.Validator.Constraint.LessThanOrEqual.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.LessThanOrEqualValidator"}},getValue:{value:function(){return this.value}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.LessThanOrEqualValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.LessThanOrEqualValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.LessThanOrEqual))throw new TypeError("Invalid constraint");a>b.getValue()&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.NotBlank=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.message=a.message||"This value must not be blank"},Sy.Validator.Constraint.NotBlank.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.NotBlankValidator"}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.NotBlankValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.NotBlankValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.NotBlank))throw new TypeError("Invalid constraint");("string"==typeof a&&0===a.length||null===a)&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.NotEqualTo=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.value=a.value,this.message=a.message||"The value must not be equal to "+a.value},Sy.Validator.Constraint.NotEqualTo.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.NotEqualToValidator"}},getValue:{value:function(){return this.value}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.NotEqualToValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.NotEqualToValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.NotEqualTo))throw new TypeError("Invalid constraint");a===b.getValue()&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.NotNull=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.message=a.message||"The value must not be null"},Sy.Validator.Constraint.NotNull.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.NotNullValidator"}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.NotNullValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.NotNullValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.NotNull))throw new TypeError("Invalid constraint");null===a&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.NotUndefined=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.message=a.message||"The value must not be undefined"},Sy.Validator.Constraint.NotUndefined.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.NotUndefinedValidator"}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.NotUndefinedValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.NotUndefinedValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.NotUndefined))throw new TypeError("Invalid constraint");void 0===a&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Null=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.message=a.message||"The value must be null"},Sy.Validator.Constraint.Null.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.NullValidator"}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.NullValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.NullValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Null))throw new TypeError("Invalid constraint");null!==a&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Range=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.min=a.min,this.max=a.max,this.minMessage=a.minMessage||"The value is below the lower bound",this.maxMessage=a.maxMessage||"The value is above the upper bound"},Sy.Validator.Constraint.Range.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.RangeValidator"}},getMin:{value:function(){return this.min}},getMax:{value:function(){return this.max}},getMinMessage:{value:function(){return this.minMessage}},getMaxMessage:{value:function(){return this.maxMessage}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.RangeValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.RangeValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Range))throw new TypeError("Invalid constraint");if("number"!=typeof a||isNaN(a))throw new TypeError("The value is not a numer");a<b.getMin()&&this.context.addViolation(b.getMinMessage()),a>b.getMax()&&this.context.addViolation(b.getMaxMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Regex=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.pattern=a.pattern,this.flags=a.flags,this.message=a.message||"The value do not match the wished pattern"},Sy.Validator.Constraint.Regex.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.RegexValidator"}},getPattern:{value:function(){return this.pattern}},getFlags:{value:function(){return this.flags}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.RegexValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.RegexValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Regex))throw new TypeError("Invalid constraint");try{var c=new RegExp(b.getPattern(),b.getFlags());c.test(a)||this.context.addViolation(b.getMessage())}catch(d){this.context.addViolation(b.getMessage())}}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.True=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.message=a.message||"The value must be true"},Sy.Validator.Constraint.True.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.TrueValidator"}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.TrueValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.TrueValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.True))throw new TypeError("Invalid constraint");a!==!0&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Type=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.type=a.type,this.message=a.message||"The value differs from the specified type"},Sy.Validator.Constraint.Type.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.TypeValidator"}},getType:{value:function(){return this.type}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.TypeValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.TypeValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Type))throw new TypeError("Invalid constraint");var c=b.getType(),d=objectGetter(c)||function(){};typeof a===c||a instanceof d||this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Undefined=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.message=a.message||"The value must be undefined"},Sy.Validator.Constraint.Undefined.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.UndefinedValidator"}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.UndefinedValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.UndefinedValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Undefined))throw new TypeError("Invalid constraint");void 0!==a&&this.context.addViolation(b.getMessage())}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.Url=function(a){a=a||{},Sy.Validator.AbstractConstraint.call(this,a),this.protocols=a.protocols instanceof Array?a.protocols:["http","https"],this.message=a.message||"The value is not a valid url"},Sy.Validator.Constraint.Url.prototype=Object.create(Sy.Validator.AbstractConstraint.prototype,{validatedBy:{value:function(){return"Sy.Validator.Constraint.UrlValidator"}},getProtocols:{value:function(){return this.protocols}},getMessage:{value:function(){return this.message}}}),namespace("Sy.Validator.Constraint"),Sy.Validator.Constraint.UrlValidator=function(){Sy.Validator.AbstractConstraintValidator.call(this)},Sy.Validator.Constraint.UrlValidator.prototype=Object.create(Sy.Validator.AbstractConstraintValidator.prototype,{validate:{value:function(a,b){if(!(b instanceof Sy.Validator.Constraint.Url))throw new TypeError("Invalid constraint");if(-1===["",null,void 0].indexOf(a)){var c=b.getProtocols().join("|"),d=new RegExp("^("+c+")://[a-z-_.]+(?:.[a-z]{2,})?.*$","i");d.test(a)||this.context.addViolation(b.getMessage())}}}}),namespace("Sy.Validator"),Sy.Validator.ConstraintFactory=function(){},Sy.Validator.ConstraintFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{make:{value:function(a,b){var c,d=Sy.Validator.Constraint[a];if(void 0===d)throw new ReferenceError('The constraint "'+a+'" is undefined');if(c=new d(b),!(c instanceof Sy.Validator.ConstraintInterface))throw new TypeError('"'+a+'" is not a valid constraint');return c}}}),namespace("Sy.Validator"),Sy.Validator.ConstraintValidatorFactory=function(){this.validators={}},Sy.Validator.ConstraintValidatorFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{make:{value:function(a){if(!(a instanceof Sy.Validator.ConstraintInterface))throw new TypeError("Invalid constraint");var b,c=a.validatedBy();if(void 0===this.validators[c]){if(b=objectGetter(c),void 0===b)throw new ReferenceError('Undefined validator "'+c+'"');this.validators[c]=new b}return this.validators[c]}}}),namespace("Sy.Validator"),Sy.Validator.ConstraintViolation=function(a){this.message=a.message,this.path=a.path},Sy.Validator.ConstraintViolation.prototype=Object.create(Object.prototype,{toString:{value:function(){return this.message}},getPath:{value:function(){return this.path}},toJSON:{value:function(){return{message:this.message,path:this.path}}}}),namespace("Sy.Validator"),Sy.Validator.ConstraintViolationList=function(){this.violations=[],this.length=0},Sy.Validator.ConstraintViolationList.prototype=Object.create(Object.prototype,{addViolation:{value:function(a){return this.violations.push(new Sy.Validator.ConstraintViolation({message:a})),this.length++,this}},addViolationAt:{value:function(a,b){return this.violations.push(new Sy.Validator.ConstraintViolation({message:b,path:a})),this.length++,this}},forEach:{value:function(a){return this.violations.forEach(a),this}},getViolations:{value:function(){return this.violations}},getViolationsAt:{value:function(a){return this.violations.filter(function(b){return b.getPath()===a}.bind(this))}},toJSON:{value:function(){return this.violations.map(function(a){return a.toJSON()})}}}),namespace("Sy.Validator"),Sy.Validator.ExecutionContext=function(){this.constraintValidatorFactory=null,this.violations=null,this.path=null,this.object=null},Sy.Validator.ExecutionContext.prototype=Object.create(Object.prototype,{setConstraintValidatorFactory:{value:function(a){if(!(a instanceof Sy.Validator.ConstraintValidatorFactory))throw new TypeError("Invalid constraint validator factory");return this.constraintValidatorFactory=a,this}},setViolationList:{value:function(a){if(!(a instanceof Sy.Validator.ConstraintViolationList))throw new TypeError("Invalid constraint violation list");return this.violations=a,this}},getViolations:{value:function(){return this.violations}},setPath:{value:function(a){return this.path=a,this}},setObject:{value:function(a){return this.object=a,this}},getObject:{value:function(){return this.object}},addViolation:{value:function(a){this.path?this.violations.addViolationAt(this.path,a):this.violations.addViolation(a)}},addViolationAt:{value:function(a,b){this.violations.addViolationAt(a,b)}},validate:{value:function(a,b,c){var d=this.constraintValidatorFactory.make(b);if(c instanceof Array&&c.length>0){for(var e=0,f=c.length;f>e;e++)if(b.hasGroup(c[e])){d.setContext(this).validate(a,b);break}}else d.setContext(this).validate(a,b)}}}),namespace("Sy.Validator"),Sy.Validator.ExecutionContextFactory=function(){this.constraintValidatorFactory=null},Sy.Validator.ExecutionContextFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{setConstraintValidatorFactory:{value:function(a){if(!(a instanceof Sy.Validator.ConstraintValidatorFactory))throw new TypeError("Invalid constraint validator factory");return this.constraintValidatorFactory=a,this}},make:{value:function(){var a=new Sy.Validator.ExecutionContext;return a.setConstraintValidatorFactory(this.constraintValidatorFactory).setViolationList(new Sy.Validator.ConstraintViolationList)}}}),namespace("Sy.Form"),Sy.Form.FormInterface=function(){},Sy.Form.FormInterface.prototype=Object.create(Object.prototype,{add:{value:function(){}},setName:{value:function(){}},getName:{value:function(){}},setOptions:{value:function(){}},isValid:{value:function(){}},setObject:{value:function(){}},getObject:{value:function(){}},handle:{value:function(){}},setValidator:{value:function(){}}}),namespace("Sy.Form"),Sy.Form.FormBuilderInterface=function(){},Sy.Form.FormBuilderInterface.prototype=Object.create(Object.prototype,{add:{value:function(){}},setOptions:{value:function(){}},setName:{value:function(){}},setObject:{value:function(){}},getForm:{value:function(){}}}),namespace("Sy.Form"),Sy.Form.FormTypeInterface=function(){},Sy.Form.FormTypeInterface.prototype=Object.create(Object.prototype,{buildForm:{value:function(){}},setDefaultOptions:{value:function(){}},getName:{value:function(){}}}),namespace("Sy.Form"),Sy.Form.Form=function(){this.elements=[],this.name=null,this.config=null,this.validator=null,this.form=null,this.object=null},Sy.Form.Form.prototype=Object.create(Sy.Form.FormInterface.prototype,{add:{value:function(a){return this.elements.push(a),this}},setName:{value:function(a){return this.name=a,this}},getName:{value:function(){return this.name}},setOptions:{value:function(a){if(!(a instanceof Sy.ConfiguratorInterface))throw new TypeError("Invalid configurator");return this.config=a,this}},isValid:{value:function(){if(this.validator)return!this.validator.validate(this.object,this.config.get("validationGroups")).length;if(this.form){for(var a=0,b=this.elements.length;b>a;a++){if(!this.form.hasOwnProperty(this.elements[a]))return!1;if(this.form[this.elements[a]].checkValidity()===!1)return!1}return!0}return!0}},setObject:{value:function(a){return this.object=a,this}},getObject:{value:function(){return this.object}},handle:{value:function(a){if(a?this.form=a:!this.form&&this.getName()&&(this.form=document.querySelector("form[id="+this.getName()+"]")),!(this.form||this.form instanceof HTMLFormElement))throw new ReferenceError("Form element not found");if(this.object){for(var b,c,d=new ReflectionObject(this.object),e=this.elements,f=0,g=e.length;g>f;f++)void 0!==this.form.elements[e[f]]&&(b="set"+e[f].charAt(0).toUpperCase()+e[f].substr(1),c=this.form.elements[e[f]].value,d.hasMethod(b)?d.getMethod(b).call(c):d.hasMethod("set")?d.getMethod("set").call(e[f],c):this.object[e[f]]=c);return this}}},setValidator:{value:function(a){if(!(a instanceof Sy.Validator.Core))throw new TypeError("Invalid validator");return this.validator=a,this}}}),namespace("Sy.Form"),Sy.Form.FormBuilder=function(){this.form=new Sy.Form.Form},Sy.Form.FormBuilder.prototype=Object.create(Sy.Form.FormBuilderInterface.prototype,{add:{value:function(a){return this.form.add(a),this}},setOptions:{value:function(a){return this.form.setOptions(a),this}},setName:{value:function(a){return this.form.setName(a),this}},setObject:{value:function(a){return this.form.setObject(a),this}},getForm:{value:function(){return this.form}},setValidator:{value:function(a){return this.form.setValidator(a),this}}}),namespace("Sy.Form"),Sy.Form.Builder=function(){this.validator=null,this.types={}},Sy.Form.Builder.prototype=Object.create(Object.prototype,{setValidator:{value:function(a){if(!(a instanceof Sy.Validator.Core))throw new TypeError("Invalid validator");return this.validator=a,this}},createFormBuilder:{value:function(a,b){var c=new Sy.Form.FormBuilder,d=new Sy.Configurator;return b&&d.set(b),c.setOptions(d).setObject(a),this.validator&&c.setValidator(this.validator),c}},registerFormType:{value:function(a){if(!(a instanceof Sy.Form.FormTypeInterface))throw new TypeError("Invalid form type");return this.types[a.getName()]=a,this}},createForm:{value:function(a,b,c){if("string"==typeof a){if(!this.types[a])throw new ReferenceError('Form type "'+a+'" is undefined');a=this.types[a]}var d,e=new Sy.Form.FormBuilder,f=new Sy.Configurator;if(e.setName(a.getName()),a.setDefaultOptions(f),c)for(var g in c)c.hasOwnProperty(g)&&f.set(g,c[g]);if(a.buildForm(e,f),e.setOptions(f),!b&&f.has("dataClass")){if(d=objectGetter(f.get("dataClass")),!d)throw new ReferenceError('Data class "'+f.get("dataClass")+'" is undefined');e.setObject(new d)}else if(b&&"object"==typeof b){if(f.has("dataClass")&&!(b instanceof objectGetter(f.get("dataClass"))))throw new TypeError('The object is not an instance of "'+f.get("dataClass")+'"');e.setObject(b)}return this.validator&&e.setValidator(this.validator),e.getForm()}}}),namespace("Sy"),Sy.ConfiguratorInterface=function(){},Sy.ConfiguratorInterface.prototype=Object.create(Object.prototype,{set:{value:function(){}},get:{value:function(){}},has:{value:function(){}},setName:{value:function(){}},getName:{value:function(){}}}),namespace("Sy"),Sy.Configurator=function(){this.name="",this.config={}},Sy.Configurator.prototype=Object.create(Sy.ConfiguratorInterface.prototype,{set:{value:function(a,b){return a instanceof Object&&void 0===b?this.config=_.extend(this.config,a):objectSetter.call(this.config,a,b),this}},get:{value:function(a){var b;return void 0===a?b=this.config:this.has(a)&&(b=objectGetter.call(this.config,a)),b}},has:{value:function(a){for(var b,c=a.split("."),d=this.config;0!==c.length;){if(b=c.shift(),!d.hasOwnProperty(b))return!1;d=d[b]}return!0}},setName:{value:function(a){return this.name=a,this}},getName:{value:function(){return this.name}}}),DOM=function(a){return this===window?new DOM(a):void(this.node=a)},DOM.prototype=Object.create(Object.prototype,{isChildOf:{value:function(a,b){return b=b||this.node,a instanceof HTMLElement?a===b?!0:this.isChildOf(a,b.parentNode):"string"==typeof a?this.matches(a)?!0:this.matches(a,b.parentNode):!1}},matches:{value:function(a,b){return b=b||this.node,b.matches&&b.matches(a)?!0:b.webkitMatchesSelector&&b.webkitMatchesSelector(a)?!0:b.mozMatchesSelector&&b.mozMatchesSelector(a)?!0:b.msMatchesSelector&&b.msMatchesSelector(a)?!0:!1}}}),namespace("Sy.View"),Sy.View.LayoutFactoryInterface=function(){},Sy.View.LayoutFactoryInterface.prototype=Object.create(Sy.FactoryInterface.prototype,{setParser:{value:function(){}},setTemplateEngine:{value:function(){}},setRegistryFactory:{value:function(){}},setListFactory:{value:function(){}},setLayoutWrapper:{value:function(){}}}),namespace("Sy.View"),Sy.View.ListFactoryInterface=function(){},Sy.View.ListFactoryInterface.prototype=Object.create(Sy.FactoryInterface.prototype,{setTemplateEngine:{value:function(){}},setRegistry:{value:function(){}},setListWrapper:{value:function(){}}}),namespace("Sy.View"),Sy.View.TemplateEngineInterface=function(){},Sy.View.TemplateEngineInterface.prototype=Object.create(Object.prototype,{PATTERN:{value:new RegExp(/{{\s?([\w.]+)\s?}}/gim),writable:!1,configurable:!1},render:{value:function(){}}}),namespace("Sy.View"),Sy.View.ViewScreenFactoryInterface=function(){},Sy.View.ViewScreenFactoryInterface.prototype=Object.create(Sy.FactoryInterface.prototype,{setParser:{value:function(){}},setTemplateEngine:{value:function(){}},setRegistryFactory:{value:function(){}},setLayoutFactory:{value:function(){}},setViewScreenWrapper:{value:function(){}}}),namespace("Sy.View.Event"),Sy.View.Event.ViewPortEvent=function(a){if(!(a instanceof Sy.View.ViewScreen))throw new TypeError("Invalid viewscreen");this.viewscreen=a},Sy.View.Event.ViewPortEvent.prototype=Object.create(Object.prototype,{PRE_DISPLAY:{value:"view::on::pre::display",writable:!1},POST_DISPLAY:{value:"view::on::post::display",writable:!1},getViewScreen:{value:function(){return this.viewscreen}}}),namespace("Sy.View"),Sy.View.NodeWrapper=function(){this.engine=null,this.node=null},Sy.View.NodeWrapper.prototype=Object.create(Object.prototype,{setTemplateEngine:{value:function(a){if(!(a instanceof Sy.View.TemplateEngineInterface))throw new TypeError("Invalid template engine");return this.engine=a,this}},setNode:{value:function(a){if(!(a instanceof HTMLElement))throw new TypeError("Invalid dom node");return this.node=a,this}},getNode:{value:function(){return this.node}},render:{value:function(a){return this.engine.render(this.node,a),this}},findOne:{value:function(a){return this.node.querySelector(a)}},find:{value:function(a){return this.node.querySelectorAll(a)}}}),namespace("Sy.View"),Sy.View.Layout=function(){Sy.View.NodeWrapper.call(this),this.name=null,this.lists=null,this.parser=null,this.listFactory=null,this.screen=null},Sy.View.Layout.prototype=Object.create(Sy.View.NodeWrapper.prototype,{setNode:{value:function(a){var b,c;Sy.View.NodeWrapper.prototype.setNode.call(this,a),this.name=a.dataset.syLayout,b=this.parser.getLists(a);for(var d=0,e=b.length;e>d;d++)c=this.listFactory.make(this.screen,this.name,b[d]),this.lists.set(c.getName(),c);return this}},setViewScreenName:{value:function(a){return this.screen=a,this}},getName:{value:function(){return this.name}},setParser:{value:function(a){if(!(a instanceof Sy.View.Parser))throw new TypeError("Invalid parser");return this.parser=a,this}},setListsRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.lists=a,this}},setListFactory:{value:function(a){if(!(a instanceof Sy.View.ListFactoryInterface))throw new TypeError("Invalid list factory");return this.listFactory=a,this}},getLists:{value:function(){return this.lists.get()}},getList:{value:function(a){return this.lists.get(a)}},render:{value:function(a){return this.engine.render(this.node,a,"[data-sy-list]"),this}}}),namespace("Sy.View"),Sy.View.LayoutFactory=function(){this.parser=null,this.engine=null,this.registryFactory=null,this.listFactory=null,this.layouts=null},Sy.View.LayoutFactory.prototype=Object.create(Sy.View.LayoutFactoryInterface.prototype,{setParser:{value:function(a){if(!(a instanceof Sy.View.Parser))throw new TypeError("Invalid parser");return this.parser=a,this}},setTemplateEngine:{value:function(a){if(!(a instanceof Sy.View.TemplateEngineInterface))throw new TypeError("Invalid template engine");return this.engine=a,this}},setRegistryFactory:{value:function(a){if(!(a instanceof Sy.RegistryFactory))throw new TypeError("Invalid registry factory");return this.registryFactory=a,this.layouts=a.make(),this}},setListFactory:{value:function(a){if(!(a instanceof Sy.View.ListFactoryInterface))throw new TypeError("Invalid list factory");return this.listFactory=a,this}},setLayoutWrapper:{value:function(a,b,c){var d=a+"::"+b;if(this.layouts.has(d))throw new ReferenceError('A layout wrapper is already defined with the name "'+d+'"');if(!(c instanceof Sy.View.Layout))throw new TypeError("Invalid layout wrapper");return this.layouts.set(d,c),this}},make:{value:function(a,b){var c,d=a+"::"+b.dataset.syLayout;return c=this.layouts.has(d)?this.layouts.get(d):new Sy.View.Layout,c.setViewScreenName(a).setParser(this.parser).setListFactory(this.listFactory).setListsRegistry(this.registryFactory.make()).setTemplateEngine(this.engine).setNode(b)}}}),namespace("Sy.View"),Sy.View.List=function(){Sy.View.NodeWrapper.call(this),this.name=null,this.elements=[],this.types=[],this.screen=null,this.layout=null},Sy.View.List.prototype=Object.create(Sy.View.NodeWrapper.prototype,{setNode:{value:function(a){var b;Sy.View.NodeWrapper.prototype.setNode.call(this,a),this.name=a.dataset.syList;for(var c=0,d=a.childElementCount;d>c;c++){if(b=a.firstElementChild,this.elements.push(b),a.removeChild(b),this.elements.length>1&&void 0===b.dataset.type)throw new SyntaxError("Multiple list elements require a type to be set");if(void 0!==b.dataset.type){if(-1!==this.types.indexOf(b.dataset.type))throw new SyntaxError("Multiple list elements defined with the same type");this.types.push(b.dataset.type)}}return this}},setViewScreenName:{value:function(a){return this.screen=a,this}},setLayoutName:{value:function(a){return this.layout=a,this}},getName:{value:function(){return this.name}},renderElement:{value:function(a,b){var c,d=b?this.types.indexOf(b):0;if(-1===d)throw new ReferenceError('The type "'+b+'" does not exist for the list "'+this.getName()+'"');return c=this.elements[d].cloneNode(!0),this.engine.render(c,a)}},append:{value:function(a,b){return this.getNode().appendChild(this.renderElement(a,b)),this}},prepend:{value:function(a,b){return this.getNode().insertBefore(this.renderElement(a,b),this.getNode().firstElementChild),this}},render:{value:function(a){for(var b,c,d=this.getNode();d.firstElementChild;)d.removeChild(d.firstElementChild);for(var e=0,f=a.length;f>e;e++)b=a[e],c=b._type,this.append(b,c);return this}}}),namespace("Sy.View"),Sy.View.ListFactory=function(){this.engine=null,this.lists=null},Sy.View.ListFactory.prototype=Object.create(Sy.View.ListFactoryInterface.prototype,{setTemplateEngine:{value:function(a){if(!(a instanceof Sy.View.TemplateEngineInterface))throw new TypeError("Invalid template engine");
return this.engine=a,this}},setRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.lists=a,this}},setListWrapper:{value:function(a,b,c,d){var e=a+"::"+b+"::"+c;if(this.lists.has(e))throw new ReferenceError('A list wrapper is already defined with the name "'+e+'"');if(!(d instanceof Sy.View.List))throw new TypeError("Invalid list wrapper");return this.lists.set(e,d),this}},make:{value:function(a,b,c){var d,e=a+"::"+b+"::"+c.dataset.syList;return d=this.lists.has(e)?this.lists.get(e):new Sy.View.List,d.setViewScreenName(a).setLayoutName(b).setTemplateEngine(this.engine).setNode(c)}}}),namespace("Sy.View"),Sy.View.Manager=function(){this.views=null,this.factory=null},Sy.View.Manager.prototype=Object.create(Object.prototype,{setViewsRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.views=a,this}},setViewScreenFactory:{value:function(a){if(!(a instanceof Sy.View.ViewScreenFactoryInterface))throw new TypeError("Invalid factory");return this.factory=a,this}},setViewScreen:{value:function(a){if(!(a instanceof HTMLElement))throw new TypeError("Html node expected");var b=a.dataset.syView;if(!b&&""===b.trim())throw new SyntaxError('Attribute "data-sy-view" is expected');if(this.views.has(b.trim()))throw new ReferenceError('A view with the name "'+b.trim()+'" already exist');return this.views.set(b.trim(),this.factory.make(a)),this}},getViewScreen:{value:function(a){if(!this.views.has(a))throw new ReferenceError('The view screen "'+a+'" is not registered');return this.views.get(a)}},getViewScreens:{value:function(){return this.views.get()}}}),namespace("Sy.View"),Sy.View.ManagerConfigurator=function(){this.parser=null},Sy.View.ManagerConfigurator.prototype=Object.create(Object.prototype,{setParser:{value:function(a){if(!(a instanceof Sy.View.Parser))throw new TypeError("Invalid parser");this.parser=a}},configure:{value:function(a){if(!(a instanceof Sy.View.Manager))throw new TypeError("Invalid manager");for(var b=this.parser.getViewScreens(),c=0,d=b.length;d>c;c++)a.setViewScreen(b[c]),DOM(b[c]).isChildOf(".viewport")||b[c].parentNode.removeChild(b[c])}}}),namespace("Sy.View"),Sy.View.Parser=function(){},Sy.View.Parser.prototype=Object.create(Object.prototype,{get:{value:function(a,b){return b=b||document.body,b.querySelectorAll(a)}},getViewScreens:{value:function(a){return this.get("[data-sy-view]",a)}},getLayouts:{value:function(a){return this.get("[data-sy-layout]",a)}},getLists:{value:function(a){return this.get("[data-sy-list]",a)}}}),namespace("Sy.View"),Sy.View.TemplateEngine=function(){Sy.View.TemplateEngineInterface.call(this),this.registry=null,this.generator=null},Sy.View.TemplateEngine.prototype=Object.create(Sy.View.TemplateEngineInterface.prototype,{setRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.registry=a,this}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator");return this.generator=a,this}},render:{value:function(a,b,c){if(a.dataset.syUuid||this.register(a),a.dataset.syUuid&&this.registry.has(a.dataset.syUuid)&&(this.renderAllAttributes(a,b),this.renderContent(a,b,c)),a.childElementCount>0)for(var d=0,e=a.childElementCount;e>d;d++)this.render(a.children[d],b,c);return a}},register:{value:function(a){for(var b=this.generator.generate(),c={attributes:{},textContent:null,uuid:b},d=0,e=a.attributes.length;e>d;d++)c.attributes[a.attributes[d].name]=a.getAttribute(a.attributes[d].name);return c.textContent=a.textContent,a.dataset.syUuid=b,this.registry.set(b,c),this}},renderAllAttributes:{value:function(a,b){for(var c=0,d=a.attributes.length;d>c;c++)this.renderAttribute(a,a.attributes[c].name,b);return a}},renderAttribute:{value:function(a,b,c){var d,e=a.dataset.syUuid,f=this.registry.get(e).attributes[b];return f?(d=this.replace(f,c),a.setAttribute(b,d),a):a}},replace:{value:function(a,b){for(;a.match(this.PATTERN);){var c=this.PATTERN.exec(a);null!==c&&c.length>=1&&(a=a.replace(c[0],reflectedObjectGetter.call(b,c[1])||""))}return a}},renderContent:{value:function(a,b,c){if(a.childElementCount>0)return a;if(c&&DOM(a).matches(c))return a;var d,e=a.dataset.syUuid,f=this.registry.get(e).textContent,g=this.PATTERN.exec(f);return g&&(d=objectGetter.call(b,g[1])),d instanceof HTMLElement?(a.removeChild(a.firstElementChild),a.appendChild(d)):a.textContent=this.replace(f,b),a}}}),namespace("Sy.View"),Sy.View.ViewPort=function(){this.node=null,this.manager=null,this.mediator=null,this.current=null},Sy.View.ViewPort.prototype=Object.create(Sy.View.NodeWrapper.prototype,{setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}},setNode:{value:function(a){if(!(a instanceof HTMLElement&&a.classList.contains("viewport")))throw new TypeError("Invalid node");return this.node=a,this}},setViewManager:{value:function(a){if(!(a instanceof Sy.View.Manager))throw new TypeError("Invalid manager");return this.manager=a,this}},getViewManager:{value:function(){return this.manager}},getCurrentViewScreen:{value:function(){return null===this.current&&1===this.node.childElementCount&&(this.current=this.manager.getViewScreen(this.node.firstElementChild.dataset.syView)),this.current}},display:{value:function(a){var b=this.manager.getViewScreen(a),c=b.getNode(),d=new Sy.View.Event.ViewPortEvent(b);switch(this.mediator&&this.mediator.publish(d.PRE_DISPLAY,d),this.node.childElementCount){case 0:this.node.appendChild(c);break;case 1:this.node.replaceChild(c,this.node.children[0]);break;default:throw new Error("Viewport in weird state (more than 1 child)")}return this.current=b,this.mediator&&this.mediator.publish(d.POST_DISPLAY,d),this}}}),namespace("Sy.View"),Sy.View.ViewScreen=function(){Sy.View.NodeWrapper.call(this),this.name="",this.parser=null,this.layouts=null,this.layoutFactory=null},Sy.View.ViewScreen.prototype=Object.create(Sy.View.NodeWrapper.prototype,{setNode:{value:function(a){var b,c;Sy.View.NodeWrapper.prototype.setNode.call(this,a),this.name=a.dataset.syView,b=this.parser.getLayouts(a);for(var d=0,e=b.length;e>d;d++)c=this.layoutFactory.make(this.name,b[d]),this.layouts.set(c.getName(),c);return this}},getName:{value:function(){return this.name}},setParser:{value:function(a){if(!(a instanceof Sy.View.Parser))throw new TypeError("Invalid parser");return this.parser=a,this}},setLayoutsRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.layouts=a,this}},setLayoutFactory:{value:function(a){if(!(a instanceof Sy.View.LayoutFactoryInterface))throw new TypeError("Invalid layout factory");return this.layoutFactory=a,this}},getLayouts:{value:function(){return this.layouts.get()}},getLayout:{value:function(a){return this.layouts.get(a)}},render:{value:function(a){return this.engine.render(this.node,a,"[data-sy-list]"),this}}}),namespace("Sy.View"),Sy.View.ViewScreenFactory=function(){this.parser=null,this.engine=null,this.registryFactory=null,this.layoutFactory=null,this.viewscreens=null},Sy.View.ViewScreenFactory.prototype=Object.create(Sy.View.ViewScreenFactoryInterface.prototype,{setParser:{value:function(a){if(!(a instanceof Sy.View.Parser))throw new TypeError("Invalid parser");return this.parser=a,this}},setTemplateEngine:{value:function(a){if(!(a instanceof Sy.View.TemplateEngineInterface))throw new TypeError("Invalid template engine");return this.engine=a,this}},setRegistryFactory:{value:function(a){if(!(a instanceof Sy.RegistryFactory))throw new TypeError("Invalid registry factory");return this.registryFactory=a,this.viewscreens=a.make(),this}},setLayoutFactory:{value:function(a){if(!(a instanceof Sy.View.LayoutFactoryInterface))throw new TypeError("Invalid layout factory");return this.layoutFactory=a,this}},setViewScreenWrapper:{value:function(a,b){if(this.viewscreens.has(a))throw new ReferenceError('A viewscreen wrapper is already defined with the name "'+a+'"');if(!(b instanceof Sy.View.ViewScreen))throw new TypeError("Invalid viewscreen wrapper");return this.viewscreens.set(a,b),this}},make:{value:function(a){var b,c=a.dataset.syView;return b=this.viewscreens.has(c)?this.viewscreens.get(c):new Sy.View.ViewScreen,b.setParser(this.parser).setLayoutFactory(this.layoutFactory).setLayoutsRegistry(this.registryFactory.make()).setTemplateEngine(this.engine).setNode(a)}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Core=function(){this.initialized={},this.services={},this.loading=[],this.config=null,this.compiler=null,this.compiled=!1,this.propertyAccessor=new Sy.PropertyAccessor(!0)},Sy.ServiceContainer.Core.prototype=Object.create(Object.prototype,{set:{value:function(a){var b,c,d;for(var e in a)if(c=/^@.+$/,a.hasOwnProperty(e)){if(this.services[e]instanceof Sy.ServiceContainer.Definition)throw new TypeError("Service name already used");d=a[e],"string"==typeof d&&c.test(d)?b=new Sy.ServiceContainer.Alias(d.substr(1)):(b=new Sy.ServiceContainer.Definition,b.setConstructor(d.constructor),d.factory instanceof Array&&b.setFactoryService(new Sy.ServiceContainer.Reference(d.factory[0])).setFactoryMethod(d.factory[1]),d.configurator instanceof Array&&b.setConfigurator(new Sy.ServiceContainer.Reference(d.configurator[0])).setConfiguratorMethod(d.configurator[1]),d.calls instanceof Array&&d.calls.forEach(function(a){b.addCall(a[0],a[1])},this),d.hasOwnProperty("private")&&b.setPrivate(),d.tags instanceof Array&&d.tags.forEach(function(a){b.addTag(a.name,a)},this),d.hasOwnProperty("abstract")&&b.setAbstract(),d.hasOwnProperty("prototype")&&b.setPrototype(),d.hasOwnProperty("parent")&&b.setParent(new Sy.ServiceContainer.Reference(d.parent))),this.services[e]=b}return this}},setInstance:{value:function(a,b){return this.initialized[a]=b,this}},get:{value:function(a){if(!this.services.hasOwnProperty(a)&&!this.initialized.hasOwnProperty(a))throw new ReferenceError("Unknown service");if(this.initialized.hasOwnProperty(a))return this.initialized[a];if(this.services[a]instanceof Sy.ServiceContainer.Alias)return this.get(this.services[a].toString());if(0===this.loading.length&&!this.services[a].isPublic())throw new Error("Can't access private service");if(0===this.loading.length&&this.services[a].isAbstract())throw new Error("Can't access abstract service");if(-1!==this.loading.indexOf(a))throw this.loading=[],new Error("Circular referencing");var b,c,d=this.services[a],e=this.propertyAccessor.getValue(window,d.getConstructor());if(this.loading.push(a),d.hasFactory()){if(c=this.get(d.getFactoryService().toString()),b=c[d.getFactoryMethod()].call(c,d.getConstructor()),!(b instanceof e))throw new TypeError("Factory built an object different from the specified type")}else b=new e;return d.getCalls().forEach(function(a){var c=a[0],d=a[1];d.forEach(function(a,b,c){a instanceof Sy.ServiceContainer.Reference?c[b]=this.get(a.toString()):a instanceof Sy.ServiceContainer.Parameter&&(c[b]=this.getParameter(a.toString()))},this),b[c].apply(b,d)},this),d.hasConfigurator()&&this.get(d.getConfigurator().toString())[d.getConfiguratorMethod()](b),d.isPrototype()||(this.initialized[a]=b),this.loading.splice(this.loading.indexOf(a),1),b}},remove:{value:function(a){return delete this.services[a],this}},getServiceIds:{value:function(){return Object.keys(this.services)}},has:{value:function(a){return this.services.hasOwnProperty(a)||this.initialized.hasOwnProperty(a)}},isInitialized:{value:function(a){return this.initialized.hasOwnProperty(a)}},setParameters:{value:function(a){if(!(a instanceof Sy.ConfiguratorInterface))throw new TypeError("Invalid parameters object");return this.config=a,this}},getParameter:{value:function(a){return this.config.get(a)}},hasParameter:{value:function(a){return this.config.has(a)}},setParameter:{value:function(a,b){return this.config.set(a,b),this}},getDefinition:{value:function(a){if(this.compiled===!0)throw new ReferenceError("Can't access a definition once container compiled");return this.services[a]}},setDefinition:{value:function(a,b){if(!(b instanceof Sy.ServiceContainer.Definition))throw new TypeError("Invalid definition");return this.services[a]=b,this}},setCompiler:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Compiler))throw new TypeError("Invalid compiler");return this.compiler=a,this}},addPass:{value:function(a,b){return this.compiler.addPass(a,b),this}},compile:{value:function(){this.compiler.compile(this),Object.freeze(this.services),this.compiled=!0}},findTaggedServiceIds:{value:function(a){var b=this.getServiceIds(),c=[];return b.forEach(function(b){if(this.services[b]instanceof Sy.ServiceContainer.Definition){var d=this.services[b].getTag(a);d.length>0&&c.push({id:b,tags:d})}},this),c}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Alias=function(a){this.id=a},Sy.ServiceContainer.Alias.prototype=Object.create(Object.prototype,{toString:{value:function(){return this.id}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Compiler=function(){this.beforeOpti=[],this.opti=[new Sy.ServiceContainer.CompilerPass.ResolveParameterPlaceholder,new Sy.ServiceContainer.CompilerPass.ResolveReferencePlaceholder,new Sy.ServiceContainer.CompilerPass.ApplyParentDefinition],this.beforeRm=[],this.rm=[new Sy.ServiceContainer.CompilerPass.RemoveAbstractDefinitions],this.afterRm=[]},Sy.ServiceContainer.Compiler.prototype=Object.create(Object.prototype,{addPass:{value:function(a,b){if(!(a instanceof Sy.ServiceContainer.CompilerPassInterface))throw new TypeError("Invalid compiler pass");switch(b){case a.BEFORE_OPTIMIZATION:this.beforeOpti.push(a);break;case a.OPTIMIZE:this.opti.push(a);break;case a.BEFORE_REMOVING:this.beforeRm.push(a);break;case a.REMOVE:this.rm.push(a);break;case a.AFTER_REMOVING:this.afterRm.push(a);break;default:this.beforeOpti.push(a)}}},compile:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Core))throw new TypeError("Invalid service container");this.beforeOpti.forEach(function(b){b.process(a)},this),this.opti.forEach(function(b){b.process(a)},this),this.beforeRm.forEach(function(b){b.process(a)},this),this.rm.forEach(function(b){b.process(a)},this),this.afterRm.forEach(function(b){b.process(a)},this)}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.CompilerPassInterface=function(){},Sy.ServiceContainer.CompilerPassInterface.prototype=Object.create(Object.prototype,{BEFORE_OPTIMIZATION:{value:"before_optimization",writable:!1},OPTIMIZE:{value:"optimize",writable:!1},BEFORE_REMOVING:{value:"before_removing",writable:!1},REMOVE:{value:"remove",writable:!1},AFTER_REMOVING:{value:"after_removing",writable:!1},process:{value:function(){}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Definition=function(){this.constructor=null,this.factoryService=null,this.factoryMethod=null,this.configuratorService=null,this.configuratorMethod=null,this.calls=[],this.public=!0,this.tags=[],this.abstract=!1,this.parent=null,this.proto=!1},Sy.ServiceContainer.Definition.prototype=Object.create(Object.prototype,{setConstructor:{value:function(a){return this.constructor=a,this}},getConstructor:{value:function(){return this.constructor}},setFactoryService:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Reference))throw new TypeError("Invalid reference");return this.factoryService=a,this}},getFactoryService:{value:function(){return this.factoryService}},setFactoryMethod:{value:function(a){return this.factoryMethod=a,this}},getFactoryMethod:{value:function(){return this.factoryMethod}},hasFactory:{value:function(){return!!this.factoryService&&!!this.factoryMethod}},setConfigurator:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Reference))throw new TypeError("Invalid reference");return this.configuratorService=a,this}},getConfigurator:{value:function(){return this.configuratorService}},setConfiguratorMethod:{value:function(a){return this.configuratorMethod=a,this}},getConfiguratorMethod:{value:function(){return this.configuratorMethod}},hasConfigurator:{value:function(){return!!this.configuratorService&&!!this.configuratorMethod}},addCall:{value:function(a,b,c){var d=c?"unshift":"push";return this.calls[d]([a,b]),this}},getCalls:{value:function(){return this.calls}},setPrivate:{value:function(){return this.public=!1,this}},isPublic:{value:function(){return this.public}},addTag:{value:function(a,b){return b=b||{},this.tags.push([a,b]),this}},getTags:{value:function(){return this.tags}},getTag:{value:function(a){return this.tags.filter(function(b){return b[0]===a},this)}},setAbstract:{value:function(){return this.abstract=!0,this}},isAbstract:{value:function(){return this.abstract}},setParent:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Reference))throw new TypeError("Invalid reference");return this.parent=a,this}},hasParent:{value:function(){return!!this.parent}},getParent:{value:function(){return this.parent}},setPrototype:{value:function(){return this.proto=!0,this}},isPrototype:{value:function(){return this.proto}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Parameter=function(a){this.id=a},Sy.ServiceContainer.Parameter.prototype=Object.create(Object.prototype,{toString:{value:function(){return this.id}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Reference=function(a){this.id=a},Sy.ServiceContainer.Reference.prototype=Object.create(Object.prototype,{toString:{value:function(){return this.id}}}),namespace("Sy.ServiceContainer.CompilerPass"),Sy.ServiceContainer.CompilerPass.ApplyParentDefinition=function(){},Sy.ServiceContainer.CompilerPass.ApplyParentDefinition.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){a.getServiceIds().forEach(function(a){var b,c,d=this.getDefinition(a);if(d instanceof Sy.ServiceContainer.Definition&&d.hasParent()){b=this.getDefinition(d.getParent().toString()),b.hasFactory()&&!d.hasFactory()&&(d.setFactoryService(b.getFactoryService()),d.setFactoryMethod(b.getFactoryMethod())),b.hasConfigurator()&&!d.hasConfigurator()&&(d.setConfigurator(b.getConfigurator()),d.setConfiguratorMethod(b.getConfiguratorMethod())),c=b.getCalls();for(var e=c.length-1;e>=0;e--)d.addCall(c[e][0],c[e][1],!0)}},a)}}}),namespace("Sy.ServiceContainer.CompilerPass"),Sy.ServiceContainer.CompilerPass.RemoveAbstractDefinitions=function(){},Sy.ServiceContainer.CompilerPass.RemoveAbstractDefinitions.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){a.getServiceIds().forEach(function(a){var b=this.getDefinition(a);b instanceof Sy.ServiceContainer.Definition&&b.isAbstract()&&this.remove(a)},a)}}}),namespace("Sy.ServiceContainer.CompilerPass"),Sy.ServiceContainer.CompilerPass.ResolveParameterPlaceholder=function(){},Sy.ServiceContainer.CompilerPass.ResolveParameterPlaceholder.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){a.getServiceIds().forEach(function(a){var b,c=this.getDefinition(a),d=/^%[a-zA-Z-_.]+%$/;if(c instanceof Sy.ServiceContainer.Definition){b=c.getCalls();for(var e=0,f=b.length;f>e;e++)for(var g=0,h=b[e][1].length;h>g;g++)d.test(b[e][1][g])&&(b[e][1][g]=new Sy.ServiceContainer.Parameter(b[e][1][g].substring(1,b[e][1][g].length-1)))}},a)}}}),namespace("Sy.ServiceContainer.CompilerPass"),Sy.ServiceContainer.CompilerPass.ResolveReferencePlaceholder=function(){},Sy.ServiceContainer.CompilerPass.ResolveReferencePlaceholder.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){a.getServiceIds().forEach(function(a){var b,c=this.getDefinition(a),d=/^@.+$/;if(c instanceof Sy.ServiceContainer.Definition){b=c.getCalls();for(var e=0,f=b.length;f>e;e++)for(var g=0,h=b[e][1].length;h>g;g++)d.test(b[e][1][g])&&(b[e][1][g]=new Sy.ServiceContainer.Reference(b[e][1][g].substr(1)))}},a)}}}),namespace("Sy.FrameworkBundle.CompilerPass"),Sy.FrameworkBundle.CompilerPass.EventSubscriberPass=function(){},Sy.FrameworkBundle.CompilerPass.EventSubscriberPass.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){var b=a.get("sy::core::mediator");a.findTaggedServiceIds("event.subscriber").forEach(function(c){var d,e=a.get(c.id);if(!(e instanceof Sy.EventSubscriberInterface))throw new TypeError("Invalid event subscriber");d=e.getSubscribedEvents();for(var f in d)d.hasOwnProperty(f)&&b.subscribe({channel:f,fn:e[d[f].method],context:e,priority:e[d[f].priority],async:e[d[f].async]})},this)}}}),namespace("Sy.FormBundle.CompilerPass"),Sy.FormBundle.CompilerPass.FormTypePass=function(){},Sy.FormBundle.CompilerPass.FormTypePass.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){var b=a.getDefinition("sy::core::form");a.findTaggedServiceIds("form.type").forEach(function(a){b.addCall("registerFormType",["@"+a.id])},this)}}}),namespace("Sy.StorageBundle.CompilerPass"),Sy.StorageBundle.CompilerPass.RegisterDriverFactoryPass=function(){},Sy.StorageBundle.CompilerPass.RegisterDriverFactoryPass.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){var b=a.getDefinition("sy::core::storage::dbal::factory");a.findTaggedServiceIds("storage.driver_factory").forEach(function(a){for(var c=0,d=a.tags.length;d>c;c++)a.tags[c][1].alias&&b.addCall("setDriverFactory",[a.tags[c][1].alias,"@"+a.id])},this)}}}),namespace("Sy.ViewBundle.CompilerPass"),Sy.ViewBundle.CompilerPass.RegisterLayoutWrapperPass=function(){},Sy.ViewBundle.CompilerPass.RegisterLayoutWrapperPass.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){var b=a.getDefinition("sy::core::view::factory::layout");a.findTaggedServiceIds("view.layout").forEach(function(a){for(var c=0,d=a.tags.length;d>c;c++)a.tags[c][1].alias&&a.tags[c][1].viewscreen&&b.addCall("setLayoutWrapper",[a.tags[c][1].viewscreen,a.tags[c][1].alias,"@"+a.id])})}}}),namespace("Sy.ViewBundle.CompilerPass"),Sy.ViewBundle.CompilerPass.RegisterListWrapperPass=function(){},Sy.ViewBundle.CompilerPass.RegisterListWrapperPass.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){var b=a.getDefinition("sy::core::view::factory::list");a.findTaggedServiceIds("view.list").forEach(function(a){for(var c=0,d=a.tags.length;d>c;c++)a.tags[c][1].alias&&a.tags[c][1].viewscreen&&a.tags[c][1].layout&&b.addCall("setListWrapper",[a.tags[c][1].viewscreen,a.tags[c][1].layout,a.tags[c][1].alias,"@"+a.id])})}}}),namespace("Sy.ViewBundle.CompilerPass"),Sy.ViewBundle.CompilerPass.RegisterViewScreenWrapperPass=function(){},Sy.ViewBundle.CompilerPass.RegisterViewScreenWrapperPass.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){var b=a.getDefinition("sy::core::view::factory::viewscreen");a.findTaggedServiceIds("view.viewscreen").forEach(function(a){for(var c=0,d=a.tags.length;d>c;c++)a.tags[c][1].alias&&b.addCall("setViewScreenWrapper",[a.tags[c][1].alias,"@"+a.id])})}}}),namespace("Sy.ViewBundle.CompilerPass"),Sy.ViewBundle.CompilerPass.RegisterSubscriberPass=function(){},Sy.ViewBundle.CompilerPass.RegisterSubscriberPass.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){var b=a.getDefinition("sy::core::view::subscriber::appstate");a.hasParameter("routes")&&b.addTag("event.subscriber",{name:"event.subscriber"})}}}),namespace("Sy.AppStateBundle.CompilerPass"),Sy.AppStateBundle.CompilerPass.RegisterRoutesPass=function(){},Sy.AppStateBundle.CompilerPass.RegisterRoutesPass.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){var b=a.getDefinition("sy::core::appstate::routeprovider"),c=a.getParameter("routes");if(c)for(var d in c)c.hasOwnProperty(d)&&b.addCall("setRoute",[d,c[d].path,c[d].parameters,c[d].requirements])}}}),namespace("Sy"),Sy.Translator=function(){this.currentLanguage=null,this.languages=null,this.stateRegistryFactory=null},Sy.Translator.prototype=Object.create(Object.prototype,{setRegistry:{value:function(a){if(!(a instanceof Sy.Registry))throw new TypeError("Invalid registry");return this.languages=a,this}},setStateRegistryFactory:{value:function(a){if(!(a instanceof Sy.StateRegistryFactory))throw new TypeError("Invalid state registry factory");return this.stateRegistryFactory=a,this}},setLanguage:{value:function(a){return this.currentLanguage=a,this}},registerTranslation:{value:function(a,b,c,d){return this.languages.has(a)||this.languages.set(a,this.stateRegistryFactory.make()),this.languages.get(a).set(b,c,d),this}},registerTranslations:{value:function(a,b){for(var c=0,d=b.length;d>c;c++)this.registerTranslation(a,b[c].domain||"root",b[c].key,b[c].translation);return this}},translate:{value:function(a,b,c){var d=c||this.currentLanguage;return b=b||"root",this.languages.has(d)&&this.languages.get(d).has(b,a)?this.languages.get(d).get(b,a):a}}}),namespace("Sy.AppState"),Sy.AppState.Route=function(){this.name=null,this.path=null,this.parameters={},this.requirements={},this.regex=null},Sy.AppState.Route.prototype=Object.create(Object.prototype,{setName:{value:function(a){return this.name=a,this}},getName:{value:function(){return this.name}},setPath:{value:function(a){return this.path=a,this}},getPath:{value:function(){return this.path}},setParameters:{value:function(a){return Object.isFrozen(this.parameters)||(this.parameters=a),Object.freeze(this.parameters),this}},getParameters:{value:function(){return this.parameters}},hasParameter:{value:function(a){return this.parameters.hasOwnProperty(a)}},getParameter:{value:function(a){return this.parameters[a]}},setRequirements:{value:function(a){return Object.isFrozen(this.requirements)||(this.requirements=a),Object.freeze(this.requirements),this}},getRequirements:{value:function(){return this.requirements}},getRequirement:{value:function(a){return this.requirements[a]}},hasRequirement:{value:function(a){return this.requirements.hasOwnProperty(a)}},buildRegex:{value:function(){var a=this.path.match(new RegExp(/{\w+}/g));return this.regex="^"+this.path+"$",a instanceof Array&&a.forEach(function(a){var b=a.substring(1,a.length-1);this.regex=this.hasRequirement(b)?this.regex.replace(a,"("+this.getRequirement(b)+")"):this.regex.replace(a,"(.+)")}.bind(this)),this}},matches:{value:function(a){return new RegExp(this.regex).test(a)}},getVariables:{value:function(a){var b=this.path.match(new RegExp(/{\w+}/g)),c=a.match(new RegExp(this.regex)),d={};if(!b)return d;b=b.map(function(a){return a.substring(1,a.length-1)}),c=c.filter(function(b){return b!==a});for(var e=0,f=b.length;f>e;e++)d[b[e]]=c[e];return d}}}),namespace("Sy.AppState"),Sy.AppState.Router=function(){this.provider=null},Sy.AppState.Router.prototype=Object.create(Object.prototype,{setRouteProvider:{value:function(a){if(!(a instanceof Sy.AppState.RouteProvider))throw new TypeError("Invalid route provider");return this.provider=a,this}},generate:{value:function(a,b){if(!this.provider.hasRoute(a))throw new ReferenceError('Unknown route "'+a+'"');var c=this.provider.getRoute(a),d=c.getParameters(),e=c.getPath();b=b||{};for(var a in d)d.hasOwnProperty(a)&&!b.hasOwnProperty(a)&&(b[a]=d[a]);for(var a in b)if(b.hasOwnProperty(a)){if(c.hasRequirement(a)&&!new RegExp("^"+c.getRequirement(a)+"$").test(b[a]))throw new SyntaxError('Variable "'+a+'" doesn\'t fulfill its requirement for the route "'+c.getName()+'"');e=e.replace("{"+a+"}",b[a])}return e}}}),namespace("Sy.AppState"),Sy.AppState.RouteProvider=function(){this.routes=null},Sy.AppState.RouteProvider.prototype=Object.create(Object.prototype,{setRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.routes=a,this}},setRoute:{value:function(a,b,c,d){var e=new Sy.AppState.Route;return e.setName(a).setPath(b),"object"==typeof c&&e.setParameters(c),"object"==typeof d&&e.setRequirements(d),e.buildRegex(),this.routes.set(a,e),this}},getRoute:{value:function(a){return this.routes.get(a)}},getRoutes:{value:function(){return this.routes.get()}},hasRoute:{value:function(a){return this.routes.has(a)}}}),namespace("Sy.AppState"),Sy.AppState.Core=function(){this.matcher=null,this.provider=null,this.generator=null,this.mediator=null,this.handler=null,this.currentState=null},Sy.AppState.Core.prototype=Object.create(Object.prototype,{setUrlMatcher:{value:function(a){if(!(a instanceof Sy.AppState.UrlMatcher))throw new TypeError("Invalid url matcher");return this.matcher=a,this}},setRouteProvider:{value:function(a){if(!(a instanceof Sy.AppState.RouteProvider))throw new TypeError("Invalid route provider");return this.provider=a,this}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator");return this.generator=a,this}},setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}},setStateHandler:{value:function(a){if(!(a instanceof Sy.AppState.StateHandler))throw new TypeError("Invalid state handler");return this.handler=a,this}},boot:{value:function(){try{history.state?(this.currentState=this.handler.getState(history.state.uuid),this.currentState||this.createState()):this.createState(),this.dispatchEvent()}catch(a){this.dispatchRouteNotFound()}return window.addEventListener("popstate",this.listenPop.bind(this),!1),this}},listenPop:{value:function(a){try{a.state?(this.currentState=this.handler.getState(a.state.uuid),this.currentState||this.createState()):this.createState(),this.dispatchEvent()}catch(b){this.dispatchRouteNotFound()}}},dispatchEvent:{value:function(){var a=new Sy.AppState.AppStateEvent;a.setState(this.currentState).setRoute(this.provider.getRoute(this.currentState.getRoute())),this.mediator.publish(a.KEY,a)}},dispatchRouteNotFound:{value:function(){var a=new Sy.AppState.RouteNotFoundEvent;a.setUrl(this.getUrl()),this.mediator.publish(a.KEY,a)}},createState:{value:function(){var a=this.getUrl(),b=this.matcher.match(a);this.currentState=this.handler.createState(this.generator.generate(),b.getName(),b.getVariables(a)),this.updateBrowserState()}},updateBrowserState:{value:function(){history.replaceState(this.currentState.toJSON(),document.title)}},getUrl:{value:function(){return location.hash.substr(1)||"/"}},getCurrentState:{value:function(){return this.currentState}}}),namespace("Sy.AppState"),Sy.AppState.UrlMatcher=function(){this.provider=null},Sy.AppState.UrlMatcher.prototype=Object.create(Object.prototype,{setRouteProvider:{value:function(a){if(!(a instanceof Sy.AppState.RouteProvider))throw new TypeError("Invalid route provider");return this.provider=a,this}},match:{value:function(a){for(var b,c=this.provider.getRoutes(),d=0,e=c.length;e>d;d++)if(c[d].matches(a)){b=c[d];break}if(!b)throw new ReferenceError('No route found for the url "'+a+'"');return b}}}),namespace("Sy.AppState"),Sy.AppState.State=function(){this.uuid=null,this.route=null,this.variables={}},Sy.AppState.State.prototype=Object.create(Object.prototype,{setUUID:{value:function(a){return this.uuid=a,this}},getUUID:{value:function(){return this.uuid}},setRoute:{value:function(a){return this.route=a,this}},getRoute:{value:function(){return this.route}},setVariables:{value:function(a){return this.variables=a,this}},getVariables:{value:function(){return this.variables}},toJSON:{value:function(){return{uuid:this.uuid,route:this.route,variables:this.variables}}}}),namespace("Sy.AppState"),Sy.AppState.StateHandler=function(){this.storage=localStorage,this.key="sy::history",this.states=[],this.loadStates(),window.addEventListener("beforeunload",this.saveHistory.bind(this),!1)},Sy.AppState.StateHandler.prototype=Object.create(Object.prototype,{loadStates:{value:function(){var a=this.storage.getItem(this.key);a&&(a=JSON.parse(a),a.forEach(function(a){this.states.push(this.createState(a.uuid,a.route,a.variables))
}.bind(this)))}},createState:{value:function(a,b,c){var d=new Sy.AppState.State;return this.states.push(d),d.setUUID(a).setRoute(b).setVariables(c)}},getState:{value:function(a){for(var b=0,c=this.states.length;c>b;b++)if(this.states[b].getUUID()===a)return this.states[b]}},saveHistory:{value:function(){this.storage.setItem(this.key,JSON.stringify(this.states.splice(-10)))}}}),namespace("Sy.AppState"),Sy.AppState.AppStateEvent=function(){this.state=null,this.route=null},Sy.AppState.AppStateEvent.prototype=Object.create(Object.prototype,{KEY:{value:"appstate.change",writable:!1},setState:{value:function(a){if(!(a instanceof Sy.AppState.State))throw new TypeError("Invalid state object");return this.state=a,this}},getState:{value:function(){return this.state}},setRoute:{value:function(a){if(!(a instanceof Sy.AppState.Route))throw new TypeError("Invalid route");return this.route=a,this}},getRoute:{value:function(){return this.route}}}),namespace("Sy.AppState"),Sy.AppState.RouteNotFoundEvent=function(){this.url=null},Sy.AppState.RouteNotFoundEvent.prototype=Object.create(Object.prototype,{KEY:{value:"appstate.routenotfound",writable:!1},setUrl:{value:function(a){return this.url=a,this}},getUrl:{value:function(){return this.url}}});