/*! sy#0.5.0 - 2014-04-12 */function namespace(a){var b=null,c=this;if("string"==typeof a)b=a.split(".");else{if(!(a instanceof Array&&a.length>0))return c;b=a}return c[b[0]]=c[b[0]]||{},a=b.shift(),namespace.call(c[a],b)}function objectSetter(a,b){var c="",d="",e=this,f=a.lastIndexOf(".");f>=0?(d=a.substr(f+1),c=a.substr(0,f),e=namespace.call(e,c)):d=a,e[d]=b}function objectGetter(a){var b=null,c=this;if("string"==typeof a){if(b=a.split("."),1===b.length)return c[a]}else{if(!(a instanceof Array&&a.length>1))return a instanceof Array&&1===a.length?c[a[0]]:void 0;b=a}return a=b.shift(),objectGetter.call(c[a],b)}function capitalize(a){return a.substr(0,1).toUpperCase()+a.substr(1)}function reflectedObjectGetter(a){var b=null,c=this;if("string"==typeof a){if(b=a.split("."),1===b.length)return getReflectedValue.call(c,a)}else{if(!(a instanceof Array&&a.length>1))return a instanceof Array&&1===a.length?getReflectedValue.call(c,a[0]):void 0;b=a}return a=b.shift(),reflectedObjectGetter.call(getReflectedValue.call(c,a),b)}function getReflectedValue(a){var b=new ReflectionObject(this);return b.hasMethod("get"+capitalize(a))?b.getMethod("get"+capitalize(a)).call():b.hasMethod("get")?b.getMethod("get").call(a):b.hasProperty(a)?b.getProperty(a).getValue():void 0}namespace("Sy"),Sy.ConfiguratorInterface=function(){this.name=""},Sy.ConfiguratorInterface.prototype=Object.create(Object.prototype,{set:{value:function(){return this}},get:{value:function(){return value}},has:{value:function(){}},setName:{value:function(a){return this.name=a,this}},getName:{value:function(){return this.name}}}),namespace("Sy"),Sy.ControllerInterface=function(){this.container={},this.mediator={}},Sy.ControllerInterface.prototype=Object.create(Object.prototype,{listen:{value:function(){}},broadcast:{value:function(){}},"new":{value:function(){}},sleep:{value:function(){}},wakeup:{value:function(){}},destroy:{value:function(){}},setMediator:{value:function(){}},setServiceContainer:{value:function(){}},setBundle:{value:function(){}},setViewScreen:{value:function(){}},init:{value:function(){}}}),namespace("Sy"),Sy.EntityInterface=function(){},Sy.EntityInterface.prototype=Object.create(Object.prototype,{set:{value:function(){return this}},get:{value:function(){}},register:{value:function(){}},lock:{value:function(){}}}),namespace("Sy"),Sy.FactoryInterface=function(){},Sy.FactoryInterface.prototype=Object.create(Object.prototype,{make:{value:function(){}}}),namespace("Sy.HTTP"),Sy.HTTP.RequestInterface=function(){},Sy.HTTP.RequestInterface.prototype=Object.create(Object.prototype,{setURI:{value:function(){}},getURI:{value:function(){}},setMethod:{value:function(){}},getMethod:{value:function(){}},setData:{value:function(){}},getData:{value:function(){}},setHeader:{value:function(){}},getHeader:{value:function(){}},setListener:{value:function(){}},getListener:{value:function(){}},setType:{value:function(){}},getType:{value:function(){}}}),namespace("Sy.HTTP"),Sy.HTTP.ResponseInterface=function(){},Sy.HTTP.ResponseInterface.prototype=Object.create(Object.prototype,{HTTP_CONTINUE:{value:100,writable:!1},HTTP_SWITCHING_PROTOCOLS:{value:101,writable:!1},HTTP_PROCESSING:{value:102,writable:!1},HTTP_OK:{value:200,writable:!1},HTTP_CREATED:{value:201,writable:!1},HTTP_ACCEPTED:{value:202,writable:!1},HTTP_NON_AUTHORITATIVE_INFORMATION:{value:203,writable:!1},HTTP_NO_CONTENT:{value:204,writable:!1},HTTP_RESET_CONTENT:{value:205,writable:!1},HTTP_PARTIAL_CONTENT:{value:206,writable:!1},HTTP_MULTI_STATUS:{value:207,writable:!1},HTTP_ALREADY_REPORTED:{value:208,writable:!1},HTTP_IM_USED:{value:226,writable:!1},HTTP_MULTIPLE_CHOICES:{value:300,writable:!1},HTTP_MOVED_PERMANENTLY:{value:301,writable:!1},HTTP_FOUND:{value:302,writable:!1},HTTP_SEE_OTHER:{value:303,writable:!1},HTTP_NOT_MODIFIED:{value:304,writable:!1},HTTP_USE_PROXY:{value:305,writable:!1},HTTP_RESERVED:{value:306,writable:!1},HTTP_TEMPORARY_REDIRECT:{value:307,writable:!1},HTTP_PERMANENTLY_REDIRECT:{value:308,writable:!1},HTTP_BAD_REQUEST:{value:400,writable:!1},HTTP_UNAUTHORIZED:{value:401,writable:!1},HTTP_PAYMENT_REQUIRED:{value:402,writable:!1},HTTP_FORBIDDEN:{value:403,writable:!1},HTTP_NOT_FOUND:{value:404,writable:!1},HTTP_METHOD_NOT_ALLOWED:{value:405,writable:!1},HTTP_NOT_ACCEPTABLE:{value:406,writable:!1},HTTP_PROXY_AUTHENTICATION_REQUIRED:{value:407,writable:!1},HTTP_REQUEST_TIMEOUT:{value:408,writable:!1},HTTP_CONFLICT:{value:409,writable:!1},HTTP_GONE:{value:410,writable:!1},HTTP_LENGTH_REQUIRED:{value:411,writable:!1},HTTP_PRECONDITION_FAILED:{value:412,writable:!1},HTTP_REQUEST_ENTITY_TOO_LARGE:{value:413,writable:!1},HTTP_REQUEST_URI_TOO_LONG:{value:414,writable:!1},HTTP_UNSUPPORTED_MEDIA_TYPE:{value:415,writable:!1},HTTP_REQUESTED_RANGE_NOT_SATISFIABLE:{value:416,writable:!1},HTTP_EXPECTATION_FAILED:{value:417,writable:!1},HTTP_I_AM_TEAPOT:{value:418,writable:!1},HTTP_UNPROCESSABLE_ENTITY:{value:422,writable:!1},HTTP_LOCKED:{value:423,writable:!1},HTTP_FAILED_DEPENDENCY:{value:424,writable:!1},HTTP_RESERVED_FOR_WEBDAV_ADVANCED_COLLECTIONS_EXPIRED_PROPOSAL:{value:425,writable:!1},HTTP_UPGRADE_REQUIRED:{value:426,writable:!1},HTTP_PRECONDITION_REQURED:{value:428,writable:!1},HTTP_TOO_MANY_REQUESTS:{value:429,writable:!1},HTTP_REQUEST_HEADER_FIELDS_TOO_LARGE:{value:431,writable:!1},HTTP_INTERNAL_SERVOR_ERROR:{value:500,writable:!1},HTTP_NOT_IMPLEMENTED:{value:501,writable:!1},HTTP_BAD_GATEWAY:{value:502,writable:!1},HTTP_SERVICE_UNAVAILABLE:{value:503,writable:!1},HTTP_GATEWAY_TIMEOUT:{value:504,writable:!1},HTTP_VERSION_NOT_SUPPORTED:{value:505,writable:!1},HTTP_VARIANT_ALSO_NEGOTIATES_EXPERIMENTAL:{value:506,writable:!1},HTTP_INSUFFICIENT_STORAGE:{value:507,writable:!1},HTTP_LOOP_DETECTED:{value:508,writable:!1},HTTP_NOT_EXTENDED:{value:510,writable:!1},HTTP_NETWORK_AUTHENTICATION_REQUIRED:{value:511,writable:!1},setStatusCode:{value:function(){}},getStatusCode:{value:function(){}},setStatusText:{value:function(){}},getStatusText:{value:function(){}},setHeaders:{value:function(){}},getHeader:{value:function(){}},setBody:{value:function(){}},getBody:{value:function(){}}}),namespace("Sy.Lib.Generator"),Sy.Lib.Generator.Interface=function(){},Sy.Lib.Generator.Interface.prototype=Object.create(Object.prototype,{generate:{value:function(){}}}),namespace("Sy.Lib.Logger.Handler"),Sy.Lib.Logger.Handler.Interface=function(){},Sy.Lib.Logger.Handler.Interface.prototype=Object.create(Object.prototype,{handle:{value:function(){}},isHandling:{value:function(){}}}),namespace("Sy.Lib.Logger"),Sy.Lib.Logger.Interface=function(){},Sy.Lib.Logger.Interface.prototype=Object.create(Object.prototype,{LOG:{value:"log",writable:!1},DEBUG:{value:"debug",writable:!1},ERROR:{value:"error",writable:!1},INFO:{value:"info",writable:!1},setName:{value:function(){return this}},log:{value:function(){return this}},debug:{value:function(){return this}},error:{value:function(){return this}},info:{value:function(){return this}},setHandler:{value:function(){return this}},isHandlingLevel:{value:function(){}},removeHandler:{value:function(){}},lock:{value:function(){}}}),namespace("Sy"),Sy.StateRegistryInterface=function(){},Sy.StateRegistryInterface.prototype=Object.create(Object.prototype,{set:{value:function(){}},has:{value:function(){}},get:{value:function(){}},state:{value:function(){}},remove:{value:function(){}}}),namespace("Sy"),Sy.RegistryInterface=function(){},Sy.RegistryInterface.prototype=Object.create(Object.prototype,{set:{value:function(){}},has:{value:function(){}},get:{value:function(){}},getMapping:{value:function(){}},remove:{value:function(){}},length:{value:function(){}}}),namespace("Sy"),Sy.ServiceContainerInterface=function(){},Sy.ServiceContainerInterface.prototype=Object.create(Object.prototype,{setParameters:{value:function(){return this}},getParameter:{value:function(){}},setName:{value:function(){return this}},getName:{value:function(){}},set:{value:function(){return this}},get:{value:function(){}},has:{value:function(){}}}),namespace("Sy.Storage"),Sy.Storage.RepositoryInterface=function(){},Sy.Storage.RepositoryInterface.prototype=Object.create(Object.prototype,{setUnitOfWork:{value:function(){}},setCacheRegistry:{value:function(){}},setName:{value:function(){}},setEngine:{value:function(){}},setEntityKey:{value:function(){}},setEntityConstructor:{value:function(){}},setIndexes:{value:function(){}},setGenerator:{value:function(){}},persist:{value:function(){}},remove:{value:function(){}},flush:{value:function(){}},findOneBy:{value:function(){}},findBy:{value:function(){}}}),namespace("Sy.Storage"),Sy.Storage.EngineInterface=function(){},Sy.Storage.EngineInterface.prototype=Object.create(Object.prototype,{setStore:{value:function(){}},read:{value:function(){}},create:{value:function(){}},update:{value:function(){}},remove:{value:function(){}},find:{value:function(){}}}),namespace("Sy.Storage"),Sy.Storage.StoreMapperInterface=function(){},Sy.Storage.StoreMapperInterface.prototype=Object.create(Object.prototype,{transform:{value:function(){}}}),namespace("Sy.View"),Sy.View.LayoutFactoryInterface=function(){},Sy.View.LayoutFactoryInterface.prototype=Object.create(Sy.FactoryInterface.prototype,{setParser:{value:function(){}},setTemplateEngine:{value:function(){}},setRegistryFactory:{value:function(){}},setListFactory:{value:function(){}}}),namespace("Sy.View"),Sy.View.ListFactoryInterface=function(){},Sy.View.ListFactoryInterface.prototype=Object.create(Sy.FactoryInterface.prototype,{setTemplateEngine:{value:function(){}}}),namespace("Sy.View"),Sy.View.TemplateEngineInterface=function(){},Sy.View.TemplateEngineInterface.prototype=Object.create(Object.prototype,{PATTERN:{value:new RegExp(/{{\s?([\w.]+)\s?}}/gim),writable:!1,configurable:!1},render:{value:function(){}}}),namespace("Sy.View"),Sy.View.ViewScreenFactoryInterface=function(){},Sy.View.ViewScreenFactoryInterface.prototype=Object.create(Sy.FactoryInterface.prototype,{setParser:{value:function(){}},setTemplateEngine:{value:function(){}},setRegistryFactory:{value:function(){}},setLayoutFactory:{value:function(){}},setViewScreenWrapper:{value:function(){}}}),namespace("Sy.Kernel"),Sy.Kernel.ActionBinder=function(){this.mediator=null,this.controllers=[]},Sy.Kernel.ActionBinder.prototype=Object.create(Object.prototype,{setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}},bind:{value:function(a,b){if(!(a instanceof Sy.ControllerInterface))throw new TypeError("Invalid controller");if(!(b instanceof Sy.View.ViewScreen))throw new TypeError("Invalid viewscreen");for(var c,d,e,f=b.getNode(),g=f.querySelectorAll("[data-sy-action]"),h=new ReflectionObject(a),i=0,j=g.length;j>i;i++){if(c=g[i],d=c.dataset.syAction.split("|")[0]+"Action",!h.hasMethod(d))throw new ReferenceError('Undefined method "'+d+'"');c.dataset.syControllerIndex=this.controllers.push(a)-1,c.dataset.syActionName=d,e=c.dataset.syAction.split("|"),e.splice(0,1);for(var k=0,l=e.length;l>k;k++)c.addEventListener(e[k],this.eventCallback.bind(this),!1)}}},eventCallback:{value:function(a){var b=a.currentTarget,c=this.controllers[b.dataset.syControllerIndex],d=b.dataset.syActionName;this.mediator.publish("controller::on::pre::action",c,d),c[d].call(c,a),this.mediator.publish("controller::on::pre::action",c,d)}}}),namespace("Sy.Kernel"),Sy.Kernel.AppParser=function(){this.bundles=[],this.controllers=[],this.entities=[],this.viewscreens=[],this.services=[]},Sy.Kernel.AppParser.prototype=Object.create(Object.prototype,{getBundles:{value:function(){if(this.bundles.length>0||!objectGetter("App.Bundle"))return this.bundles;for(var a in App.Bundle)App.Bundle.hasOwnProperty(a)&&this.bundles.push(a);return this.bundles}},getControllers:{value:function(){if(this.controllers.length>0)return this.controllers;for(var a,b=0,c=this.bundles.length;c>b;b++)if(a=App.Bundle[this.bundles[b]].Controller)for(var d in a)a.hasOwnProperty(d)&&this.controllers.push({name:this.bundles[b]+"::"+d,creator:a[d]});return this.controllers}},getEntities:{value:function(){if(this.entities.length>0)return this.entities;for(var a,b,c,d,e=0,f=this.bundles.length;f>e;e++)if(a=App.Bundle[this.bundles[e]].Entity,b=App.Bundle[this.bundles[e]].Repository||{},a)for(var g in a)a.hasOwnProperty(g)&&(c=this.bundles[e]+"::"+g,d=a[g],this.entities.push({name:c,repository:b[g]||Sy.Storage.Repository,entity:d,indexes:(new d).indexes,uuid:d.prototype.UUID}));return this.entities}},getViewScreens:{value:function(){if(this.viewscreens.length>0)return this.viewscreens;for(var a,b=0,c=this.bundles.length;c>b;b++)if(a=App.Bundle[this.bundles[b]].ViewScreen)for(var d in a)a.hasOwnProperty(d)&&this.viewscreens.push({name:this.bundles[b]+"::"+d,creator:a[d]});return this.viewscreens}},getServices:{value:function(){if(this.services.length>0)return this.services;for(var a,b=0,c=this.bundles.length;c>b;b++)a=App.Bundle[this.bundles[b]].Config,a&&a.Service&&(a=new a.Service,this.services=this.services.concat(a.define()));return this.services}}}),namespace("Sy.Kernel"),Sy.Kernel.ControllerManager=function(){this.meta=null,this.loaded=null,this.mediator=null,this.container=null,this.current=null,this.cache=null,this.cacheLength=null,this.cacheOrder=[],this.actionBinder=null},Sy.Kernel.ControllerManager.prototype=Object.create(Object.prototype,{setMetaRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.meta=a,this}},setLoadedControllersRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.loaded=a,this}},registerController:{value:function(a,b){if(!(b.prototype instanceof Sy.ControllerInterface))throw new TypeError("Invalid controller constructor");return this.meta.set(a,b),this}},setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}},setServiceContainer:{value:function(a){if(!(a instanceof Sy.ServiceContainerInterface))throw new TypeError("Invalid service container");return this.container=a,this}},setCache:{value:function(a){return this.cache=!!a,this}},setCacheLength:{value:function(a){return this.cacheLength=a,this}},setActionBinder:{value:function(a){if(!(a instanceof Sy.Kernel.ActionBinder))throw new TypeError("Invalid action binder");return this.actionBinder=a,this}},onDisplayListener:{value:function(a){var b,c,d=a.getNode().dataset.syController;if(this.loaded.has(d))this.current!==d&&(this.loaded.get(this.current).sleep(),this.loaded.get(d).wakeup(),this.current=d);else{if(!this.meta.has(d))throw new ReferenceError('The controller with the alias "'+d+'" is undefined');c=d.split("::")[0],b=new(this.meta.get(d)),b.setBundle(c).setMediator(this.mediator).setServiceContainer(this.container).setViewScreen(a).init(),this.cacheController(d,b),this.actionBinder.bind(b,a),this.current=d}}},cacheController:{value:function(a,b){return this.loaded.set(a,b),this.cacheOrder.push(a),(this.cache===!1||this.cache===!0&&"number"==typeof this.cacheLength&&this.loaded.length()>this.cacheLength)&&(this.loaded.get(this.cacheOrder[0]).destroy(),this.loaded.remove(this.cacheOrder[0]),this.cacheOrder.splice(0,1)),this}},boot:{value:function(){this.mediator.subscribe({channel:"view::on::pre::display",fn:this.onDisplayListener,context:this})}}}),namespace("Sy.Kernel"),Sy.Kernel.Core=function(){this.config=new Sy.Configurator,this.container=new Sy.ServiceContainer("sy::core"),this.controllerManager=new Sy.Kernel.ControllerManager,this.actionBinder=new Sy.Kernel.ActionBinder},Sy.Kernel.Core.prototype=Object.create(Object.prototype,{getConfig:{value:function(){return this.config}},getServiceContainer:{value:function(){return this.container}},boot:{value:function(){var a=new Sy.Kernel.FeatureTester,b=new Sy.Kernel.AppParser;a.testBrowser(),this.config.set("parameters.app.meta",{bundles:b.getBundles(),controllers:b.getControllers(),entities:b.getEntities(),viewscreens:b.getViewScreens()}),this.registerServices(b.getServices()).registerControllers(b.getControllers()).configureLogger().registerShutdownListener()}},registerServices:{value:function(a){for(var b=0,c=a.length;c>b;b++)if(a[b].creator)this.container.set(a[b].name,a[b].creator);else if("string"==typeof a[b].constructor){var d={},e=a[b].name;delete a[b].name,d[e]=a[b],this.container.set(d)}return this}},registerControllers:{value:function(a){var b=this.container.get("sy::core::registry::factory"),c=this.container.get("sy::core::mediator");this.actionBinder.setMediator(c),this.controllerManager.setMetaRegistry(b.make()).setLoadedControllersRegistry(b.make()).setMediator(c).setServiceContainer(this.container).setCache(this.config.get("controllers.cache")).setCacheLength(this.config.get("controllers.cacheLength")).setActionBinder(this.actionBinder);for(var d=0,e=a.length;e>d;d++)this.controllerManager.registerController(a[d].name,a[d].creator);return this.controllerManager.boot(),this}},configureLogger:{value:function(){var a=this.config.get("env"),b=this.container.get("sy::core::logger");return"prod"===a&&b.removeHandler(b.LOG).removeHandler(b.DEBUG).removeHandler(b.INFO),this}},registerShutdownListener:{value:function(){return window.addEventListener("beforeunload",function(a){try{this.container.get("sy::core::mediator").publish("app::shutdown",a)}catch(b){return b.message}}.bind(this),!1),this}}}),namespace("Sy.Kernel"),Sy.Kernel.FeatureTester=function(){},Sy.Kernel.FeatureTester.prototype=Object.create(Object.prototype,{testJSON:{value:function(){if("object"!=typeof JSON)throw new ReferenceError("JSON is not supported");if("function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)throw new ReferenceError("JSON methods are not defined")}},testXHR:{value:function(){if("function"!=typeof XMLHttpRequest)throw new ReferenceError("XMLHttpRequest is not defined");if("function"!=typeof FormData)throw new ReferenceError("FormData is not defined")}},testBind:{value:function(){if("function"!=typeof Function.prototype.bind)throw new ReferenceError("The Function.bind method is not defined")}},testHTMLAttributes:{value:function(){if(!(document.body.dataset instanceof DOMStringMap))throw new ReferenceError("Element dataset not supported");if(!(document.body.attributes instanceof NamedNodeMap))throw new ReferenceError("Element.attributes not defined")}},testEventListener:{value:function(){if("function"!=typeof document.body.addEventListener)throw new ReferenceError("Element.addEventListener is not defined")}},testBrowser:{value:function(){this.testJSON(),this.testXHR(),this.testHTMLAttributes(),this.testBind(),this.testEventListener()}}}),namespace("Sy.Lib.Generator"),Sy.Lib.Generator.UUID=function(){},Sy.Lib.Generator.UUID.prototype=Object.create(Sy.Lib.Generator.Interface.prototype,{s4:{value:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}},generate:{value:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}}}),namespace("Sy.Lib.Logger"),Sy.Lib.Logger.CoreLogger=function(a){this.name="",this.handlers={},this.setName(a)},Sy.Lib.Logger.CoreLogger.prototype=Object.create(Sy.Lib.Logger.Interface.prototype,{setName:{value:function(a){return this.name=a||"null",this}},setHandler:{value:function(a,b){return a instanceof Sy.Lib.Logger.Handler.Interface&&b.toUpperCase()in this&&(this.handlers[b]=a),this}},isHandlingLevel:{value:function(a){return!!this.handlers[a]}},removeHandler:{value:function(a){return this.isHandlingLevel(a)&&delete this.handlers[a],this}},handle:{value:function(a,b,c){return this.handlers[a]&&this.handlers[a].handle(this.name,a,b,c),this}},log:{value:function(a,b){return this.handle(this.LOG,a,b),this}},debug:{value:function(a,b){return this.handle(this.DEBUG,a,b),this}},error:{value:function(a,b){return this.handle(this.ERROR,a,b),this}},info:{value:function(a,b){return this.handle(this.INFO,a,b),this}},lock:{value:function(){return Object.seal(this.handlers),this}}}),namespace("Sy.Lib.Logger.Handler"),Sy.Lib.Logger.Handler.Console=function(a){this.level=null,this.setLevel(a)},Sy.Lib.Logger.Handler.Console.prototype=Object.create(Sy.Lib.Logger.Handler.Interface.prototype,{setLevel:{value:function(a){if(!this.checkLevel(a))throw new TypeError("Unknown logger level");return this.level=a,this}},checkLevel:{value:function(a){return a.toUpperCase()in Sy.Lib.Logger.Interface.prototype?!0:!1}},isHandling:{value:function(a){return a===this.level?!0:!1}},handle:{value:function(a,b,c,d){if(this.isHandling(b)&&"console"in window){var e="["+moment().format("YYYY-M-D hh:mm:ss")+"]",f=d||[];c=c||"",e+=" "+a+"."+b.toUpperCase(),e+=" "+c.toString(),console[b](e,f)}return this}}}),namespace("Sy.Lib"),Sy.Lib.Mediator=function(){this.channels={},this.generator=null,this.logger=null},Sy.Lib.Mediator.prototype=Object.create(Object.prototype,{subscribe:{value:function(a){var a=a||{},b=null;return void 0===a.priority&&(a.priority=1),void 0===this.channels[a.channel]&&(b=new Sy.Lib.MediatorChannel(a.channel),b.setGenerator(this.generator),this.logger&&b.setLogger(this.logger),this.channels[a.channel]=b),this.channels[a.channel].add(a.fn,a.context,a.priority,a.async,a.bubbles)}},remove:{value:function(a,b){return void 0!==this.channels[a]&&this.channels[a].remove(b),this}},publish:{value:function(){if(0===arguments.length)return this;var a=Array.prototype.slice.call(arguments,0,1)[0],b=Array.prototype.slice.call(arguments,1);return void 0!==this.channels[a]&&this.channels[a].publish(b),this}},pause:{value:function(a,b){return void 0!==this.channels[a]&&(this.channels[a].stopped=!0,b&&this.channels[a].pause(b)),this}},unpause:{value:function(a,b){return void 0!==this.channels[a]&&(this.channels[a].stopped=!1,b&&this.channels[a].unpause(b)),this}},paused:{value:function(a){return void 0!==this.channels[a]?this.channels[a].stopped:void 0}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator");return this.generator=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}}}),Sy.Lib.MediatorChannel=function(a){this.name=a||"",this.stopped=!1,this.subscribers={},this.generator=null,this.logger=null},Sy.Lib.MediatorChannel.prototype=Object.create(Object.prototype,{add:{value:function(a,b,c,d,e){var f=this.generator.generate();return this.subscribers[f]={fn:a,context:b||window,priority:c||1,async:!!d,bubbles:!!e,stopped:!1},f}},remove:{value:function(a){return delete this.subscribers[a],this}},publish:{value:function(a){var a=a||[];if(this.stopped===!1){var b=[];for(var c in this.subscribers)this.subscribers.hasOwnProperty(c)&&this.subscribers[c].stopped===!1&&b.push(this.subscribers[c]);b.sort(function(a,b){return a.priority-b.priority});for(var d=0,e=b.length;e>d;d++)try{var f=b[d];f.async===!0?setTimeout(this.subscriberCall,0,this,f.fn,f.context,a):this.subscriberCall(this,f.fn,f.context,a)}catch(g){if(this.logger&&this.logger.error(g.message,g),f.bubbles===!0)throw g}}return this}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator");return this.generator=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}},subscriberCall:{value:function(a,b,c,d){b.apply(c,d)}},pause:{value:function(a){return this.subscribers[a]&&(this.subscribers[a].stopped=!0),this}},unpause:{value:function(a){return this.subscribers[a]&&(this.subscribers[a].stopped=!1),this}}}),namespace("Sy.HTTP"),Sy.HTTP.Request=function(){this.method="GET",this.data=new Sy.Registry,this.headers=new Sy.Registry,this.listener=null,this.type="",this.uri=""},Sy.HTTP.Request.prototype=Object.create(Sy.HTTP.RequestInterface.prototype,{setURI:{value:function(a){return this.uri=a,this}},getURI:{value:function(){return this.uri}},setMethod:{value:function(a){var b=a.toUpperCase();return-1!==["OPTIONS","GET","HEAD","POST","PUT","DELETE","TRACE","CONNECT"].indexOf(b)&&(this.method=b),this}},getMethod:{value:function(){return this.method}},setData:{value:function(a){for(var b in a)a.hasOwnProperty(b)&&this.data.set(b,a[b]);return this}},getData:{value:function(){return this.data.getMapping()}},setHeader:{value:function(a,b){if(a instanceof Object)for(var c in a)a.hasOwnProperty(c)&&this.setHeader(c,a[c]);else"string"==typeof a&&"string"==typeof b&&this.headers.set(a,b);return this}},getHeader:{value:function(a){return void 0!==a?this.headers.has(a)?this.headers.get(a):void 0:this.headers.getMapping()}},setListener:{value:function(a){return this.listener=a,this}},getListener:{value:function(){return this.listener}},setType:{value:function(a){return-1!==["html","json"].indexOf(a)&&(this.type=a),this}},getType:{value:function(){return this.type}}}),namespace("Sy.HTTP"),Sy.HTTP.Response=function(){this.statusCode=0,this.statusText=null,this.headers=new Sy.Registry,this.body=null},Sy.HTTP.Response.prototype=Object.create(Sy.HTTP.ResponseInterface.prototype,{setStatusCode:{value:function(a){return this.statusCode=parseInt(a,10),this}},getStatusCode:{value:function(){return this.statusCode}},setStatusText:{value:function(a){return this.statusText=a,this}},getStatusText:{value:function(){return this.statusText}},setHeaders:{value:function(a){for(var b in a)a.hasOwnProperty(b)&&this.headers.set(b,a[b]);return this}},getHeader:{value:function(a){return void 0===a?this.headers.getMapping():this.headers.has(a)?this.headers.get(a):void 0}},setBody:{value:function(a){return this.body=a,this}},getBody:{value:function(){return this.body}}}),namespace("Sy.HTTP"),Sy.HTTP.JSONRequest=function(){Sy.HTTP.Request.call(this),this.setType("json"),this.setHeader("Accept","application/json")},Sy.HTTP.JSONRequest.prototype=Object.create(Sy.HTTP.Request.prototype),namespace("Sy.HTTP"),Sy.HTTP.JSONResponse=function(){Sy.HTTP.Response.call(this)},Sy.HTTP.JSONResponse.prototype=Object.create(Sy.HTTP.Response.prototype),namespace("Sy.HTTP"),Sy.HTTP.HeaderParser=function(){},Sy.HTTP.HeaderParser.prototype=Object.create(Object.prototype,{parse:{value:function(a){for(var b,c,d,e={},f=a.split("\n"),g=0,h=f.length-1;h>g;g++){switch(d=f[g].indexOf(":"),b=f[g].substring(0,d),c=f[g].substring(d+2),b){case"Date":case"Expires":case"Last-Modified":c=new Date(c)}e[b]=c}return e}}}),namespace("Sy.HTTP"),Sy.HTTP.HTMLRequest=function(){Sy.HTTP.Request.call(this),this.setType("html"),this.setHeader("Accept","text/html,application/xhtml+xml")},Sy.HTTP.HTMLRequest.prototype=Object.create(Sy.HTTP.Request.prototype),namespace("Sy.HTTP"),Sy.HTTP.HTMLResponse=function(){Sy.HTTP.Response.call(this)},Sy.HTTP.HTMLResponse.prototype=Object.create(Sy.HTTP.Response.prototype),namespace("Sy.HTTP"),Sy.HTTP.Manager=function(){this.requests=null,this.parser=null,this.generator=null},Sy.HTTP.Manager.prototype=Object.create(Object.prototype,{setParser:{value:function(a){return this.parser=a,this}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator type");return this.generator=a,this}},setRegistry:{value:function(a){if(!(a instanceof Sy.Registry))throw new TypeError("Invalid registry");return this.requests=a,this}},launch:{value:function(a){if(!(a instanceof Sy.HTTP.RequestInterface))throw new TypeError("Invalid request type");var b=this.generator.generate(),c={xhr:null,obj:a,uuid:b},d=a.getHeader(),e=a.getData(),f=new FormData;switch(c.xhr=new XMLHttpRequest,c.xhr.open(a.getMethod(),a.getURI()),c.xhr.UUID=b,c.xhr.addEventListener("readystatechange",this.listener.bind(this),!1),a.getType()){case"html":c.xhr.responseType="document";break;case"json":c.xhr.responseType="json"}for(var g in d)d.hasOwnProperty(g)&&c.xhr.setRequestHeader(g,d[g]);for(var h in e)e.hasOwnProperty(h)&&f.append(h,e[h]);return c.xhr.send(f),this.requests.set(b,c),b}},listener:{value:function(a){if(a.target.readyState===a.target.DONE&&this.requests.has(a.target.UUID)){var b,c=this.requests.get(a.target.UUID),d=c.obj.getListener(),e=this.parser.parse(a.target.getAllResponseHeaders());b=-1!==e["Content-Type"].indexOf("application/json")&&"json"===c.obj.getType()?new Sy.HTTP.JSONResponse:-1!==e["Content-Type"].indexOf("text/html")&&"html"===c.obj.getType()?new Sy.HTTP.HTMLResponse:new Sy.HTTP.Response,b.setHeaders(e),b.setStatusCode(a.target.status),b.setStatusText(a.target.statusText),b.setBody(a.target.response),this.requests.remove(a.target.UUID),void 0!==d&&d(b)}}},abort:{value:function(a){var b=this.requests.get(a);return b.xhr.abort(),this.requests.remove(a),this}}}),namespace("Sy.HTTP"),Sy.HTTP.REST=function(){this.manager=null},Sy.HTTP.REST.prototype=Object.create(Object.prototype,{setManager:{value:function(a){if(!(a instanceof Sy.HTTP.Manager))throw new TypeError("Invalid manager");return this.manager=a,this}},request:{value:function(a){var b=new Sy.HTTP.JSONRequest;a.data=a.data||{},a.headers=a.headers||{},b.setMethod(a.method),b.setURI(a.uri),b.setHeader(a.headers),b.setData(a.data),b.setListener(a.listener),this.manager.launch(b)}},get:{value:function(a){return a.method="get",this.request(a),this}},post:{value:function(a){return a.method="post",this.request(a),this}},put:{value:function(a){return a.method="put",a.data=a.data||{_method:"put"},this.request(a),this}},remove:{value:function(a){return a.method="delete",a.data=a.data||{_method:"delete"},this.request(a),this}}}),namespace("Sy.Storage"),Sy.Storage.Core=function(){this.managers=null},Sy.Storage.Core.prototype=Object.create(Object.prototype,{setRegistry:{value:function(a){if(!(a instanceof Sy.Registry))throw new TypeError("Invalid registry");return this.managers=new Sy.Registry,this}},setManager:{value:function(a,b){if(!(b instanceof Sy.Storage.Manager))throw new TypeError("Invalid manager type");return this.managers.set(a,b),this}},getManager:{value:function(a){return a=a||"main",this.managers.get(a)}}}),namespace("Sy.Storage.Engine"),Sy.Storage.Engine.IndexedDB=function(a){this.version=a,this.connection=null,this.transaction=null,this.keyRange=null,this.transactionModes={READ_ONLY:null,READ_WRITE:null},this.name="app::storage",this.stores={},this.storage=null,this.logger=null,this.mediator=null},Sy.Storage.Engine.IndexedDB.prototype=Object.create(Sy.Storage.EngineInterface.prototype,{setConnection:{value:function(a){if(!(a instanceof IDBFactory))throw new TypeError("Invalid connection");return this.connection=a,this}},setTransaction:{value:function(a){return this.transaction=a,this.transactionModes={READ_ONLY:this.transaction.READ_ONLY||"readonly",READ_WRITE:this.transaction.READ_WRITE||"readwrite"},this}},setKeyRange:{value:function(a){return this.keyRange=a,this}},setName:{value:function(a){return this.name=a,this}},setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}},setMediator:{value:function(a){return this.mediator=a,this}},open:{value:function(){var a=this.connection.open(this.name,this.version);return a.onupgradeneeded=this.upgradeDatabase.bind(this),a.onsuccess=function(a){this.storage=a.target.result,this.storage.onerror=function(a){this.logger.error("Database operation failed",a)}.bind(this),this.logger.info("Database opened")}.bind(this),a.onerror=function(a){this.logger.error("Database opening failed",a)}.bind(this),a.onblocked=function(a){this.logger.error("Database opening failed! (blocked by browser setting)",a)}.bind(this),this}},upgradeDatabase:{value:function(a){this.logger.info("Upgrading database..."),this.storage=a.target.result;for(var b in this.stores)if(this.stores.hasOwnProperty(b)){var c;b=this.stores[b],this.storage.objectStoreNames.contains(b.path)||this.storage.createObjectStore(b.path,{keyPath:b.key,autoincrement:!1}),c=a.target.transaction.objectStore(b.path);for(var d=0,e=c.indexNames.length;e>d;d++)-1===b.indexes.indexOf(c.indexNames[d])&&c.deleteIndex(c.indexNames[d]);
for(var f=0,g=b.indexes.length;g>f;f++)c.indexNames.contains(b.indexes[f])||c.createIndex(b.indexes[f],b.indexes[f],{unique:!1})}}},setStore:{value:function(a,b,c,d){return this.stores[a]={path:b,key:c,indexes:d},this}},read:{value:function(a,b,c){if(!this.stores[a])throw new ReferenceError("Invalid store");var d=this.stores[a];try{var e=this.storage.transaction([d.path],this.transactionModes.READ_ONLY),f=e.objectStore(d.path),g=f.get(b);g.addEventListener("success",function(a){c(a.target.result)}),g.addEventListener("error",function(a){this.logger.error("Read operation failed!",a)}.bind(this))}catch(h){this.logger.error("Read operation failed!",h)}return this}},create:{value:function(a,b,c){if(!this.stores[a])throw new ReferenceError("Invalid store");var d=this.stores[a];try{this.mediator.publish(this.name+"::on::pre::create",a,b);var e=this.storage.transaction([d.path],this.transactionModes.READ_WRITE),f=e.objectStore(d.path),g=f.put(b);g.addEventListener("success",function(d){c(d.target.result),this.mediator.publish(this.name+"::on::post::create",a,b)}.bind(this)),g.addEventListener("error",function(a){this.logger.error("Create operation failed!",a)}.bind(this))}catch(h){this.logger.error("Create operation failed!",h)}return this}},update:{value:function(a,b,c,d){if(!this.stores[a])throw new ReferenceError("Invalid store");var e=this.stores[a];try{this.mediator.publish(this.name+"::on::pre::update",a,b,c);var f=this.storage.transaction([e.path],this.transactionModes.READ_WRITE),g=f.objectStore(e.path),h=g.put(c);h.addEventListener("success",function(e){d(e.target.result),this.mediator.publish(this.name+"::on::post::update",a,b,c)}.bind(this)),h.addEventListener("error",function(a){this.logger.error("Update operation failed!",a)}.bind(this))}catch(i){this.logger.error("Update operation failed!",i)}return this}},remove:{value:function(a,b,c){if(!this.stores[a])throw new ReferenceError("Invalid store");var d=this.stores[a];try{this.mediator.publish(this.name+"::on::pre::remove",a,b);var e=this.storage.transaction([d.path],this.transactionModes.READ_WRITE),f=e.objectStore(d.path),g=f.delete(b);g.addEventListener("success",function(d){c(d.target.result),this.mediator.publish(this.name+"::on::post::remove",a,b)}),g.addEventListener("error",function(a){this.logger.error("Delete operation failed!",a)}.bind(this))}catch(h){this.logger.error("Delete operation failed!",h)}return this}},find:{value:function(a,b){if(!this.stores[a])throw new ReferenceError("Invalid store");a=this.stores[a];try{var c,d,e=this.storage.transaction([a.path],this.transactionModes.READ_ONLY),f=e.objectStore(a.path),g=f.index(b.index),h=[];c=b.value instanceof Array&&2===b.value.length?void 0===b.value[0]?this.keyRange.upperBound(b.value[1]):void 0===b.value[1]?this.keyRange.lowerBound(b.value[0]):this.keyRange.bound(b.value[0],b.value[1]):this.keyRange.only(b.value),d=g.openCursor(c),d.addEventListener("success",function(a){var c=a.target.result;return!!c==!1?void b.callback(b.limit?h.slice(0,b.limit):h):(h.push(c.value),void c.continue())}),d.addEventListener("error",function(a){this.logger.error("Search operation failed!",a)}.bind(this))}catch(i){this.logger.error("Search operation failed!",i)}return this}}}),namespace("Sy.Storage.Engine"),Sy.Storage.Engine.Localstorage=function(){if(!JSON)throw new Error("JSON object missing! Please load a polyfill in order to use this engine!");this.storage=null,this.stores={},this.data=null,this.storageKey="app::storage",this.mediator=null},Sy.Storage.Engine.Localstorage.prototype=Object.create(Sy.Storage.EngineInterface.prototype,{setStorageKey:{value:function(a){return this.storageKey=a,this}},setStorage:{value:function(a){return this.storage=a,this}},setMediator:{value:function(a){return this.mediator=a,this}},open:{value:function(){if(!this.storage)throw new Error("Storage API object missing");var a=this.storage.getItem(this.storageKey);return a?this.data=JSON.parse(a):this.createStorage(),this}},createStorage:{value:function(){this.data={};for(var a in this.stores)this.stores.hasOwnProperty(a)&&(this.data[this.stores[a].path]={});return this.flush(),this}},flush:{value:function(){return this.storage.setItem(this.storageKey,JSON.stringify(this.data)),this}},setStore:{value:function(a,b,c,d){return this.stores[a]={path:b,key:c,indexes:d},this}},read:{value:function(a,b,c){if(!this.stores[a])throw new ReferenceError("Unknown store");var d=this.stores[a];return this.data[d.path][b]&&setTimeout(c,0,this.data[d.path][b]),this}},create:{value:function(a,b,c){if(!this.stores[a])throw new ReferenceError("Unknown store");var d=this.stores[a],e=d.key;return this.mediator.publish(this.storageKey+"::on::pre::create",a,b),this.data[d.path][b[e]]=b,this.flush(),this.mediator.publish(this.storageKey+"::on::post::create",a,b),setTimeout(c,0,b[e]),this}},update:{value:function(a,b,c,d){if(!this.stores[a])throw new ReferenceError("Unknown store");var e=this.stores[a];return this.mediator.publish(this.storageKey+"::on::pre::update",a,b,c),this.data[e.path][b]=c,this.flush(),this.mediator.publish(this.storageKey+"::on::post::update",a,b,c),setTimeout(d,0,c),this}},remove:{value:function(a,b,c){if(!this.stores[a])throw new ReferenceError("Unknown store");{var d=this.stores[a];d.key}return this.mediator.publish(this.storageKey+"::on::pre::remove",a,b),delete this.data[d.path][b],this.flush(),this.mediator.publish(this.storageKey+"::on::post::remove",a,b),setTimeout(c,0,b),this}},find:{value:function(a,b){if(!this.stores[a])throw new ReferenceError("Unknown store");a=this.stores[a];var c=[];for(var d in this.data[a.path])if(this.data[a.path].hasOwnProperty(d)){var e=this.data[a.path][d];b.value instanceof Array?(void 0===b.value[0]&&e[b.index]<=b.value[1]||void 0===b.value[1]&&e[b.index]>=b.value[0]||e[b.index]>=b.value[0]&&e[b.index]<=b.value[1])&&c.push(e):e[b.index]===b.value&&c.push(e)}return b.limit&&(c=c.slice(0,b.limit)),setTimeout(b.callback,0,c),this}}}),namespace("Sy.Storage.Engine"),Sy.Storage.Engine.Rest=function(a){this.version=a||1,this.stores={},this.manager=null,this.basePath="",this.mediator=null,this.headers={}},Sy.Storage.Engine.Rest.prototype=Object.create(Sy.Storage.EngineInterface.prototype,{setPattern:{value:function(a){if(-1===a.indexOf("{{path}}")||-1===a.indexOf("{{key}}"))throw new SyntaxError("Invalid pattern");return this.basePath=a.replace(/{{version}}/,this.version),this}},setManager:{value:function(a){if(!(a instanceof Sy.HTTP.REST))throw new TypeError("Invalid manager");return this.manager=a,this}},setMediator:{value:function(a){return this.mediator=a,this}},setHeaders:{value:function(a){return this.headers=a,this}},setStore:{value:function(a,b,c,d){return this.stores[a]={path:b,key:c,indexes:d},this}},read:{value:function(a,b,c){if(!this.stores[a])throw new ReferenceError("Unknown store");var d=this.stores[a];return this.manager.get({uri:this.basePath.replace(/{{path}}/,d.path).replace(/{{key}}/,b),headers:this.headers,listener:function(a){c(a.getBody())}}),this}},create:{value:function(a,b,c){if(!this.stores[a])throw new ReferenceError("Unknown store");var d=this.stores[a];return this.mediator.publish("app::storage::on::pre::create",this.basePath,a,b),this.manager.post({uri:this.basePath.replace(/{{path}}/,d.path).replace(/{{key}}/,""),headers:this.headers,data:b,listener:function(d){c(d.getBody()),this.mediator.publish("app::storage::on::post::create",this.basePath,a,b)}.bind(this)}),this}},update:{value:function(a,b,c,d){if(!this.stores[a])throw new ReferenceError("Unknown store");var e=this.stores[a];return this.mediator.publish("app::storage::on::pre::update",this.basePath,a,b,c),this.manager.put({uri:this.basePath.replace(/{{path}}/,e.path).replace(/{{key}}/,b),headers:this.headers,data:c,listener:function(e){d(e.getBody()),this.mediator.publish("app::storage::on::post::update",this.basePath,a,b,c)}.bind(this)}),this}},remove:{value:function(a,b,c){if(!this.stores[a])throw new ReferenceError("Unknown store");var d=this.stores[a];return this.mediator.publish("app::storage::on::pre::remove",this.basePath,a,b),this.manager.remove({uri:this.basePath.replace(/{{path}}/,d.path).replace(/{{key}}/,b),headers:this.headers,listener:function(){c(b),this.mediator.publish("app::storage::on::post::remove",this.basePath,a,b)}.bind(this)}),this}},find:{value:function(a){if(!this.stores[store])throw new ReferenceError("Unknown store");var b=this.stores[store],c=[];return c.push(a.value instanceof Array?a.index+"[]="+a.value[0]+"&"+a.index+"[]="+a.value[1]:a.index+"="+a.value),a.limit&&c.push("limit="+a.limit),this.manager.get({uri:this.basePath.replace(/{{path}}/,b.path).replace(/{{key}}/,"?"+c.join("&")),headers:this.headers,listener:function(a){callback(a.getBody())}}),this}}}),namespace("Sy.Storage.EngineFactory"),Sy.Storage.EngineFactory.AbstractFactory=function(){this.logger=null,this.mediator=null},Sy.Storage.EngineFactory.AbstractFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{setLogger:{value:function(a){if(!(a instanceof Sy.Lib.Logger.Interface))throw new TypeError("Invalid logger");return this.logger=a,this}},setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}}}),namespace("Sy.Storage.EngineFactory"),Sy.Storage.EngineFactory.Core=function(){this.engines=null},Sy.Storage.EngineFactory.Core.prototype=Object.create(Sy.FactoryInterface.prototype,{setRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.engines=a,this}},setEngineFactory:{value:function(a,b,c){if(this.engines.has(a))throw new ReferenceError('Factory "'+a+'" already defined');if(!(b instanceof Sy.FactoryInterface))throw new TypeError("Invalid factory");if(!(c instanceof Sy.Storage.StoreMapperInterface))throw new TypeError("Invalid mapper");return this.engines.set(a,{factory:b,mapper:c}),this}},make:{value:function(a,b){var c=a.type;if(!this.engines.has(c))throw new ReferenceError('Unknown factory named "'+c+'"');for(var d,e=this.engines.get(c).factory,f=this.engines.get(c).mapper,g=[],h=0,i=b.length;i>h;h++)g.push(f.transform(b[h]));return d=e.make(a.storageName,a.version,g)}}}),namespace("Sy.Storage.EngineFactory"),Sy.Storage.EngineFactory.IndexedDBFactory=function(){Sy.Storage.EngineFactory.AbstractFactory.call(this)},Sy.Storage.EngineFactory.IndexedDBFactory.prototype=Object.create(Sy.Storage.EngineFactory.AbstractFactory.prototype,{make:{value:function(a,b,c){a=a||"app::storage",b=b||1,c=c||[];for(var d=new Sy.Storage.Engine.IndexedDB(b),e=0,f=c.length;f>e;e++)d.setStore(c[e].alias,c[e].name,c[e].identifier,c[e].indexes);return this.logger&&d.setLogger(this.logger),this.mediator&&d.setMediator(this.mediator),d.setConnection(window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB).setTransaction(window.IDBTransaction||window.webkitIDBTransaction).setKeyRange(window.IDBKeyRange||window.webkitIDBKeyRange).open(),d}}}),namespace("Sy.Storage.EngineFactory"),Sy.Storage.EngineFactory.LocalstorageFactory=function(){Sy.Storage.EngineFactory.AbstractFactory.call(this)},Sy.Storage.EngineFactory.LocalstorageFactory.prototype=Object.create(Sy.Storage.EngineFactory.AbstractFactory.prototype,{make:{value:function(a,b,c){a=a||"app::storage",b=b||1,c=c||[];for(var d=new Sy.Storage.Engine.Localstorage(b),e=0,f=c.length;f>e;e++)d.setStore(c[e].alias,c[e].name,c[e].identifier,c[e].indexes);return this.mediator&&d.setMediator(this.mediator),d.setStorage(window.localStorage).open(),d}}}),namespace("Sy.Storage.EngineFactory"),Sy.Storage.EngineFactory.RestFactory=function(){Sy.Storage.EngineFactory.AbstractFactory.call(this),this.manager=null,this.pattern="/api/{{version}}/{{path}}/{{key}}"},Sy.Storage.EngineFactory.RestFactory.prototype=Object.create(Sy.Storage.EngineFactory.AbstractFactory.prototype,{setManager:{value:function(a){if(!(a instanceof Sy.HTTP.REST))throw new TypeError("Invalid rest manager");return this.manager=a,this}},make:{value:function(a,b,c){b=b||1,c=c||[];for(var d=new Sy.Storage.Engine.Rest(b),e=0,f=c.length;f>e;e++)d.setStore(c[e].alias,c[e].name,c[e].identifier,c[e].indexes);return this.mediator&&d.setMediator(this.mediator),d.setManager(this.manager).setPattern(this.pattern),d}}}),namespace("Sy.Storage"),Sy.Storage.Manager=function(){this.repositoryFact=null,this.mapping=[],this.engine=null},Sy.Storage.Manager.prototype=Object.create(Object.prototype,{setRepositoryFactory:{value:function(a){if(!(a instanceof Sy.Storage.RepositoryFactory))throw new TypeError("Invalid repository factory type");return this.repositoryFact=a,this}},setMapping:{value:function(a){if(!(a instanceof Array))throw new TypeError("Invalid argument");return this.mapping=a,this}},setEngine:{value:function(a){if(!(a instanceof Sy.Storage.EngineInterface))throw new TypeError("Invalid engine");return this.engine=a,this}},getEngine:{value:function(){return this.engine}},getRepository:{value:function(a){if(this.mapping.length>0&&-1===this.mapping.indexOf(a))throw new ReferenceError('The manager does not handle "'+a+'"');var b=this.repositoryFact.make(a);return b.setEngine(this.engine),b}}}),namespace("Sy.Storage"),Sy.Storage.ManagerFactory=function(){this.engineFact=null,this.repositoryFact=null},Sy.Storage.ManagerFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{setEngineFactory:{value:function(a){if(!(a instanceof Sy.Storage.EngineFactory.Core))throw new TypeError("Invalid engine factory");return this.engineFact=a,this}},setRepositoryFactory:{value:function(a){if(!(a instanceof Sy.Storage.RepositoryFactory))throw new TypeError("Invalid repository factory");return this.repositoryFact=a,this}},make:{value:function(a,b,c){var d,e=new Sy.Storage.Manager,f=[];b.mapping=b.mapping||[];for(var g=0,h=c.length;h>g;g++)(0===b.mapping.length||-1!==b.mapping.indexOf(c[g].name))&&f.push(c[g]);return d=this.engineFact.make(b,f),e.setRepositoryFactory(this.repositoryFact).setMapping(b.mapping).setEngine(d),e}}}),namespace("Sy.Storage"),Sy.Storage.Repository=function(){this.engine=null,this.entityKey=null,this.entityConstructor=null,this.uow=null,this.name=null,this.cache=null},Sy.Storage.Repository.prototype=Object.create(Sy.Storage.RepositoryInterface.prototype,{setUnitOfWork:{value:function(a){if(!(a instanceof Sy.Storage.UnitOfWork))throw new TypeError("Invalid unit of work");return this.uow=a,this}},setCacheRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.cache=a,this}},getUnitOfWork:{value:function(){return this.uow}},setName:{value:function(a){return this.name=a,this}},setEngine:{value:function(a){if(!(a instanceof Sy.Storage.EngineInterface))throw new TypeError("Invalid engine");return this.engine=a,this.uow.setEngine(a),this}},setEntityKey:{value:function(a){return this.entityKey=a,this}},setEntityConstructor:{value:function(a){if(!(a.prototype instanceof Sy.EntityInterface))throw new TypeError("Invalid entity constructor");return this.entityConstructor=a,this}},setIndexes:{value:function(a){if(!(a instanceof Array))throw new TypeError("Invalid indexes definition");return this.indexes=a,this}},persist:{value:function(a){if(!(a instanceof this.entityConstructor))throw new TypeError("Entity not handled by the repository");return this.uow.handle(a),this.cache.set(a.get(this.entityKey),a),this}},remove:{value:function(a){return this.uow.remove(a),this}},flush:{value:function(){return this.uow.flush(),this}},findOneBy:{value:function(a){return a.index===this.entityKey?this.cache.has(a.value)?setTimeout(a.callback,0,this.cache.get(a.value)):this.engine.read(this.name,a.value,function(b){a.callback(this.buildEntity(b))}.bind(this)):(a.limit=1,this.findBy(a)),this}},findBy:{value:function(a){return this.engine.find(this.name,{index:a.index,value:a.value,callback:function(b){this.findListener(a.callback,b)}.bind(this),limit:a.limit}),this}},findListener:{value:function(a,b){for(var c=[],d=0,e=b.length;e>d;d++)c.push(this.buildEntity(b[d]));a(c)}},buildEntity:{value:function(a){if(this.cache.has(a[this.entityKey]))return this.cache.get(a[this.entityKey]);var b=new this.entityConstructor;return b.set(a),b}}}),namespace("Sy.Storage"),Sy.Storage.RepositoryFactory=function(){this.meta=null,this.loaded=null,this.uowFactory=null,this.registryFactory=null},Sy.Storage.RepositoryFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{setRegistryFactory:{value:function(a){if(!(a instanceof Sy.RegistryFactory))throw new TypeError("Invalid registry factory");return this.meta=a.make(),this.loaded=a.make(),this.registryFactory=a,this}},setMeta:{value:function(a){for(var b=0,c=a.length;c>b;b++)this.meta.set(a[b].name,{repository:a[b].repository,entity:a[b].entity,indexes:a[b].indexes,uuid:a[b].uuid});return this}},setUOWFactory:{value:function(a){if(!(a instanceof Sy.Storage.UnitOfWorkFactory))throw new TypeError("Invalid factory");return this.uowFactory=a,this}},make:{value:function(a){if(this.loaded.has(a))return this.loaded.get(a);if(!this.meta.has(a))throw new ReferenceError('Unknown repository "'+a+'"');var b=this.meta.get(a),c=new b.repository,d=this.uowFactory.make(a,b.uuid);if(!(c instanceof Sy.Storage.RepositoryInterface))throw new TypeError('Invalid repository "'+a+'"');return c.setName(a).setEntityKey(b.uuid).setEntityConstructor(b.entity).setIndexes(b.indexes).setUnitOfWork(d).setCacheRegistry(this.registryFactory.make()),this.loaded.set(a,c),c}}}),namespace("Sy.Storage.StoreMapper"),Sy.Storage.StoreMapper.IndexedDBMapper=function(){},Sy.Storage.StoreMapper.IndexedDBMapper.prototype=Object.create(Sy.Storage.StoreMapperInterface.prototype,{transform:{value:function(a){var b={};return b.alias=a.name,b.name=a.name.toLowerCase(),b.identifier=a.uuid,b.indexes=a.indexes,b}}}),namespace("Sy.Storage.StoreMapper"),Sy.Storage.StoreMapper.LocalstorageMapper=function(){},Sy.Storage.StoreMapper.LocalstorageMapper.prototype=Object.create(Sy.Storage.StoreMapperInterface.prototype,{transform:{value:function(a){var b={};return b.alias=a.name,b.name=a.name.toLowerCase(),b.identifier=a.uuid,b.indexes=a.indexes,b}}}),namespace("Sy.Storage.StoreMapper"),Sy.Storage.StoreMapper.RestMapper=function(){},Sy.Storage.StoreMapper.RestMapper.prototype=Object.create(Sy.Storage.StoreMapperInterface.prototype,{transform:{value:function(a){var b={};return b.alias=a.name,b.name=a.name.toLowerCase().replace("::","/"),b.identifier=a.uuid,b.indexes=a.indexes,b}}}),namespace("Sy.Storage"),Sy.Storage.UnitOfWork=function(){this.states=null,this.engine=null,this.generator=null,this.name=null,this.entityKey=null},Sy.Storage.UnitOfWork.prototype=Object.create(Object.prototype,{SCHEDULED_FOR_CREATION:{value:"create",writable:!1},SCHEDULED_FOR_UPDATE:{value:"update",writable:!1},SCHEDULED_FOR_REMOVAL:{value:"remove",writable:!1},setStateRegistry:{value:function(a){if(!(a instanceof Sy.StateRegistryInterface))throw new TypeError("Invalid state registry");return this.states=a,this}},setEngine:{value:function(a){if(!(a instanceof Sy.Storage.EngineInterface))throw new TypeError("Invalid engine");return this.engine=a,this}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator");return this.generator=a,this}},setName:{value:function(a){return this.name=a,this}},setEntityKey:{value:function(a){return this.entityKey=a,this}},handle:{value:function(a){if(!(a instanceof Sy.EntityInterface))throw new TypeError("Invalid entity");return a.get(this.entityKey)?this.isScheduledForCreation(a)?this.states.set(this.SCHEDULED_FOR_CREATION,a.get(this.entityKey),a):this.states.set(this.SCHEDULED_FOR_UPDATE,a.get(this.entityKey),a):(a.set(this.entityKey,this.generator.generate()),this.states.set(this.SCHEDULED_FOR_CREATION,a.get(this.entityKey),a)),this}},remove:{value:function(a){this.isScheduledForCreation(a)?this.states.remove(this.SCHEDULED_FOR_CREATION,a.get(this.entityKey)):this.isScheduledForUpdate(a)?(this.states.remove(this.SCHEDULED_FOR_UPDATE,a.get(this.entityKey)),this.states.set(this.SCHEDULED_FOR_REMOVAL,a.get(this.entityKey),a)):this.states.set(this.SCHEDULED_FOR_REMOVAL,a.get(this.entityKey),a)}},isScheduledFor:{value:function(a,b){return this.states.has(a,b.get(this.entityKey))}},isScheduledForCreation:{value:function(a){return this.isScheduledFor(this.SCHEDULED_FOR_CREATION,a)}},isScheduledForUpdate:{value:function(a){return this.isScheduledFor(this.SCHEDULED_FOR_UPDATE,a)}},isScheduledForRemoval:{value:function(a){return this.isScheduledFor(this.SCHEDULED_FOR_REMOVAL,a)}},flush:{value:function(){for(var a=this.states.has(this.SCHEDULED_FOR_REMOVAL)?this.states.get(this.SCHEDULED_FOR_REMOVAL):[],b=this.states.has(this.SCHEDULED_FOR_UPDATE)?this.states.get(this.SCHEDULED_FOR_UPDATE):[],c=this.states.has(this.SCHEDULED_FOR_CREATION)?this.states.get(this.SCHEDULED_FOR_CREATION):[],d=0,e=a.length;e>d;d++)this.engine.remove(this.name,a[d].get(this.entityKey),this.removalListener.bind(this));for(d=0,e=b.length;e>d;d++)this.engine.update(this.name,b[d].get(this.entityKey),this.getEntityData(b[d]),this.updateListener.bind(this));for(d=0,e=c.length;e>d;d++)this.engine.create(this.name,this.getEntityData(c[d]),this.createListener.bind(this));return this}},getEntityData:{value:function(a){for(var b,c={},d=Object.keys(a.attributes),e=new ReflectionObject(a),f=0,g=d.length;g>f;f++)b="get"+d[f].substr(0,1).toUpperCase()+d[f].substr(1),c[d[f]]=e.hasMethod(b)?e.getMethod(b).call():a.get(d[f]),c[d[f]]instanceof Sy.EntityInterface&&(c[d[f]]=c[d[f]].get(c[d[f]].UUID));return c}},removalListener:{value:function(a){this.states.remove("remove",a)}},updateListener:{value:function(a){this.states.remove("update",a[this.entityKey])}},createListener:{value:function(a){this.states.remove("create",a)}}}),namespace("Sy.Storage"),Sy.Storage.UnitOfWorkFactory=function(){this.generator=null,this.stateRegistryFactory=null},Sy.Storage.UnitOfWorkFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator");return this.generator=a,this}},setStateRegistryFactory:{value:function(a){if(!(a instanceof Sy.StateRegistryFactory))throw new TypeError("Invalid state registry factory");return this.stateRegistryFactory=a,this}},make:{value:function(a,b){var c=new Sy.Storage.UnitOfWork;return c.setStateRegistry(this.stateRegistryFactory.make()).setGenerator(this.generator).setName(a).setEntityKey(b),c}}}),namespace("Sy.View"),Sy.View.NodeWrapper=function(){this.engine=null,this.node=null},Sy.View.NodeWrapper.prototype=Object.create(Object.prototype,{setTemplateEngine:{value:function(a){if(!(a instanceof Sy.View.TemplateEngineInterface))throw new TypeError("Invalid template engine");return this.engine=a,this}},setNode:{value:function(a){if(!(a instanceof HTMLElement))throw new TypeError("Invalid dom node");return this.node=a,this}},getNode:{value:function(){return this.node}},render:{value:function(a){return this.engine.render(this.node,a),this}},findOne:{value:function(a){return this.node.querySelector(a)}},find:{value:function(a){return this.node.querySelectorAll(a)}}}),namespace("Sy.View"),Sy.View.Layout=function(){Sy.View.NodeWrapper.call(this),this.name=null,this.lists=null,this.parser=null,this.listFactory=null},Sy.View.Layout.prototype=Object.create(Sy.View.NodeWrapper.prototype,{setNode:{value:function(a){var b,c;Sy.View.NodeWrapper.prototype.setNode.call(this,a),this.name=a.dataset.syLayout,b=this.parser.getLists(a);for(var d=0,e=b.length;e>d;d++)c=this.listFactory.make(b[d]),this.lists.set(c.getName(),c);return this}},getName:{value:function(){return this.name}},setParser:{value:function(a){if(!(a instanceof Sy.View.Parser))throw new TypeError("Invalid parser");return this.parser=a,this}},setListsRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.lists=a,this}},setListFactory:{value:function(a){if(!(a instanceof Sy.View.ListFactoryInterface))throw new TypeError("Invalid list factory");return this.listFactory=a,this}},getLists:{value:function(){return this.lists.get()}},getList:{value:function(a){return this.lists.get(a)}}}),namespace("Sy.View"),Sy.View.LayoutFactory=function(){this.parser=null,this.engine=null,this.registryFactory=null,this.listFactory=null},Sy.View.LayoutFactory.prototype=Object.create(Sy.View.LayoutFactoryInterface.prototype,{setParser:{value:function(a){if(!(a instanceof Sy.View.Parser))throw new TypeError("Invalid parser");return this.parser=a,this}},setTemplateEngine:{value:function(a){if(!(a instanceof Sy.View.TemplateEngineInterface))throw new TypeError("Invalid template engine");return this.engine=a,this}},setRegistryFactory:{value:function(a){if(!(a instanceof Sy.RegistryFactory))throw new TypeError("Invalid registry factory");return this.registryFactory=a,this}},setListFactory:{value:function(a){if(!(a instanceof Sy.View.ListFactoryInterface))throw new TypeError("Invalid list factory");return this.listFactory=a,this}},make:{value:function(a){var b=new Sy.View.Layout;return b.setParser(this.parser).setListFactory(this.listFactory).setListsRegistry(this.registryFactory.make()).setTemplateEngine(this.engine).setNode(a)}}}),namespace("Sy.View"),Sy.View.List=function(){Sy.View.NodeWrapper.call(this),this.name=null,this.elements=[],this.types=[]},Sy.View.List.prototype=Object.create(Sy.View.NodeWrapper.prototype,{setNode:{value:function(a){var b;Sy.View.NodeWrapper.prototype.setNode.call(this,a),this.name=a.dataset.syList;for(var c=0,d=a.childElementCount;d>c;c++){if(b=a.firstElementChild,this.elements.push(b),a.removeChild(b),this.elements.length>1&&void 0===b.dataset.type)throw new SyntaxError("Multiple list elements require a type to be set");if(void 0!==b.dataset.type){if(-1!==this.types.indexOf(b.dataset.type))throw new SyntaxError("Multiple list elements defined with the same type");this.types.push(b.dataset.type)}}return this}},getName:{value:function(){return this.name}},renderElement:{value:function(a,b){var c,d=b?this.types.indexOf(b):0;if(-1===d)throw new ReferenceError('The type "'+b+'" does not exist for the list "'+this.getName()+'"');return c=this.elements[d].cloneNode(!0),this.engine.render(c,a)}},append:{value:function(a,b){return this.getNode().appendChild(this.renderElement(a,b)),this}},prepend:{value:function(a,b){return this.getNode().insertBefore(this.renderElement(a,b),this.getNode().firstElementChild),this}},render:{value:function(a){for(var b,c,d=this.getNode();d.firstElementChild;)d.removeChild(d.firstElementChild);for(var e=0,f=a.length;f>e;e++)b=a[e],c=b._type,this.append(b,c);return this}}}),namespace("Sy.View"),Sy.View.ListFactory=function(){this.engine=null},Sy.View.ListFactory.prototype=Object.create(Sy.View.ListFactoryInterface.prototype,{setTemplateEngine:{value:function(a){if(!(a instanceof Sy.View.TemplateEngineInterface))throw new TypeError("Invalid template engine");return this.engine=a,this}},make:{value:function(a){var b=new Sy.View.List;return b.setTemplateEngine(this.engine).setNode(a)}}}),namespace("Sy.View"),Sy.View.Manager=function(){this.views=null,this.factory=null},Sy.View.Manager.prototype=Object.create(Object.prototype,{setViewsRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.views=a,this}},setViewScreenFactory:{value:function(a){if(!(a instanceof Sy.View.ViewScreenFactoryInterface))throw new TypeError("Invalid factory");return this.factory=a,this}},setViewScreen:{value:function(a){if(!(a instanceof HTMLElement))throw new TypeError("Html node expected");var b=a.dataset.syView;if(!b&&""===b.trim())throw new SyntaxError('Attribute "data-sy-view" is expected');if(this.views.has(b.trim()))throw new ReferenceError('A view with the name "'+b.trim()+'"');return this.views.set(b.trim(),this.factory.make(a)),this}},getViewScreen:{value:function(a){if(!this.views.has(a))throw new ReferenceError('The view screen "'+a+'" is not registered');return this.views.get(a)}}}),namespace("Sy.View"),Sy.View.Parser=function(){},Sy.View.Parser.prototype=Object.create(Object.prototype,{get:{value:function(a,b){return b=b||document.body,b.querySelectorAll(a)}},getViewScreens:{value:function(a){return this.get("[data-sy-view]",a)}},getLayouts:{value:function(a){return this.get("[data-sy-layout]",a)}},getLists:{value:function(a){return this.get("[data-sy-list]",a)}}}),namespace("Sy.View"),Sy.View.TemplateEngine=function(){Sy.View.TemplateEngineInterface.call(this),this.registry=null,this.generator=null},Sy.View.TemplateEngine.prototype=Object.create(Sy.View.TemplateEngineInterface.prototype,{setRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.registry=a,this}},setGenerator:{value:function(a){if(!(a instanceof Sy.Lib.Generator.Interface))throw new TypeError("Invalid generator");return this.generator=a,this}},render:{value:function(a,b){if(a.dataset.syUuid||this.register(a),a.dataset.syUuid&&this.registry.has(a.dataset.syUuid)&&(this.renderAllAttributes(a,b),this.renderContent(a,b)),a.childElementCount>0)for(var c=0,d=a.childElementCount;d>c;c++)this.render(a.children[c],b);return a}},register:{value:function(a){for(var b=this.generator.generate(),c={attributes:{},textContent:null,uuid:b},d=0,e=a.attributes.length;e>d;d++)c.attributes[a.attributes[d].name]=a.getAttribute(a.attributes[d].name);return c.textContent=a.textContent,a.dataset.syUuid=b,this.registry.set(b,c),this}},renderAllAttributes:{value:function(a,b){for(var c=0,d=a.attributes.length;d>c;c++)this.renderAttribute(a,a.attributes[c].name,b);return a}},renderAttribute:{value:function(a,b,c){var d,e=a.dataset.syUuid,f=this.registry.get(e).attributes[b];return f?(d=this.replace(f,c),a.setAttribute(b,d),a):a}},replace:{value:function(a,b){for(;a.match(this.PATTERN);){var c=this.PATTERN.exec(a);null!==c&&c.length>=1&&(a=a.replace(c[0],reflectedObjectGetter.call(b,c[1])||""))}return a}},renderContent:{value:function(a,b){if(a.childElementCount>0)return a;var c,d=a.dataset.syUuid,e=this.registry.get(d).textContent,f=this.PATTERN.exec(e);return f&&(c=objectGetter.call(b,f[1])),c instanceof HTMLElement?(a.removeChild(a.firstElementChild),a.appendChild(c)):a.textContent=this.replace(e,b),a}}}),namespace("Sy.View"),Sy.View.ViewPort=function(){this.node=null,this.manager=null,this.mediator=null},Sy.View.ViewPort.prototype=Object.create(Sy.View.NodeWrapper.prototype,{setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}},setNode:{value:function(a){if(!(a instanceof HTMLElement&&a.classList.contains("viewport")))throw new TypeError("Invalid node");return this.node=a,this}},setViewManager:{value:function(a){if(!(a instanceof Sy.View.Manager))throw new TypeError("Invalid manager");return this.manager=a,this}},getViewManager:{value:function(){return this.manager}},display:{value:function(a){var b=this.manager.getViewScreen(a),c=b.getNode();switch(this.mediator&&this.mediator.publish("view::on::pre::display",b),this.node.childElementCount){case 0:this.node.appendChild(c);break;case 1:this.node.replaceChild(c,this.node.children[0]);break;default:throw new Error("Viewport in weird state (more than 1 child)")}return this.mediator&&this.mediator.publish("view::on::post::display",b),this}}}),namespace("Sy.View"),Sy.View.ViewScreen=function(){Sy.View.NodeWrapper.call(this),this.name="",this.parser=null,this.layouts=null,this.layoutFactory=null},Sy.View.ViewScreen.prototype=Object.create(Sy.View.NodeWrapper.prototype,{setNode:{value:function(a){var b,c;Sy.View.NodeWrapper.prototype.setNode.call(this,a),this.name=a.dataset.syView,b=this.parser.getLayouts(a);for(var d=0,e=b.length;e>d;d++)c=this.layoutFactory.make(b[d]),this.layouts.set(c.getName(),c);return this}},getName:{value:function(){return this.name}},setParser:{value:function(a){if(!(a instanceof Sy.View.Parser))throw new TypeError("Invalid parser");
return this.parser=a,this}},setLayoutsRegistry:{value:function(a){if(!(a instanceof Sy.RegistryInterface))throw new TypeError("Invalid registry");return this.layouts=a,this}},setLayoutFactory:{value:function(a){if(!(a instanceof Sy.View.LayoutFactoryInterface))throw new TypeError("Invalid layout factory");return this.layoutFactory=a,this}},getLayouts:{value:function(){return this.layouts.get()}},getLayout:{value:function(a){return this.layouts.get(a)}}}),namespace("Sy.View"),Sy.View.ViewScreenFactory=function(){this.parser=null,this.engine=null,this.registryFactory=null,this.layoutFactory=null,this.viewscreens=null},Sy.View.ViewScreenFactory.prototype=Object.create(Sy.View.ViewScreenFactoryInterface.prototype,{setParser:{value:function(a){if(!(a instanceof Sy.View.Parser))throw new TypeError("Invalid parser");return this.parser=a,this}},setTemplateEngine:{value:function(a){if(!(a instanceof Sy.View.TemplateEngineInterface))throw new TypeError("Invalid template engine");return this.engine=a,this}},setRegistryFactory:{value:function(a){if(!(a instanceof Sy.RegistryFactory))throw new TypeError("Invalid registry factory");return this.registryFactory=a,this.viewscreens=a.make(),this}},setLayoutFactory:{value:function(a){if(!(a instanceof Sy.View.LayoutFactoryInterface))throw new TypeError("Invalid layout factory");return this.layoutFactory=a,this}},setViewScreenWrapper:{value:function(a,b){if(this.viewscreens.has(a))throw new ReferenceError('A viewscreen wrapper is already defined with the name "'+a+'"');return this.viewscreens.set(a,b),this}},setDefinedWrappers:{value:function(a){for(var b=0,c=a.length;c>b;b++)this.setViewScreenWrapper(a[b].name,a[b].creator);return this}},make:{value:function(a){var b,c=a.dataset.syView;if(b=this.viewscreens.has(c)?new(this.viewscreens.get(c)):new Sy.View.ViewScreen,!(b instanceof Sy.View.ViewScreen))throw new TypeError("Invalid viewscreen wrapper");return b.setParser(this.parser).setLayoutFactory(this.layoutFactory).setLayoutsRegistry(this.registryFactory.make()).setTemplateEngine(this.engine).setNode(a)}}}),namespace("Sy"),Sy.Configurator=function(){this.name="",this.config={}},Sy.Configurator.prototype=Object.create(Sy.ConfiguratorInterface.prototype,{set:{value:function(a,b){return a instanceof Object&&void 0===b?this.config=_.extend(this.config,a):objectSetter.call(this.config,a,b),this}},get:{value:function(a){var b;return void 0===a?b=this.config:this.has(a)&&(b=objectGetter.call(this.config,a)),b}},has:{value:function(a){try{return objectGetter.call(this.config,a),!0}catch(b){if(b instanceof ReferenceError)return!1}}},setName:{value:function(a){return this.name=a,this}},getName:{value:function(){return this.name}}}),namespace("Sy"),Sy.Controller=function(){this.container=null,this.mediator=null,this.mediatorListeners={},this.bundle="",this.viewscreen=null},Sy.Controller.prototype=Object.create(Sy.ControllerInterface.prototype,{listen:{value:function(a,b){var c=this.mediator.subscribe({channel:a,fn:b,context:this});return this.mediatorListeners[a]||(this.mediatorListeners[a]=[]),this.mediatorListeners[a].push(c),this}},broadcast:{value:function(){return this.mediator.publish.apply(this.mediator,arguments),this}},"new":{value:function(a,b){var c=new RegExp(/^((\w+::)|(\w+))+$/gi),d=null,e=null;if(!c.test(a))throw new SyntaxError("Invalid entity name format");if(d=a.split("::"),e=1===d.length?new App.Bundle[this.bundle].Entity[d[0]]:new App.Bundle[d[0]].Entity[d[1]],!(e instanceof Sy.EntityInterface))throw new TypeError('"'+a+'" does not implement "Sy.EntityInterface"');return e.set(b),e}},setBundle:{value:function(a){if(!App.Bundle[a])throw new ReferenceError('The bundle "'+a+'" is undefined');return this.bundle=a,this}},setMediator:{value:function(a){if(!(a instanceof Sy.Lib.Mediator))throw new TypeError("Invalid mediator");return this.mediator=a,this}},setServiceContainer:{value:function(a){if(!(a instanceof Sy.ServiceContainerInterface))throw new TypeError("Invalid service container");return this.container=a,this}},sleep:{value:function(){for(var a in this.mediatorListeners)if(this.mediatorListeners.hasOwnProperty(a))for(var b=0,c=this.mediatorListeners[a].length;c>b;b++)this.mediator.pause(a,this.mediatorListeners[a][b])}},wakeup:{value:function(){for(var a in this.mediatorListeners)if(this.mediatorListeners.hasOwnProperty(a))for(var b=0,c=this.mediatorListeners[a].length;c>b;b++)this.mediator.unpause(a,this.mediatorListeners[a][b])}},destroy:{value:function(){for(var a in this.mediatorListeners)if(this.mediatorListeners.hasOwnProperty(a))for(var b=0,c=this.mediatorListeners[a].length;c>b;b++)this.mediator.remove(a,this.mediatorListeners[a][b])}},setViewScreen:{value:function(a){if(!(a instanceof Sy.View.ViewScreen))throw new TypeError("Invalid viewscreen");return this.viewscreen=a,this}}}),DOM=function(a){return this===window?new DOM(a):void(this.node=a)},DOM.prototype=Object.create(Object.prototype,{isChildOf:{value:function(a,b){return b=b||this.node,a instanceof HTMLElement?a===b?!0:this.isChildOf(a,b.parentNode):"string"==typeof a?this.matches(a)?!0:this.matches(a,b.parentNode):!1}},matches:{value:function(a,b){return b=b||this.node,b.matches&&b.matches(a)?!0:b.webkitMatchesSelector&&b.webkitMatchesSelector(a)?!0:b.mozMatchesSelector&&b.mozMatchesSelector(a)?!0:b.msMatchesSelector&&b.msMatchesSelector(a)?!0:!1}}}),namespace("Sy"),Sy.Entity=function(){this.attributes={},this.register(this.UUID)},Sy.Entity.prototype=Object.create(Sy.EntityInterface.prototype,{indexes:{value:[],enumerable:!1},connections:{value:{},enumerable:!1},UUID:{value:"uuid"},set:{value:function(a,b){if(a instanceof Object)for(var c in a)a.hasOwnProperty(c)&&this.set(c,a[c]);else this.attributes[a]=b;return this}},get:{value:function(a){return void 0===a?this.attributes:this.attributes[a]}},register:{value:function(a,b){var c=new RegExp(/^\w+::\w+$/gi);if(-1===this.indexes.indexOf(a)&&(this.indexes.push(a),void 0!==b)){if(!c.test(b))throw new SyntaxError("Invalid entity name format");var d=b.split("::");this.connections[a]=App.Bundle[d[0]].Entity[d[1]]}return this}},lock:{value:function(a){if(!(a instanceof Array))throw new SyntaxError;if(!Object.isSealed(this.attributes)){for(var b=0,c=a.length;c>b;b++)this.attributes[a[b]]=null;return Object.seal(this.attributes),this}}}}),namespace("Sy"),Sy.ParamProxy=function(){this.parameters=null,this.serviceContainer=null},Sy.ParamProxy.prototype=Object.create(Object.prototype,{setParameters:{value:function(a){return this.parameters=a,this}},setServiceContainer:{value:function(a){if(!(a instanceof Sy.ServiceContainerInterface))throw new TypeError("Invalid service container");return this.serviceContainer=a,this}},isParameter:{value:function(a){return"string"==typeof a&&new RegExp(/^%.*%$/i).test(a)?!0:!1}},getParameter:{value:function(a){return a=a.substring(1,a.length-1),objectGetter.call(this.parameters,a)}},isService:{value:function(a){return"string"==typeof a&&"@"===a.substring(0,1)?!0:!1}},getService:{value:function(a){return a=a.substring(1),this.serviceContainer.get(a)}},isDependency:{value:function(a){return this.isParameter(a)||this.isService(a)?!0:!1}},getDependency:{value:function(a){return this.isParameter(a)?this.getParameter(a):this.isService(a)?this.getService(a):a}}}),namespace("Sy"),Sy.StateRegistry=function(){this.data=null,this.states=[],this.registryFactory=null},Sy.StateRegistry.prototype=Object.create(Sy.StateRegistryInterface.prototype,{setRegistryFactory:{value:function(a){if(!(a instanceof Sy.RegistryFactory))throw new TypeError("Invalid factory");return this.registryFactory=a,this.data=a.make(),this}},set:{value:function(a,b,c){if(!this.has(a)){var d=this.registryFactory.make();this.data.set(a,d),this.states.push(a)}return this.data.get(a).set(b,c),this}},has:{value:function(a,b){return void 0===b&&this.data.has(a)?!0:this.data.has(a)&&this.data.get(a).has(b)?!0:!1}},get:{value:function(a,b){switch(arguments.length){case 2:if(this.has(a,b))return this.data.get(a).get(b);break;case 1:if(this.has(a))return this.data.get(a).get();break;case 0:var c={};for(var d in this.states)this.states.hasOwnProperty(d)&&(c[this.states[d]]=this.data.get(this.states[d]).get());return c}throw new ReferenceError('"'+b+'" does not exist in "'+a+'" state')}},state:{value:function(a){var b=[];for(var c in this.states)this.data.get(this.states[c]).has(a)&&b.push(this.states[c]);switch(b.length){case 0:return void 0;case 1:return b[0];default:return b}}},remove:{value:function(a,b){if(void 0===a)for(var c=0,d=this.states.length;d>c;c++)this.remove(this.states[c]);else this.data.get(a).remove(b);return this}}}),namespace("Sy"),Sy.StateRegistryFactory=function(){this.registryFactory=null},Sy.StateRegistryFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{setRegistryFactory:{value:function(a){if(!(a instanceof Sy.RegistryFactory))throw new TypeError("Invalid factory");return this.registryFactory=a,this}},make:{value:function(){var a=new Sy.StateRegistry;return a.setRegistryFactory(this.registryFactory),a}}}),namespace("Sy"),Sy.Registry=function(){this.data={},this.registryLength=0},Sy.Registry.prototype=Object.create(Sy.RegistryInterface.prototype,{set:{value:function(a,b){return"string"==typeof a&&(this.data[a]=b,this.registryLength++),this}},has:{value:function(a){return this.data.hasOwnProperty(a)?!0:!1}},get:{value:function(a){if(this.has(a))return this.data[a];if(void 0===a){var b=[];for(var c in this.data)this.data.hasOwnProperty(c)&&b.push(this.data[c]);return b}throw new ReferenceError('"'+a+'" is not defined')}},getMapping:{value:function(){var a={};for(var b in this.data)this.data.hasOwnProperty(b)&&(a[b]=this.data[b]);return a}},remove:{value:function(a){if(void 0===a)for(var b in this.data)this.data.hasOwnProperty(b)&&this.remove(b);else if(a instanceof Array)for(var c=0,d=a.length;d>c;c++)this.remove(a[c]);else"string"==typeof a&&this.has(a)&&(delete this.data[a],this.registryLength--);return this}},length:{value:function(){return this.registryLength}}}),namespace("Sy"),Sy.RegistryFactory=function(){},Sy.RegistryFactory.prototype=Object.create(Sy.FactoryInterface.prototype,{make:{value:function(){return new Sy.Registry}}}),namespace("Sy"),Sy.ServiceContainer=function(a){this.name="",this.services={},this.definitions={},this.proxy=new Sy.ParamProxy,this.proxy.setServiceContainer(this),this.setName(a)},Sy.ServiceContainer.prototype=Object.create(Sy.ServiceContainerInterface.prototype,{PATTERN:{value:"^([a-z]+::|[a-z]+)+$",writable:!1,configurable:!1},setParameters:{value:function(a){return this.proxy.setParameters(a),this}},getParameter:{value:function(a){return this.proxy.getParameter("%"+a+"%")}},get:{value:function(a){if(void 0===this.services[a]&&this.definitions[a]){var b,c=this.definitions[a];"creator"===c.type?b=this.buildServiceByCreator(a):"prototype"===c.type&&(b=this.buildServiceByDefinition(a)),this.services[a]=b,delete this.definitions[a]}else if(void 0===this.services[a])throw new ReferenceError("Unknown service");return this.services[a]}},buildServiceByCreator:{value:function(a){return this.definitions[a].fn.apply(this)}},buildServiceByDefinition:{value:function(a){var b,c=this.definitions[a],d=objectGetter(c.constructor);if("function"!=typeof d)throw new TypeError("Invalid constructor");if(b=c.arguments?new d(c.arguments):new d,c.calls instanceof Array)for(var e=0,f=c.calls.length;f>e;e++){for(var g=c.calls[e][1],h=0,i=g.length;i>h;h++)this.proxy.isDependency(g[h])&&(g[h]=this.proxy.getDependency(g[h]));b[c.calls[e][0]].apply(b,g)}return b}},set:{value:function(a,b){return a instanceof Object?this.setPrototypes(a):this.setCreator(a,b),this}},setCreator:{value:function(a,b){var c=new RegExp(this.PATTERN,"gi");if(!c.test(a))throw new SyntaxError('Service name "'+a+'" does not follow pattern convention');if("function"!=typeof b)throw new TypeError("Invalid creator type");if(this.has(a))throw new TypeError('Service name "'+a+'" already used');this.definitions[a]={fn:b,type:"creator"}}},setPrototypes:{value:function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=new RegExp(this.PATTERN,"gi");if(!c.test(b))throw new SyntaxError('Service name "'+b+'" does not follow pattern convention');if(this.has(b))throw new TypeError('Service name "'+b+'" already used');this.definitions[b]=a[b],this.definitions[b].type="prototype"}}},has:{value:function(a){return this.services[a]||this.definitions[a]?!0:!1}},getName:{value:function(){return this.name}},setName:{value:function(a){return this.name=a,this}}}),namespace("Sy"),Sy.Translator=function(){this.currentLanguage=null,this.languages=null,this.stateRegistryFactory=null},Sy.Translator.prototype=Object.create(Object.prototype,{setRegistry:{value:function(a){if(!(a instanceof Sy.Registry))throw new TypeError("Invalid registry");return this.languages=a,this}},setStateRegistryFactory:{value:function(a){if(!(a instanceof Sy.StateRegistryFactory))throw new TypeError("Invalid state registry factory");return this.stateRegistryFactory=a,this}},setLanguage:{value:function(a){return this.currentLanguage=a,this}},registerTranslation:{value:function(a,b,c,d){return this.languages.has(a)||this.languages.set(a,this.stateRegistryFactory.make()),this.languages.get(a).set(b,c,d),this}},registerTranslations:{value:function(a,b){for(var c=0,d=b.length;d>c;c++)this.registerTranslation(a,b[c].domain||"root",b[c].key,b[c].translation);return this}},translate:{value:function(a,b,c){var d=c||this.currentLanguage;return b=b||"root",this.languages.has(d)&&this.languages.get(d).has(b,a)?this.languages.get(d).get(b,a):a}}}),namespace("Sy"),Sy.kernel=new Sy.Kernel.Core,Sy.kernel.getConfig().set({env:"prod",parameters:{app:{meta:{viewscreens:[]}},storage:{engines:[{name:"indexeddb",factory:"sy::core::storage::factory::engine::indexeddb",mapper:"sy::core::storage::storemapper::indexeddb"},{name:"localstorage",factory:"sy::core::storage::factory::engine::localstorage",mapper:"sy::core::storage::storemapper::localstorage"},{name:"rest",factory:"sy::core::storage::factory::engine::rest",mapper:"sy::core::storage::storemapper::rest"}]}},controllers:{cache:!0}}),Sy.kernel.getServiceContainer().setParameters(Sy.kernel.getConfig().get("parameters")).set({"sy::core::generator::uuid":{constructor:"Sy.Lib.Generator.UUID"},"sy::core::mediator":{constructor:"Sy.Lib.Mediator",calls:[["setGenerator",["@sy::core::generator::uuid"]],["setLogger",["@sy::core::logger"]]]},"sy::core::http::rest":{constructor:"Sy.HTTP.REST",calls:[["setManager",["@sy::core::http"]]]},"sy::core::registry::factory":{constructor:"Sy.RegistryFactory"},"sy::core::stateregistry::factory":{constructor:"Sy.StateRegistryFactory",calls:[["setRegistryFactory",["@sy::core::registry::factory"]]]},"sy::core::view::parser":{constructor:"Sy.View.Parser"},"sy::core::view::factory::list":{constructor:"Sy.View.ListFactory",calls:[["setTemplateEngine",["@sy::core::view::template::engine"]]]},"sy::core::view::factory::layout":{constructor:"Sy.View.LayoutFactory",calls:[["setParser",["@sy::core::view::parser"]],["setTemplateEngine",["@sy::core::view::template::engine"]],["setRegistryFactory",["@sy::core::registry::factory"]],["setListFactory",["@sy::core::view::factory::list"]]]},"sy::core::view::factory::viewscreen":{constructor:"Sy.View.ViewScreenFactory",calls:[["setParser",["@sy::core::view::parser"]],["setTemplateEngine",["@sy::core::view::template::engine"]],["setRegistryFactory",["@sy::core::registry::factory"]],["setLayoutFactory",["@sy::core::view::factory::layout"]],["setDefinedWrappers",["%app.meta.viewscreens%"]]]},"sy::core::storage::factory::engine::indexeddb":{constructor:"Sy.Storage.EngineFactory.IndexedDBFactory",calls:[["setLogger",["@sy::core::logger"]],["setMediator",["@sy::core::mediator"]]]},"sy::core::storage::factory::engine::localstorage":{constructor:"Sy.Storage.EngineFactory.LocalstorageFactory",calls:[["setLogger",["@sy::core::logger"]],["setMediator",["@sy::core::mediator"]]]},"sy::core::storage::factory::engine::rest":{constructor:"Sy.Storage.EngineFactory.RestFactory",calls:[["setLogger",["@sy::core::logger"]],["setMediator",["@sy::core::mediator"]],["setManager",["@sy::core::http::rest"]]]},"sy::core::storage::storemapper::indexeddb":{constructor:"Sy.Storage.StoreMapper.IndexedDBMapper"},"sy::core::storage::storemapper::localstorage":{constructor:"Sy.Storage.StoreMapper.LocalstorageMapper"},"sy::core::storage::storemapper::rest":{constructor:"Sy.Storage.StoreMapper.RestMapper"},"sy::core::storage::unitofwork::factory":{constructor:"Sy.Storage.UnitOfWorkFactory",calls:[["setGenerator",["@sy::core::generator::uuid"]],["setStateRegistryFactory",["@sy::core::stateregistry::factory"]]]},"sy::core::storage::repository::factory":{constructor:"Sy.Storage.RepositoryFactory",calls:[["setRegistryFactory",["@sy::core::registry::factory"]],["setUOWFactory",["@sy::core::storage::unitofwork::factory"]],["setMeta",["%app.meta.entities%"]]]}}).set("sy::core::logger",function(){var a=new Sy.Lib.Logger.CoreLogger("core"),b=new Sy.Lib.Logger.Handler.Console(a.INFO),c=new Sy.Lib.Logger.Handler.Console(a.DEBUG),d=new Sy.Lib.Logger.Handler.Console(a.ERROR),e=new Sy.Lib.Logger.Handler.Console(a.LOG);return a.setHandler(b,a.INFO),a.setHandler(c,a.DEBUG),a.setHandler(d,a.ERROR),a.setHandler(e,a.LOG),a}).set("sy::core::http",function(){var a=new Sy.HTTP.HeaderParser,b=new Sy.HTTP.Manager;return b.setParser(a),b.setGenerator(this.get("sy::core::generator::uuid")),b.setRegistry(this.get("sy::core::registry::factory").make()),b}).set("sy::core::storage::factory::engine::core",function(){var a=new Sy.Storage.EngineFactory.Core,b=this.getParameter("storage.engines");a.setRegistry(this.get("sy::core::registry::factory").make());for(var c=0,d=b.length;d>c;c++)a.setEngineFactory(b[c].name,this.get(b[c].factory),this.get(b[c].mapper));return a}).set("sy::core::storage",function(){var a=this.getParameter("app.meta.entities"),b=new Sy.Storage.Core,c=new Sy.Storage.ManagerFactory,d=this.get("sy::core::storage::factory::engine::core"),e=this.getParameter("storage.managers"),f=this.get("sy::core::registry::factory");b.setRegistry(f.make()),c.setEngineFactory(d).setRepositoryFactory(this.get("sy::core::storage::repository::factory"));for(var g in e)if(e.hasOwnProperty(g)){var h=c.make(g,e[g],a);b.setManager(g,h)}return b}).set("sy::core::translator",function(){var a=new Sy.Translator;return a.setRegistry(this.get("sy::core::registry::factory").make()).setStateRegistryFactory(this.get("sy::core::stateregistry::factory")),a}).set("sy::core::view::template::engine",function(){var a=new Sy.View.TemplateEngine;return a.setRegistry(this.get("sy::core::registry::factory").make()).setGenerator(this.get("sy::core::generator::uuid"))}).set("sy::core::viewport",function(){var a=new Sy.View.ViewPort;return a.setNode(document.querySelector(".viewport")).setViewManager(this.get("sy::core::view::manager")).setMediator(this.get("sy::core::mediator"))}).set("sy::core::view::manager",function(){var a=new Sy.View.Manager,b=this.get("sy::core::view::parser").getViewScreens();a.setViewsRegistry(this.get("sy::core::registry::factory").make()).setViewScreenFactory(this.get("sy::core::view::factory::viewscreen"));for(var c=0,d=b.length;d>c;c++)a.setViewScreen(b[c]),DOM(b[c]).isChildOf(".viewport")||b[c].parentNode.removeChild(b[c]);return a});