/*! sy#1.1.0 - 2014-12-20 */
function namespace(a){var b=null,c=this;if("string"==typeof a)b=a.split(".");else{if(!(a instanceof Array&&a.length>0))return c;b=a}return c[b[0]]=c[b[0]]||{},a=b.shift(),namespace.call(c[a],b)}function objectSetter(a,b){var c="",d="",e=this,f=a.lastIndexOf(".");f>=0?(d=a.substr(f+1),c=a.substr(0,f),e=namespace.call(e,c)):d=a,e[d]=b}function objectGetter(a){var b=null,c=this;if("string"==typeof a){if(b=a.split("."),1===b.length)return c[a]}else{if(!(a instanceof Array&&a.length>1))return a instanceof Array&&1===a.length?c[a[0]]:void 0;b=a}return a=b.shift(),objectGetter.call(c[a],b)}function capitalize(a){return a.substr(0,1).toUpperCase()+a.substr(1)}function reflectedObjectGetter(a){var b=null,c=this;if("string"==typeof a){if(b=a.split("."),1===b.length)return getReflectedValue.call(c,a)}else{if(!(a instanceof Array&&a.length>1))return a instanceof Array&&1===a.length?getReflectedValue.call(c,a[0]):void 0;b=a}return a=b.shift(),reflectedObjectGetter.call(getReflectedValue.call(c,a),b)}function getReflectedValue(a){var b=new ReflectionObject(this);return b.hasMethod("get"+capitalize(a))?b.getMethod("get"+capitalize(a)).call():b.hasMethod("get")?b.getMethod("get").call(a):b.hasProperty(a)?b.getProperty(a).getValue():void 0}namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Core=function(){this.initialized={container:this},this.services={},this.loading=[],this.config=null,this.compiler=null,this.compiled=!1,this.propertyAccessor=new Sy.PropertyAccessor(!0)},Sy.ServiceContainer.Core.prototype=Object.create(Object.prototype,{set:{value:function(a){var b,c,d;for(var e in a)if(c=/^@.+$/,a.hasOwnProperty(e)){if(this.services[e]&&this.services[e]instanceof Sy.ServiceContainer.Definition)throw new TypeError("Service name already used");d=a[e],"string"==typeof d&&c.test(d)?b=new Sy.ServiceContainer.Alias(d.substr(1)):(b=new Sy.ServiceContainer.Definition,b.setConstructor(d.constructor),d.factory instanceof Array&&b.setFactoryService(new Sy.ServiceContainer.Reference(d.factory[0])).setFactoryMethod(d.factory[1]),d.configurator instanceof Array&&b.setConfigurator(new Sy.ServiceContainer.Reference(d.configurator[0])).setConfiguratorMethod(d.configurator[1]),d.calls instanceof Array&&d.calls.forEach(function(a){b.addCall(a[0],a[1])},this),d.hasOwnProperty("private")&&b.setPrivate(),d.tags instanceof Array&&d.tags.forEach(function(a){b.addTag(a.name,a)},this),d.hasOwnProperty("abstract")&&b.setAbstract(),d.hasOwnProperty("prototype")&&b.setPrototype(),d.hasOwnProperty("parent")&&b.setParent(new Sy.ServiceContainer.Reference(d.parent))),this.services[e]=b}return this}},setInstance:{value:function(a,b){return this.initialized[a]=b,this}},get:{value:function(a){if(!this.services.hasOwnProperty(a)&&!this.initialized.hasOwnProperty(a))throw new ReferenceError("Unknown service");if(this.initialized.hasOwnProperty(a))return this.initialized[a];if(this.services[a]instanceof Sy.ServiceContainer.Alias)return this.get(this.services[a].toString());if(0===this.loading.length&&!this.services[a].isPublic())throw new Error("Can't access private service");if(0===this.loading.length&&this.services[a].isAbstract())throw new Error("Can't access abstract service");if(-1!==this.loading.indexOf(a))throw this.loading=[],new Error("Circular referencing");var b,c,d=this.services[a],e=this.propertyAccessor.getValue(window,d.getConstructor());if(this.loading.push(a),d.hasFactory()){if(c=this.get(d.getFactoryService().toString()),b=c[d.getFactoryMethod()].call(c,d.getConstructor()),!(b instanceof e))throw new TypeError("Factory built an object different from the specified type")}else b=new e;return d.getCalls().forEach(function(a){var c=a[0],d=a[1];d.forEach(function(a,b,c){a instanceof Sy.ServiceContainer.Reference?c[b]=this.get(a.toString()):a instanceof Sy.ServiceContainer.Parameter&&(c[b]=this.getParameter(a.toString()))},this),b[c].apply(b,d)},this),d.hasConfigurator()&&this.get(d.getConfigurator().toString())[d.getConfiguratorMethod()](b),d.isPrototype()||(this.initialized[a]=b),this.loading.splice(this.loading.indexOf(a),1),b}},remove:{value:function(a){return delete this.services[a],this}},getServiceIds:{value:function(){return Object.keys(this.services)}},has:{value:function(a){return this.services.hasOwnProperty(a)||this.initialized.hasOwnProperty(a)}},isInitialized:{value:function(a){return this.initialized.hasOwnProperty(a)}},setParameters:{value:function(a){if(!(a instanceof Sy.ConfiguratorInterface))throw new TypeError("Invalid parameters object");return this.config=a,this}},getParameter:{value:function(a){return this.config.get(a)}},hasParameter:{value:function(a){return this.config.has(a)}},setParameter:{value:function(a,b){return this.config.set(a,b),this}},getDefinition:{value:function(a){if(this.compiled===!0)throw new ReferenceError("Can't access a definition once container compiled");return this.services[a]}},setDefinition:{value:function(a,b){if(!(b instanceof Sy.ServiceContainer.Definition))throw new TypeError("Invalid definition");return this.services[a]=b,this}},setCompiler:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Compiler))throw new TypeError("Invalid compiler");return this.compiler=a,this}},addPass:{value:function(a,b){return this.compiler.addPass(a,b),this}},compile:{value:function(){this.compiler.compile(this),Object.freeze(this.services),this.compiled=!0}},findTaggedServiceIds:{value:function(a){var b=this.getServiceIds(),c=[];return b.forEach(function(b){if(this.services[b]instanceof Sy.ServiceContainer.Definition){var d=this.services[b].getTag(a);d.length>0&&c.push({id:b,tags:d})}},this),c}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Alias=function(a){this.id=a},Sy.ServiceContainer.Alias.prototype=Object.create(Object.prototype,{toString:{value:function(){return this.id}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Compiler=function(){this.beforeOpti=[],this.opti=[new Sy.ServiceContainer.CompilerPass.ResolveParameterPlaceholder,new Sy.ServiceContainer.CompilerPass.ResolveReferencePlaceholder,new Sy.ServiceContainer.CompilerPass.ApplyParentDefinition],this.beforeRm=[],this.rm=[new Sy.ServiceContainer.CompilerPass.RemoveAbstractDefinitions],this.afterRm=[]},Sy.ServiceContainer.Compiler.prototype=Object.create(Object.prototype,{addPass:{value:function(a,b){if(!(a instanceof Sy.ServiceContainer.CompilerPassInterface))throw new TypeError("Invalid compiler pass");switch(b){case a.BEFORE_OPTIMIZATION:this.beforeOpti.push(a);break;case a.OPTIMIZE:this.opti.push(a);break;case a.BEFORE_REMOVING:this.beforeRm.push(a);break;case a.REMOVE:this.rm.push(a);break;case a.AFTER_REMOVING:this.afterRm.push(a);break;default:this.beforeOpti.push(a)}}},compile:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Core))throw new TypeError("Invalid service container");this.beforeOpti.forEach(function(b){b.process(a)},this),this.opti.forEach(function(b){b.process(a)},this),this.beforeRm.forEach(function(b){b.process(a)},this),this.rm.forEach(function(b){b.process(a)},this),this.afterRm.forEach(function(b){b.process(a)},this)}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.CompilerPassInterface=function(){},Sy.ServiceContainer.CompilerPassInterface.prototype=Object.create(Object.prototype,{BEFORE_OPTIMIZATION:{value:"before_optimization",writable:!1},OPTIMIZE:{value:"optimize",writable:!1},BEFORE_REMOVING:{value:"before_removing",writable:!1},REMOVE:{value:"remove",writable:!1},AFTER_REMOVING:{value:"after_removing",writable:!1},process:{value:function(){}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Definition=function(){this.constructor=null,this.factoryService=null,this.factoryMethod=null,this.configuratorService=null,this.configuratorMethod=null,this.calls=[],this["public"]=!0,this.tags=[],this["abstract"]=!1,this.parent=null,this.proto=!1},Sy.ServiceContainer.Definition.prototype=Object.create(Object.prototype,{setConstructor:{value:function(a){return this.constructor=a,this}},getConstructor:{value:function(){return this.constructor}},setFactoryService:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Reference))throw new TypeError("Invalid reference");return this.factoryService=a,this}},getFactoryService:{value:function(){return this.factoryService}},setFactoryMethod:{value:function(a){return this.factoryMethod=a,this}},getFactoryMethod:{value:function(){return this.factoryMethod}},hasFactory:{value:function(){return!!this.factoryService&&!!this.factoryMethod}},setConfigurator:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Reference))throw new TypeError("Invalid reference");return this.configuratorService=a,this}},getConfigurator:{value:function(){return this.configuratorService}},setConfiguratorMethod:{value:function(a){return this.configuratorMethod=a,this}},getConfiguratorMethod:{value:function(){return this.configuratorMethod}},hasConfigurator:{value:function(){return!!this.configuratorService&&!!this.configuratorMethod}},addCall:{value:function(a,b,c){var d=c?"unshift":"push";return this.calls[d]([a,b]),this}},getCalls:{value:function(){return this.calls}},setPrivate:{value:function(){return this["public"]=!1,this}},isPublic:{value:function(){return this["public"]}},addTag:{value:function(a,b){return b=b||{},this.tags.push([a,b]),this}},getTags:{value:function(){return this.tags}},getTag:{value:function(a){return this.tags.filter(function(b){return b[0]===a},this)}},setAbstract:{value:function(){return this["abstract"]=!0,this}},isAbstract:{value:function(){return this["abstract"]}},setParent:{value:function(a){if(!(a instanceof Sy.ServiceContainer.Reference))throw new TypeError("Invalid reference");return this.parent=a,this}},hasParent:{value:function(){return!!this.parent}},getParent:{value:function(){return this.parent}},setPrototype:{value:function(){return this.proto=!0,this}},isPrototype:{value:function(){return this.proto}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Parameter=function(a){this.id=a},Sy.ServiceContainer.Parameter.prototype=Object.create(Object.prototype,{toString:{value:function(){return this.id}}}),namespace("Sy.ServiceContainer"),Sy.ServiceContainer.Reference=function(a){this.id=a},Sy.ServiceContainer.Reference.prototype=Object.create(Object.prototype,{toString:{value:function(){return this.id}}}),namespace("Sy.ServiceContainer.CompilerPass"),Sy.ServiceContainer.CompilerPass.ApplyParentDefinition=function(){},Sy.ServiceContainer.CompilerPass.ApplyParentDefinition.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){a.getServiceIds().forEach(function(a){var b,c,d=this.getDefinition(a);if(d instanceof Sy.ServiceContainer.Definition&&d.hasParent()){b=this.getDefinition(d.getParent().toString()),b.hasFactory()&&!d.hasFactory()&&(d.setFactoryService(b.getFactoryService()),d.setFactoryMethod(b.getFactoryMethod())),b.hasConfigurator()&&!d.hasConfigurator()&&(d.setConfigurator(b.getConfigurator()),d.setConfiguratorMethod(b.getConfiguratorMethod())),c=b.getCalls();for(var e=c.length-1;e>=0;e--)d.addCall(c[e][0],c[e][1],!0)}},a)}}}),namespace("Sy.ServiceContainer.CompilerPass"),Sy.ServiceContainer.CompilerPass.RemoveAbstractDefinitions=function(){},Sy.ServiceContainer.CompilerPass.RemoveAbstractDefinitions.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){a.getServiceIds().forEach(function(a){var b=this.getDefinition(a);b instanceof Sy.ServiceContainer.Definition&&b.isAbstract()&&this.remove(a)},a)}}}),namespace("Sy.ServiceContainer.CompilerPass"),Sy.ServiceContainer.CompilerPass.ResolveParameterPlaceholder=function(){},Sy.ServiceContainer.CompilerPass.ResolveParameterPlaceholder.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){a.getServiceIds().forEach(function(a){var b,c=this.getDefinition(a),d=/^%[a-zA-Z-_.]+%$/;if(c instanceof Sy.ServiceContainer.Definition){b=c.getCalls();for(var e=0,f=b.length;f>e;e++)for(var g=0,h=b[e][1].length;h>g;g++)d.test(b[e][1][g])&&(b[e][1][g]=new Sy.ServiceContainer.Parameter(b[e][1][g].substring(1,b[e][1][g].length-1)))}},a)}}}),namespace("Sy.ServiceContainer.CompilerPass"),Sy.ServiceContainer.CompilerPass.ResolveReferencePlaceholder=function(){},Sy.ServiceContainer.CompilerPass.ResolveReferencePlaceholder.prototype=Object.create(Sy.ServiceContainer.CompilerPassInterface.prototype,{process:{value:function(a){a.getServiceIds().forEach(function(a){var b,c=this.getDefinition(a),d=/^@.+$/;if(c instanceof Sy.ServiceContainer.Definition){b=c.getCalls();for(var e=0,f=b.length;f>e;e++)for(var g=0,h=b[e][1].length;h>g;g++)d.test(b[e][1][g])&&(b[e][1][g]=new Sy.ServiceContainer.Reference(b[e][1][g].substr(1)))}},a)}}}),namespace("Sy"),Sy.PropertyAccessor=function(a){this.disableGetterSetter=!!a},Sy.PropertyAccessor.prototype=Object.create(Object.prototype,{prefixes:{value:["get","is","has"],writable:!1,configurable:!1},getValue:{value:function(a,b){var c,d,e=this.transform(b),f=e.shift(),g=new ReflectionObject(a),h=!1;if(!this.disableGetterSetter){for(var i=0,j=this.prefixes.length;j>i;i++)if(d=this.prefixes[i]+this.camelize(f),g.hasMethod(d)){c=g.getMethod(d).call(),h=!0;break}!h&&g.hasMethod("get")&&(c=g.getMethod("get").call(f),h=!0)}if(!h&&g.hasProperty(f))c=g.getProperty(f).getValue();else if(!h)return void 0;return 0===e.length?c:this.getValue(c,e)}},setValue:{value:function(a,b,c){var d,e,f=this.transform(b),g=f.pop();if(0!==f.length&&(a=this.getValue(a,f)),"undefined"==typeof a)throw new ReferenceError('Path "'+b+'" not writable');return!this.disableGetterSetter&&(e="set"+this.camelize(g),d=new ReflectionObject(a),d.hasMethod(e))?(d.getMethod(e).call(c),this):(a[g]=c,this)}},transform:{value:function(a){if(a instanceof Array)return a;if("string"!=typeof a||""===a.trim())throw new TypeError("Invalid path");return a.split(".")}},camelize:{value:function(a){var b=a.split("_");return b.forEach(function(a,b){this[b]=a.substr(0,1).toUpperCase()+a.substr(1)},b),b.join("")}},enableSetterGetter:{value:function(){return this.disableGetterSetter=!1,this}},disableSetterGetter:{value:function(){return this.disableGetterSetter=!0,this}}});