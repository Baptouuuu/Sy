/*! sy#0.6.0 - 2014-06-11 */
function namespace(a){var b=null,c=this;if("string"==typeof a)b=a.split(".");else{if(!(a instanceof Array&&a.length>0))return c;b=a}return c[b[0]]=c[b[0]]||{},a=b.shift(),namespace.call(c[a],b)}function objectSetter(a,b){var c="",d="",e=this,f=a.lastIndexOf(".");f>=0?(d=a.substr(f+1),c=a.substr(0,f),e=namespace.call(e,c)):d=a,e[d]=b}function objectGetter(a){var b=null,c=this;if("string"==typeof a){if(b=a.split("."),1===b.length)return c[a]}else{if(!(a instanceof Array&&a.length>1))return a instanceof Array&&1===a.length?c[a[0]]:void 0;b=a}return a=b.shift(),objectGetter.call(c[a],b)}function capitalize(a){return a.substr(0,1).toUpperCase()+a.substr(1)}function reflectedObjectGetter(a){var b=null,c=this;if("string"==typeof a){if(b=a.split("."),1===b.length)return getReflectedValue.call(c,a)}else{if(!(a instanceof Array&&a.length>1))return a instanceof Array&&1===a.length?getReflectedValue.call(c,a[0]):void 0;b=a}return a=b.shift(),reflectedObjectGetter.call(getReflectedValue.call(c,a),b)}function getReflectedValue(a){var b=new ReflectionObject(this);return b.hasMethod("get"+capitalize(a))?b.getMethod("get"+capitalize(a)).call():b.hasMethod("get")?b.getMethod("get").call(a):b.hasProperty(a)?b.getProperty(a).getValue():void 0}namespace("Sy"),Sy.ServiceContainerInterface=function(){},Sy.ServiceContainerInterface.prototype=Object.create(Object.prototype,{setParameters:{value:function(){return this}},getParameter:{value:function(){}},setName:{value:function(){return this}},getName:{value:function(){}},set:{value:function(){return this}},get:{value:function(){}},has:{value:function(){}}}),namespace("Sy"),Sy.ParamProxy=function(){this.parameters=null,this.serviceContainer=null},Sy.ParamProxy.prototype=Object.create(Object.prototype,{setParameters:{value:function(a){return this.parameters=a,this}},setServiceContainer:{value:function(a){if(!(a instanceof Sy.ServiceContainerInterface))throw new TypeError("Invalid service container");return this.serviceContainer=a,this}},isParameter:{value:function(a){return"string"==typeof a&&new RegExp(/^%.*%$/i).test(a)?!0:!1}},getParameter:{value:function(a){return a=a.substring(1,a.length-1),objectGetter.call(this.parameters,a)}},isService:{value:function(a){return"string"==typeof a&&"@"===a.substring(0,1)?!0:!1}},getService:{value:function(a){return a=a.substring(1),this.serviceContainer.get(a)}},isDependency:{value:function(a){return this.isParameter(a)||this.isService(a)?!0:!1}},getDependency:{value:function(a){return this.isParameter(a)?this.getParameter(a):this.isService(a)?this.getService(a):a}}}),namespace("Sy"),Sy.ServiceContainer=function(a){this.name="",this.services={},this.definitions={},this.proxy=new Sy.ParamProxy,this.proxy.setServiceContainer(this),this.setName(a)},Sy.ServiceContainer.prototype=Object.create(Sy.ServiceContainerInterface.prototype,{PATTERN:{value:"^([a-z]+::|[a-z]+)+$",writable:!1,configurable:!1},setParameters:{value:function(a){return this.proxy.setParameters(a),this}},getParameter:{value:function(a){return this.proxy.getParameter("%"+a+"%")}},get:{value:function(a){if(void 0===this.services[a]&&this.definitions[a]){var b,c=this.definitions[a];"creator"===c.type?b=this.buildServiceByCreator(a):"prototype"===c.type&&(b=this.buildServiceByDefinition(a)),this.services[a]=b,delete this.definitions[a]}else if(void 0===this.services[a])throw new ReferenceError("Unknown service");return this.services[a]}},buildServiceByCreator:{value:function(a){return this.definitions[a].fn.apply(this)}},buildServiceByDefinition:{value:function(a){var b,c=this.definitions[a],d=objectGetter(c.constructor);if("function"!=typeof d)throw new TypeError("Invalid constructor");if(b=c.arguments?new d(c.arguments):new d,c.calls instanceof Array)for(var e=0,f=c.calls.length;f>e;e++){for(var g=c.calls[e][1],h=0,i=g.length;i>h;h++)this.proxy.isDependency(g[h])&&(g[h]=this.proxy.getDependency(g[h]));b[c.calls[e][0]].apply(b,g)}return b}},set:{value:function(a,b){return a instanceof Object?this.setPrototypes(a):this.setCreator(a,b),this}},setCreator:{value:function(a,b){var c=new RegExp(this.PATTERN,"gi");if(!c.test(a))throw new SyntaxError('Service name "'+a+'" does not follow pattern convention');if("function"!=typeof b)throw new TypeError("Invalid creator type");if(this.has(a))throw new TypeError('Service name "'+a+'" already used');this.definitions[a]={fn:b,type:"creator"}}},setPrototypes:{value:function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=new RegExp(this.PATTERN,"gi");if(!c.test(b))throw new SyntaxError('Service name "'+b+'" does not follow pattern convention');if(this.has(b))throw new TypeError('Service name "'+b+'" already used');this.definitions[b]=a[b],this.definitions[b].type="prototype"}}},has:{value:function(a){return this.services[a]||this.definitions[a]?!0:!1}},getName:{value:function(){return this.name}},setName:{value:function(a){return this.name=a,this}}});